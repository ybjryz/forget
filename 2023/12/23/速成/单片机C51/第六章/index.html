<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>第六章 | ryz</title><meta name="keywords" content="学校课程"><meta name="author" content="ryz"><meta name="copyright" content="ryz"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="第六章"><meta name="application-name" content="第六章"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="第六章"><meta property="og:url" content="http://ybjryz.github.io/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/index.html"><meta property="og:site_name" content="ryz"><meta property="og:description" content="第六章0.大纲第六章  AT89S51单片机的定时器&amp;#x2F;计数器（了解AT89S51单片机内定时器&amp;#x2F;计数器的结构与功能，2种工作模式和4种工作方式，以及重点掌握2个特殊功能寄存器TMOD和TCON各位的定义及其编程，熟悉方波生成程序、定时程序的编程实现）   6.1 定时器&amp;amp;#x2F"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://ybjryz.github.io/img/tx.png"><meta property="article:author" content="ryz"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://ybjryz.github.io/img/tx.png"><meta name="description" content="第六章0.大纲第六章  AT89S51单片机的定时器&amp;#x2F;计数器（了解AT89S51单片机内定时器&amp;#x2F;计数器的结构与功能，2种工作模式和4种工作方式，以及重点掌握2个特殊功能寄存器TMOD和TCON各位的定义及其编程，熟悉方波生成程序、定时程序的编程实现）   6.1 定时器&amp;amp;#x2F"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://ybjryz.github.io/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":4000,"accessToken":"","mailMd5":""},
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: ryz","link":"链接: ","source":"来源: ryz","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'ryz',
  title: '第六章',
  postAI: '',
  pageFillDescription: '第六章, 0.大纲, 6.1 定时器x2F计数器的结构, 6.1.1 工作方式控制寄存器TMOD, 6.1.2 定时器x2F计数器控制寄存器TCON, 6.2 定时器x2F计数器的4种工作方式, 6.2.1 方式0, （1）T1工作在方式0, 6.2.2 方式1, （2）T1工作在方式1, 6.2.3 方式2, （3）T1工作在方式2, 6.2.4 方式3, 1．工作方式3下的T0, （4）T1设置在方式3。, 6.3 对外部输入的计数信号的要求, 6.4 定时器x2F计数器的编程和应用, 6.4.1 P1口外接的8只LED每0.5s闪亮一次。, 6.4.2 计数器的应用, 6.4.3 扩展一个外部中断源, 6.4.4 P1.0上产生周期为2ms的方波, 6.4.5 P1.1上产生周期为1s的方波, 6.4.6 T1控制发出1KHz的音频信号, 6.4.7 测量脉冲宽度（门控位GATEx的应用）, 6.4.8 实时时钟的设计第六章大纲第六章单片机的定时器计数器了解单片机内定时器计数器的结构与功能种工作模式和种工作方式以及重点掌握个特殊功能寄存器和各位的定义及其编程熟悉方波生成程序定时程序的编程实现定时器计数器的结构的定时器计数器结构如图所示由特殊功能寄存器构成由特殊功能寄存器构成和都具有定时器和计数器两种工作模式种工作方式方式属于增计数器特殊功能寄存器用于选择的工作模式和工作方式特殊功能寄存器用于控制的启动和停止计数同时包含了的状态不论是工作在定时器模式还是计数器模式实质是对脉冲信号进行计数只不过计数信号的来源不同计数器模式是对加在和两个引脚上的外部脉冲进行计数见图定时器模式是对单片机的系统时钟信号经片内分频后的内部脉冲信号机器周期计数由于时钟频率是定值所以可根据对内部脉冲信号的计数值可计算出定时时间计数器的起始计数是从初值开始单片机复位时计数器初值为也可用指令给计数器装入一个新的初值的定时器计数器属于增计数器工作方式控制寄存器定时器的工作方式寄存器用于选择工作模式和工作方式字节地址为不能位寻址其格式如图所示位分为两组高位控制低位控制下面对的各位给出说明门控位时仅由运行控制位来控制定时器运行时用外中断引脚或上的电平与运行控制位共同控制定时器运行工作方式选择位的种编码对应于种工作方式的选择如表所示计数器模式和定时器模式选择位为定时器工作模式对单片机的晶体振荡器分频后的脉冲进行计数为计数器工作模式计数器对外部输入引脚或的外部脉冲负跳变计数定时器计数器控制寄存器字节地址为可位寻址位地址为格式如图所示第章介绍了与外部中断有关的低位这里仅介绍与定时器相关的高位功能计数溢出标志位当计数器计数溢出时该位置使用查询方式时此位作为状态位供查询但应注意查询有效后应使用软件及时将该位清使用中断方式时此位作为中断请求标志位进入中断服务程序后由硬件自动清计数运行控制位位或位启动定时器工作的必要条件位或位停止定时器工作该位可由软件置或清定时器计数器的种工作方式种工作方式分别介绍如下方式当为时定时器计数器被设置为工作方式这时定时器计数器的等效逻辑结构框图如图所示以定时器计数器为例方式时为位计数器由的低位和的高位构成低位溢出则向进位计数溢出则把中的溢出标志位置图中位控制的电子开关决定了定时器计数器的两种工作模式电子开关打在上面位置或为定时器工作模式把时钟振荡器分频后的脉冲作为计数信号电子开关打在下面位置或为计数器工作模式计数脉冲为或引脚上的外部输入脉冲当引脚上发生负跳变时计数器加位状态决定定时器的运行控制取决于一个条件还是取决于和引脚状态这两个条件时点见图电位恒为点电位仅取决于状态点为高电平控制端控制电子开关闭合允许或对脉冲计数点为低电平电子开关断开禁止或计数时点电位由的输入电平和的状态两个条件来定当且时点才为控制端控制电子开关闭合允许或计数故这种情况下计数器是否计数是由和两个条件来共同控制工作在方式的控制字中时工作在方式工作示意图如图所示方式当为时工作于方式方式的等效电路逻辑结构如图所示方式和方式的差别仅仅在于计数器的位数不同方式为位计数器由高位和低位构成方式则为位计数器有关控制状态位的含义与方式相同工作在方式当的控制字中时工作在方式工作示意图如图所示方式方式和方式的最大特点是计数溢出后计数器为全因此在循环定时或循环计数应用时就存在用指令反复装入计数初值的问题这不仅影响定时精度也给程序设计带来麻烦方式就是解决此问题而设置的当为时定时器计数器处于工作方式这时定时器计数器的等效逻辑结构如图所示以定时器为例定时器计数器的方式为自动恢复初值初值自动装入的位定时器计数器作为常数缓冲器当计数溢出时在溢出标志置的同时还自动将中的初值送至使从初值开始重新计数定时器计数器的方式工作过程如图所示此工作方式可省去用户软件中重装初值的指令的执行时间简化定时初值的计算方法可相当精确地确定定时时间工作在方式当的控制字中时的工作方式为方式工作示意图如图所示方式方式是为了增加一个附加的位定时器计数器而设置的从而使单片机具有个定时器计数器方式只适用于定时器计数器定时器计数器不能工作在方式处于方式时相当于停止计数此时可用来作为串行口波特率产生器工作方式下的当的低位为时的工作方式被选为方式各引脚与的逻辑关系如图所示分为两个独立的位计数器和使用的状态控制位而被固定为一个位定时器不能作为外部计数模式并使用的状态控制位和同时占用的中断请求源设置在方式当设置在方式时再把也设置成方式此时停止计数对外部输入的计数信号的要求当定时器计数器工作在计数器模式时计数脉冲来自外部输入引脚或当输入信号产生由至的跳变即负跳变时计数器值增每个机器周期的期间都对外部输入引脚或进行采样如在第一个机器周期中采得的值为而在下一个机器周期中采得的值为则在紧跟着的再下一个机器周期期间计数器加由于确认一次负跳变要花个机器周期即个振荡周期因此外部输入的计数脉冲的最高频率为系统振荡器频率的例如选用频率的晶体允许输入的脉冲频率最高为如果选用频率的晶体则可输入最高频率为的外部脉冲对于外部输入信号的占空比并没有什么限制但为了确保某一给定电平在变化之前能被采样一次则这一电平至少要保持一个机器周期故对外部输入信号的要求如图所示图中为机器周期定时器计数器的编程和应用在种工作方式中方式与方式基本相同只是计数器的计数位数不同方式为位计数器方式为位计数器由于方式是为兼容而设且其计数初值计算复杂所以在实际应用中一般不用方式而采用方式口外接的只每闪亮一次例在单片机的口上接有只电路见图下面采用定时器的方式的定时中断方式使口外接的只每闪亮一次设置寄存器定时器工作在方式应使寄存器的应设置为定时器工作模式对的运行控制仅由来控制应使定时器不使用各相关位均设为所以寄存器应初始化为计算计数初值设定时时间即设定时器的计数初值为假设晶振的频率为则定时时间为定时时间晶振频率则得转换成进制后为其中装入装入设置寄存器本例由于采用定时器中断因此需将寄存器中的位置启动和停止定时器将定时器控制寄存器中的则启动定时器则停止定时器定时参考程序如下给变量赋初值设置定时器为方式向写入初值的高位向写入初值的低位口只点亮总中断允许定时器中断允许启动定时器无穷循环等待定时中断以下为定时器的中断服务程序给装入位初值计个数后溢出循环次数减口按位取反重新设置循环次数计数器的应用例采用定时器的方式的中断计数方式如图所示计数输入引脚上外接开关作为计数信号输入按次后口的只闪烁不停设置寄存器工作在方式应使的设置计数器工作模式对的运行控制仅由来控制应使定时器不使用各相关位均设为所以寄存器应初始化为计算计数初值由于每按次计数一次因此计数器的初值为将其转换成进制后为因此设置寄存器本例由于采用定时器中断因此需将寄存器中的位置启动和停止定时器将定时器控制寄存器中的则启动定时器计数则停止定时器计数参考程序如下定义延时函数是形式参数不能赋初值变量由实际参数传入一个值因此不能赋初值空函数主函数设置定时器为方式计数向写入初值的高位向写入初值低位总中断允许中断允许启动无穷循环等待定时中断以下为定时器的中断服务程序无限循环位全灭延时位全亮延时扩展一个外部中断源方式可自动重新装载初值此方式可省去用户程序中重新装初值的指令当某个定时器计数器不使用时可为扩展一个负跳沿触发的外部中断源基本思想是把定时器溢出中断做成外部中断然后把计数输入信号接到定时器的相应引脚上脚或脚并把定时器被设置为方式自动装入常数方式计数工作模式计数器初值均为并允许中断总中断开放当检测到脚或脚引脚电平发生负跳变时计数器或溢出这时将产生一个中断请求例扩展一个负跳沿触发的外部中断源把定时器计数输入引脚作为外部中断请求信号的输入端设置定时器为方式计数给装入初值给装入初值允许中断总中断开中断溢出标志位清接通计数无限循环等待以下为定时器的中断服务程序外中断处理部分说明本例所述的使用定时器扩展的外中断源只能是负跳沿触发此外只有当定时器或不用的话才可使用本方法来扩充外部中断源此时定时器本身的功能将不能再使用除非使用软件来对它进行复用控制上产生周期为的方波例系统时钟为编程实现从引脚上输出一个周期为的方波如图所示基本思想要在上产生周期为的方波定时器应产生的周期性的定时定时对求反选择定时器方式定时采用中断方式不起作用计算的初值计算设的初值为则则初值为因此参考程序如下设置定时器为方式计数给装入初值给装入初值允许中断总中断开接通计数无限循环等待上产生周期为的方波例假设系统时钟为编程实现从引脚上输出一个周期为的方波基本思想要在上产生周期为的方波定时器应产生的周期性定时定时到则对求反由于定时时间较长用定时器不能直接实现直接定时时间最长的就是方式仅为系统时钟多一点实现定为定时每对求反一次输出的脉冲加到定时器的计数输入脚脚作为计数输入定时需计数次设为方式计数初值为则所以设为方式定时则控制字为定时器和均采用中断方式工作参考程序如下设置定时器为方式定时为方式计数给装初值给装初值总中断开允许中断允许中断脚产生的方波控制发出的音频信号例利用定时器的中断来控制蜂鸣器发出的音频信号电路图见图假设系统时钟为则每个脉冲的周期为的音频信号周期为因此要计数的脉冲数为次所以的初值参考程序如下总中断开允许中断设置定时器为方式定时给装初值测量脉冲宽度门控位的应用下面以定时器为例介绍门控制位的具体应用即测量或引脚上正脉冲的宽度例门控位可使的启动计数受的控制当时只有引脚输入高电平时才被允许计数利用的这一功能可测量引脚上正脉冲的宽度机器周期数利用门控制位测量引脚上正脉冲的宽度方法如图所示参考程序如下位变量定义定义计数变量用来读取定义计数变量用来读取读计数器函数设置定时器为方式定时向定时器写入计数初值等待变低如果为低启动未真正开始计数等待变高变高后真正开始计数等待变低变低后停止计数读计数寄存器内容的函数读取计数寄存器的内容读高字节读低字节可将两字节的机器周期数进行显示处理执行以上程序使引脚上出现的正脉冲宽度以机器周期数的形式读入到和两个单元中如果编写了显示程序可将其显示在显示器上实时时钟的设计本节介绍如何使用定时器计数器来实现实时时钟实时时钟就是以秒分时为单位计时计时的实现时钟最小计时单位是秒如何获得定时可将定时器的定时时间定为采用中断方式进行溢出次数的累计计满次则秒计数变量加若秒计满则分计数变量加同时将秒计数变量清若分钟计满则小时计数变量加若小时计数变量满则将小时计数变量清程序设计先将定时器以及各计数变量然后调用时间显示的子程序计时功能由定时器的中断服务子程序来实现参考程序如下定义中断次数计数变量秒计数变量分钟计数变量小时计数变量延时函数设置定时器为方式定时总中断开允许中断给装初值中断次数秒分时单元清显示秒的子程序此处没有编写显示延时显示分钟子程序此处没有编写显示延时显示小时子程序此处没有编写显示延时定时器中断服务子程序中断次数加若中断次数计满次中断次数变量清秒计数变量加若计满秒计数变量清分计数变量加若计满分分计数变量清小时计数变量加小时计数计满将小时计数变量清定时器重新赋值本例中的小时分钟秒的显示函数要根据显示器件显示电路来具体编写这里只给出函数名称',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-23 18:33:36',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/tx.png"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">ryz</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">音乐</div><span class="author-content-item-title">灵魂的碰撞💥</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>学校课程</span></a></span></div></div><h1 class="post-title" itemprop="name headline">第六章</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-12-23T08:32:18.473Z" title="发表于 2023-12-23 16:32:18">2023-12-23</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-12-23T10:33:36.305Z" title="更新于 2023-12-23 18:33:36">2023-12-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为重庆"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>重庆</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://ybjryz.github.io/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/"><header><a href="/tags/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/" tabindex="-1" itemprop="url">学校课程</a><h1 id="CrawlerTitle" itemprop="name headline">第六章</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">ryz</span><time itemprop="dateCreated datePublished" datetime="2023-12-23T08:32:18.473Z" title="发表于 2023-12-23 16:32:18">2023-12-23</time><time itemprop="dateCreated datePublished" datetime="2023-12-23T10:33:36.305Z" title="更新于 2023-12-23 18:33:36">2023-12-23</time></header><h1 id="第六章"><a href="#第六章" class="headerlink" title="第六章"></a>第六章</h1><h2 id="0-大纲"><a href="#0-大纲" class="headerlink" title="0.大纲"></a>0.大纲</h2><p>第六章  AT89S51单片机的定时器&#x2F;计数器（了解AT89S51单片机内定时器&#x2F;计数器的结构与功能，2种工作模式和4种工作方式，以及重点掌握2个特殊功能寄存器TMOD和TCON各位的定义及其编程，熟悉方波生成程序、定时程序的编程实现）</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223174619209.png" class="" title="image-20231223174619209">

<h2 id="6-1-定时器-计数器的结构"><a href="#6-1-定时器-计数器的结构" class="headerlink" title="6.1 定时器&#x2F;计数器的结构"></a>6.1 定时器&#x2F;计数器的结构</h2><p>  AT89S51的定时器&#x2F;计数器结构如图6-1所示，T0由特殊功能寄存器TH0、TL0构成，T1由特殊功能寄存器TH1、TL1构成。</p>
<p>  T0 和T1都具有定时器和计数器两种工作模式，4种工作方式（方式0~3）。属于增计数器。</p>
<p>  <strong>特殊功能寄存器TMOD</strong>用于选择T0、T1的工作模式和工作方式。<strong>特殊功能寄存器TCON</strong>用于控制T0、T1的启动和停止计数，同时包含了T0、T1的状态。T0、 T1不论是工作在定时器模式还是计数器模式，实质是对脉冲信号进行计数，只不过计数信号的来源不同。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223174655056.png" class="" title="image-20231223174655056">

<p>  计数器模式是对加在T0（P3.4）和T1（P3.5）两个引脚上的外部脉冲进行计数（见图6-1）</p>
<p>  定时器模式是对单片机的系统时钟信号经片内12分频后的内部脉冲信号（机器周期）计数。由于时钟频率是定值，所以可根据对内部脉冲信号的计数值可计算出定时时间。</p>
<p>  计数器的起始计数是从初值开始。单片机复位时计数器初值为0，也可用指令给计数器装入一个新的初值。AT89S51的定时器&#x2F;计数器属于增计数器。</p>
<h3 id="6-1-1-工作方式控制寄存器TMOD"><a href="#6-1-1-工作方式控制寄存器TMOD" class="headerlink" title="6.1.1 工作方式控制寄存器TMOD"></a>6.1.1 工作方式控制寄存器TMOD</h3><p>  AT89S51定时器的工作方式寄存器TMOD用于选择工作模式和工作方式，字节地址为89H，<strong>不能位寻址</strong>，其格式如 图6-2所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223174924524.png" class="" title="image-20231223174924524">

<p>位分为两组，高4位控制T1，低4位控制T0。</p>
<p>下面对TMOD的各位给出说明。</p>
<p>（1）GATE—门控位。</p>
<p>GATE&#x3D;0时，仅由运行控制位TRx（x &#x3D; 0，1）来控制定时器运行。</p>
<p>GATE&#x3D;1时，用外中断引脚INT0<em>（或INT1</em> ）上的电平与运行控制位TRx共同控制定时器运行。</p>
<p>（2）M1、M0—工作方式选择位。</p>
<p>M1、M0的4种编码，对应于4种工作方式的选择，如表6-1所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223174947589.png" class="" title="image-20231223174947589">

<p>（3）C&#x2F;T* —计数器模式和定时器模式选择位。</p>
<p>  C&#x2F;T*&#x3D;0，为定时器工作模式，对单片机的晶体振荡器12分频后的脉冲进行计数。</p>
<p>  C&#x2F;T*&#x3D;1，为计数器工作模式，计数器对外部输入引脚T0（P3.4）或T1（P3.5）的外部脉冲（负跳变）计数。</p>
<h3 id="6-1-2-定时器-计数器控制寄存器TCON"><a href="#6-1-2-定时器-计数器控制寄存器TCON" class="headerlink" title="6.1.2 定时器&#x2F;计数器控制寄存器TCON"></a>6.1.2 定时器&#x2F;计数器控制寄存器TCON</h3><p>  TCON字节地址为88H，可位寻址，位地址为88H～8FH，格式如图6-3所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223175120643.png" class="" title="image-20231223175120643">

<p>第5章介绍了与外部中断有关的低4位。这里仅介绍与定时器相关的高4位功能。</p>
<p>（1）TF1、TF0—计数溢出标志位。</p>
<p>  当计数器计数溢出时，该位置“1”。使用查询方式时，此位作为状态位供CPU查询，但应注意查询有效后，应使用软件及时将该位清“0”。使用中断方式时，此位作为中断请求标志位，进入中断服务程序后由硬件自动清“0”。</p>
<p>（2）TR1、TR0—计数运行控制位。</p>
<p>  TR1位（或TR0位）&#x3D;1，启动定时器工作的必要条件。</p>
<p>  TR1位（或TR0位）&#x3D;0，停止定时器工作。</p>
<p>该位可由软件置“1”或清“0”。</p>
<h2 id="6-2-定时器-计数器的4种工作方式"><a href="#6-2-定时器-计数器的4种工作方式" class="headerlink" title="6.2 定时器&#x2F;计数器的4种工作方式"></a>6.2 定时器&#x2F;计数器的4种工作方式</h2><p>  4种工作方式分别介绍如下。</p>
<h3 id="6-2-1-方式0"><a href="#6-2-1-方式0" class="headerlink" title="6.2.1 方式0"></a>6.2.1 方式0</h3><p>  当M1、M0为00时，定时器&#x2F;计数器被设置为工作方式0，这时定时器&#x2F;计数器的等效逻辑结构框图如图6-4所示（以定时器&#x2F;计数器T1为例，TMOD.5、TMOD.4 &#x3D; 00）。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223175345979.png" class="" title="image-20231223175345979">

<p>方式0时，为13位计数器，由TLx（x &#x3D; 0，1）的低5位和THx的高8位构成。TLx低5位溢出则向THx进位，THx计数溢出则把TCON中的溢出标志位TFx置“1”。</p>
<p>  图6-2中， C&#x2F;T*位控制的电子开关决定了定时器&#x2F;计数器的两种工作模式。</p>
<p>  （1）C&#x2F;T*&#x3D;0，电子开关打在上面位置，T1（或T0）为定时器工作模式，把时钟振荡器12分频后的脉冲作为计数信号。</p>
<p>  （2）C&#x2F;T*&#x3D;1，电子开关打在下面位置，T1（或T0）为计数器工作模式，计数脉冲为P3.4（或P3.5）引脚上的外部输入脉冲，当引脚上发生负跳变时，计数器加1。</p>
<p>GATE位状态决定定时器的运行控制取决于TRx一个条件，还是取决于TRx和INTX* （x &#x3D; 0，1）引脚状态这两个条件。</p>
<p>  （1）GATE&#x3D;0时，A点（见图6-4）电位恒为1，B点电位仅取决于TRx状态。TRx &#x3D; 1，B点为高电平，控制端控制电子开关闭合，允许T1（或T0）对脉冲计数。TRx &#x3D; 0，B点为低电平，电子开关断开，禁止T1（或T0）计数。</p>
<p>  （2）GATE&#x3D;1时，B点电位由INTX<em>（x &#x3D; 0，1）的输入电平和TRx的状态两个条件来定。当TRx&#x3D;1，且INTX</em>&#x3D;1时，B点才为1，控制端控制电子开关闭合，允许T1（或T0）计数。故这种情况下计数器是否计数是由TRx和INTX*两个条件来共同控制。</p>
<h4 id="（1）T1工作在方式0"><a href="#（1）T1工作在方式0" class="headerlink" title="（1）T1工作在方式0"></a>（1）T1工作在方式0</h4><p>T1的控制字中M1、M0 &#x3D; 00时，T1工作在方式0，工作示意图如图6-9所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223175713840.png" class="" title="image-20231223175713840">

<h3 id="6-2-2-方式1"><a href="#6-2-2-方式1" class="headerlink" title="6.2.2 方式1"></a>6.2.2 方式1</h3><p>  当M1、M0为01时，工作于方式1，方式1的等效电路逻辑结构如图6-5所示。</p>
<p>  方式1和方式0的差别仅仅在于计数器的位数不同，方式1为16位计数器，由THx高8位和TLx低8位构成（x &#x3D; 0，1），方式0则为13位计数器，有关控制状态位的含义（GATE、C&#x2F;T*、TFx、TRx）与方式0相同。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223175446813.png" class="" title="image-20231223175446813">

<h4 id="（2）T1工作在方式1"><a href="#（2）T1工作在方式1" class="headerlink" title="（2）T1工作在方式1"></a>（2）T1工作在方式1</h4><p>当T1的控制字中M1、M0 &#x3D; 01时，T1工作在方式1，工作示意图如图6-10所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223175930772.png" class="" title="image-20231223175930772">

<h3 id="6-2-3-方式2"><a href="#6-2-3-方式2" class="headerlink" title="6.2.3 方式2"></a>6.2.3 方式2</h3><p>  方式0和方式1的最大特点是<strong>计数溢出后，计数器为全0</strong>。因此在循环定时或循环计数应用时就存在用指令反复装入计数初值的问题。这不仅影响定时精度，也给程序设计带来麻烦。方式2就是解决此问题而设置的。</p>
<p>  当M1、M0为10时，定时器&#x2F;计数器处于工作方式2，这时定时器&#x2F;计数器的等效逻辑结构如图6-6所示（以定时器T1为例，x &#x3D; 1）。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223175526401.png" class="" title="image-20231223175526401">

<p>定时器&#x2F;计数器的方式2为自动恢复初值（初值自动装入）的8位定时器&#x2F;计数器，TLx（x &#x3D; 0，1）作为常数缓冲器，当TLx计数溢出时，在溢出标志TFx置“1”的同时，还自动将THx中的初值送至TLx，使TLx从初值开始重新计数。定时器&#x2F;计数器的方式2工作过程如图6-7所示。</p>
<p>  此工作方式可省去用户软件中重装初值的指令的执行时间，简化定时初值的计算方法，可相当精确地确定定时时间。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223175544841.png" class="" title="image-20231223175544841">

<h4 id="（3）T1工作在方式2"><a href="#（3）T1工作在方式2" class="headerlink" title="（3）T1工作在方式2"></a>（3）T1工作在方式2</h4><p>  当T1的控制字中M1、M0 &#x3D; 10时，T1的工作方式为方式2，工作示意图如图6-11所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223180009728.png" class="" title="image-20231223180009728">



<h3 id="6-2-4-方式3"><a href="#6-2-4-方式3" class="headerlink" title="6.2.4 方式3"></a>6.2.4 方式3</h3><p>  方式3是为了<strong>增加一个附加的8位定时器&#x2F;计数器</strong>而设置的，从而使AT89S51单片机具有3个定时器&#x2F;计数器。方式3只适用于定时器&#x2F;计数器T0，定时器&#x2F;计数器T1不能工作在方式3。<strong>T1处于方式3时相当于TR1 &#x3D; 0</strong>，停止计数（此时T1可用来作为串行口波特率产生器）。</p>
<h4 id="1．工作方式3下的T0"><a href="#1．工作方式3下的T0" class="headerlink" title="1．工作方式3下的T0"></a>1．工作方式3下的T0</h4><p>  当TMOD的低2位为11时，T0的工作方式被选为方式3，各引脚与T0的逻辑关系如图6-8所示。</p>
<p>  T0分为两个独立的8位计数器TL0和TH0，TL0使用T0的状态控制位C&#x2F;T*、GATE、TR0，而TH0被固定为一个8位定时器（不能作为外部计数模式），并使用T1的状态控制位TR1和TF1，同时占用T1的中断请求源TF1。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223175641519.png" class="" title="image-20231223175641519">

<h4 id="（4）T1设置在方式3。"><a href="#（4）T1设置在方式3。" class="headerlink" title="（4）T1设置在方式3。"></a>（4）T1设置在方式3。</h4><p>  当T0设置在方式3时，再把T1也设置成方式3，此时T1停止计数。</p>
<h2 id="6-3-对外部输入的计数信号的要求"><a href="#6-3-对外部输入的计数信号的要求" class="headerlink" title="6.3 对外部输入的计数信号的要求"></a>6.3 对外部输入的计数信号的要求</h2><p>  当定时器&#x2F;计数器工作在计数器模式时，计数脉冲来自外部输入引脚T0或T1。当输入信号产生由1至0的跳变（即负跳变）时，计数器值增1。每个机器周期的S5P2期间，都对外部输入引脚T0或T1进行采样。如在第一个机器周期中采得的值为1，而在下一个机器周期中采得的值为0，则在紧跟着的再下一个机器周期S3P1期间，计数器加1。</p>
<p>由于确认一次负跳变要花2个机器周期，即24个振荡周期，因此外部输入的计数脉冲的<strong>最高</strong>频率为系统振荡器频率的1&#x2F;24。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223180217090.png" class="" title="image-20231223180217090">

<p>例如，选用6MHz频率的晶体，允许输入的脉冲频率最高为250kHz。如果选用12MHz频率的晶体，则可输入最高频率为500kHz的外部脉冲。对于外部输入信号的占空比并没有什么限制，但为了确保某一给定电平在变化之前能被采样一次，则这一电平至少要保持一个机器周期。故对外部输入信号的要求如图6-12所示，图中Tcy为机器周期。</p>
<h2 id="6-4-定时器-计数器的编程和应用"><a href="#6-4-定时器-计数器的编程和应用" class="headerlink" title="6.4 定时器&#x2F;计数器的编程和应用"></a>6.4 定时器&#x2F;计数器的编程和应用</h2><p>  在4种工作方式中，方式0与方式1基本相同，只是计数器的计数位数不同。方式0为13位计数器，方式1为16位计数器。由于方式0是为兼容MCS-48而设，且其计数初值计算复杂，所以在实际应用中，一般不用方式0，而采用方式1。</p>
<h3 id="6-4-1-P1口外接的8只LED每0-5s闪亮一次。"><a href="#6-4-1-P1口外接的8只LED每0-5s闪亮一次。" class="headerlink" title="6.4.1 P1口外接的8只LED每0.5s闪亮一次。"></a>6.4.1 P1口外接的8只LED每0.5s闪亮一次。</h3><p>  【例6-1】在AT89S51单片机的P1口上接有8只LED（电路见图4-7）。下面采用定时器T0的方式1的定时中断方式，使P1口外接的8只LED每0.5s闪亮一次。</p>
<p>（1）设置TMOD寄存器</p>
<p>  定时器T0工作在方式1，应使TMOD寄存器的M1、M0&#x3D;01；应设置C&#x2F;&#x3D;0，为定时器工作模式；对T0的运行控制仅由TR0来控制，应使GATE0&#x3D;0。定时器T1不使用，各相关位均设为0。所以，TMOD寄存器应初始化为0x01。</p>
<p>（2）计算T0计数初值</p>
<p>  设定时时间5ms（即5000µs），设定时器T0的计数初值为X，假设晶振的频率为11.0592MHz，则定时时间为：定时时间&#x3D;(2^16−X)*12&#x2F;晶振频率</p>
<p>则5000&#x3D;(2^16 −X)*12&#x2F;11.0592</p>
<p>得：X &#x3D; 60928，</p>
<p>转换成16进制后为：0xee00，其中0xee装入TH0，0x00装入TL0。</p>
<p>（3）设置IE寄存器</p>
<p>  本例由于采用定时器T0中断，因此需将IE寄存器中的EA、ET0位置1。</p>
<p>（4）启动和停止定时器T0</p>
<p>  将定时器控制寄存器TCON中的TR0&#x3D;1，则启动定时器T0；TR0&#x3D;0，则停止定时器T0定时。</p>
<p>  参考程序如下：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg51.h></span></span>
Char i <span class="token operator">=</span> <span class="token number">100</span>； <span class="token comment">/*给变量i赋初值*/</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    TMOD <span class="token operator">=</span> <span class="token number">0x01</span>；    <span class="token comment">/*设置定时器T0为方式1*/</span>
        TH0 <span class="token operator">=</span> <span class="token number">0xee</span>； <span class="token comment">/*向TH0写入初值的高8位*/</span>
        TL0 <span class="token operator">=</span> <span class="token number">0x00</span>； <span class="token comment">/*向TL0写入初值的低8位*/</span>
        P1 <span class="token operator">=</span> <span class="token number">0x00</span>；  <span class="token comment">/*P1口8只LED点亮*/</span>
        EA <span class="token operator">=</span> <span class="token number">1</span>；     <span class="token comment">/*总中断允许*/</span>
        ET0 <span class="token operator">=</span> <span class="token number">1</span>；    <span class="token comment">/*定时器T0中断允许*/</span>
        TR0 <span class="token operator">=</span> <span class="token number">1</span>；    <span class="token comment">/*启动定时器T0*/</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> ； <span class="token comment">/*无穷循环，等待定时中断*/</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*以下为定时器T0的中断服务程序*/</span>
<span class="token keyword">void</span> <span class="token function">T0_int</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> interrupt <span class="token number">1</span>
<span class="token punctuation">&#123;</span>
    TH0 <span class="token operator">=</span> <span class="token number">0xee</span>；           <span class="token comment">/*给T0装入16位初值，计4608个数后，T0溢出*/</span>
        TL0 <span class="token operator">=</span> <span class="token number">0x00</span>； 
        i<span class="token operator">--</span>； <span class="token comment">/*循环次数减1*/</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        P1 <span class="token operator">=</span> <span class="token operator">~</span>P1；         <span class="token comment">/*P1口按位取反*/</span>
        i <span class="token operator">=</span> <span class="token number">100</span>； <span class="token comment">/*重新设置循环次数*/</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="6-4-2-计数器的应用"><a href="#6-4-2-计数器的应用" class="headerlink" title="6.4.2 计数器的应用"></a>6.4.2 计数器的应用</h3><p>  【例6-2】 采用定时器T1的方式1的中断计数方式，如图6-13所示，计数输入引脚T1（P3.5）上外接开关K1，作为计数信号输入。按4次K1后，P1口的8只LED闪烁不停。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223181504032.png" class="" title="image-20231223181504032">

<p>（1）设置TMOD寄存器</p>
<p>  T1工作在方式1，应使TMOD的M1、M0&#x3D;01；设置计数器工作模式C&#x2F;T*&#x3D;1；对T0的运行控制仅由TR0来控制，应使GATE0&#x3D;0。定时器T0不使用，各相关位均设为0。所以，TMOD寄存器应初始化为0x50。</p>
<p>（2）计算T1计数初值</p>
<p>  由于每按4次K1，计数一次，因此计数器的初值为65536(2^16)-4&#x3D;65532，将其转换成16进制后为：0xfffc，因此，TH0&#x3D;0xff，TL0&#x3D;0xfc。</p>
<p>（3）设置IE寄存器</p>
<p>  本例由于采用定时器T1中断，因此需将IE寄存器中的EA、ET1位置1。</p>
<p>（4）启动和停止定时器T1</p>
<p>  将定时器控制寄存器TCON中的TR1&#x3D;1，则启动定时器T1计数；TR1&#x3D;0，则停止定时器T1计数。</p>
<p>  参考程序如下：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg51.h></span></span>
<span class="token keyword">void</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token comment">/* 定义延时函数Delay( )，i是形式参数，不能赋初值*/</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> j； <span class="token keyword">for</span> <span class="token punctuation">(</span>；i <span class="token operator">></span> <span class="token number">0</span>；i <span class="token operator">--</span><span class="token punctuation">)</span> <span class="token comment">/* 变量i由实际参数传入一个值，因此i不能赋初值*/</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span>；j <span class="token operator">&lt;</span> <span class="token number">125</span>；j <span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        ；
    <span class="token punctuation">&#125;</span> <span class="token comment">/*空函数*/</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/*主函数*/</span>
<span class="token punctuation">&#123;</span>
    TMOD <span class="token operator">=</span> <span class="token number">0x50</span>；    <span class="token comment">/*设置定时器T1为方式1计数*/</span>
        TH0 <span class="token operator">=</span> <span class="token number">0xff</span>； <span class="token comment">/*向TH0写入初值的高8位*/</span>
        TL0 <span class="token operator">=</span> <span class="token number">0xfc</span>； <span class="token comment">/*向TL0写入初值低8位*/</span>
        EA <span class="token operator">=</span> <span class="token number">1</span>；     <span class="token comment">/*总中断允许*/</span>
        ET1 <span class="token operator">=</span> <span class="token number">1</span>；    <span class="token comment">/*T1中断允许*/</span>
        TR1 <span class="token operator">=</span> <span class="token number">1</span>；    <span class="token comment">/*启动T1*/</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> ； <span class="token comment">/*无穷循环，等待定时中断*/</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*以下为定时器T1的中断服务程序*/</span>
<span class="token keyword">void</span> <span class="token function">T1_int</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> interrupt <span class="token number">3</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>；；<span class="token punctuation">)</span> <span class="token comment">/*无限循环*/</span>
    <span class="token punctuation">&#123;</span>
        P1 <span class="token operator">=</span> <span class="token number">0xff</span>；       <span class="token comment">/*8位LED全灭*/</span>
            <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> ； <span class="token comment">/*延时500ms*/</span>
            P1 <span class="token operator">=</span> <span class="token number">0</span>；      <span class="token comment">/*8位LED全亮*/</span>
            <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>；
    <span class="token punctuation">&#125;</span> <span class="token comment">/*延时500ms */</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="6-4-3-扩展一个外部中断源"><a href="#6-4-3-扩展一个外部中断源" class="headerlink" title="6.4.3 扩展一个外部中断源"></a>6.4.3 扩展一个外部中断源</h3><p>  方式2可自动重新装载初值。此方式可省去用户程序中重新装初值的指令。</p>
<p>  当某个定时器&#x2F;计数器不使用时，可为AT89S51扩展一个负跳沿触发的外部中断源。</p>
<p>  基本思想是把定时器溢出中断做成外部中断，然后把计数输入信号接到定时器的相应引脚上T0脚（或T1脚），并把定时器被设置为方式2（自动装入常数方式）计数工作模式，计数器TH0、TL0初值均为0FFH，并允许T0中断，总中断开放。当检测到T0脚（或T1脚）引脚电平发生负跳变时，计数器TF0(或TF1)溢出，这时将产生一个中断请求。</p>
<p>  【例6-3】扩展一个负跳沿触发的外部中断源，把定时器T0计数输入引脚作为外部中断请求信号的输入端。</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg51.h></span></span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
   			 ……… 
        TMOD <span class="token operator">=</span> <span class="token number">0x06</span>； <span class="token comment">/*设置定时器T0为方式2计数*/</span>
        TH0 <span class="token operator">=</span> <span class="token number">0xff</span>；  <span class="token comment">/*给T0装入初值*/</span>
        TL0 <span class="token operator">=</span> <span class="token number">0xff</span>；  <span class="token comment">/*给T0装入初值*/</span>
        ET0 <span class="token operator">=</span> <span class="token number">1</span>；     <span class="token comment">/*允许T0中断*/</span>
        EA <span class="token operator">=</span> <span class="token number">1</span>；      <span class="token comment">/*总中断开*/</span>
        TF0 <span class="token operator">=</span> <span class="token number">0</span>；     <span class="token comment">/*T0中断溢出标志位清0*/</span>
        TR0 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>       <span class="token comment">/*接通T0 计数*/</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">/*无限循环等待* /
&#125;
  /*以下为定时器T0的中断服务程序*/</span>
        <span class="token keyword">void</span> <span class="token function">T0_int</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> interrupt <span class="token number">1</span> using <span class="token number">0</span>
    <span class="token punctuation">&#123;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">/*外中断处理部分*/</span>
</code></pre>

<p>  说明：本例所述的使用定时器扩展的外中断源只能是负跳沿触发。此外，只有当定时器T0（或T1）不用的话，才可使用本方法来扩充外部中断源，此时定时器T0本身的功能将不能再使用，除非使用软件来对它进行复用控制。</p>
<h3 id="6-4-4-P1-0上产生周期为2ms的方波"><a href="#6-4-4-P1-0上产生周期为2ms的方波" class="headerlink" title="6.4.4 P1.0上产生周期为2ms的方波"></a>6.4.4 P1.0上产生周期为2ms的方波</h3><p>  【例6-4】系统时钟为12MHz，编程实现从P1.0引脚上输出一个周期为2ms的方波，如图6-14所示</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223182321190.png" class="" title="image-20231223182321190">

<p>基本思想：要在P1.0上产生周期为2ms的方波，定时器应产生1ms的周期性的定时，定时对P1.0求反。选择定时器T0，方式1定时，采用中断方式，GATE不起作用。</p>
<p>  计算T0的初值计算：</p>
<p>  设T0的初值为X，则</p>
<p>​    (2^16 − X) * 1 * 10^(−6) &#x3D; 1*10^(−3)&#x3D; 65536−X &#x3D;1000</p>
<p>  则初值为：65536−1000&#x3D;64536，</p>
<p>因此</p>
<p>  TH0&#x3D;(65536 −1000) &#x2F;256 ，TL0&#x3D;(65536 −1000) %256。</p>
<p>  参考程序如下：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg51.h></span></span>
sbit P1_0 <span class="token operator">=</span> P1 <span class="token operator">^</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    TMOD <span class="token operator">=</span> <span class="token number">0x01</span>； <span class="token comment">/*设置定时器T0为方式2计数*/</span>
        P1_0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    TH0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">256</span>；       <span class="token comment">/*给T0装入初值*/</span>
          TL0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>； <span class="token comment">/*给T0装入初值*/</span>
                ET0 <span class="token operator">=</span> <span class="token number">1</span>；             <span class="token comment">/* 允许T0中断 */</span>
        EA <span class="token operator">=</span> <span class="token number">1</span>；                      <span class="token comment">/* 总中断开 */</span>
        TR0 <span class="token operator">=</span> <span class="token number">1</span>                       <span class="token comment">/* 接通T0 计数 */</span>
        <span class="token keyword">do</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 无限循环等待 */</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">T0_int</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> interrupt <span class="token number">1</span> using <span class="token number">1</span>
<span class="token punctuation">&#123;</span>
    P1_0 <span class="token operator">=</span> <span class="token operator">!</span>P1_0<span class="token punctuation">;</span>
    TH0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">256</span>； TL0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>；
<span class="token punctuation">&#125;</span>
</code></pre>

<h3 id="6-4-5-P1-1上产生周期为1s的方波"><a href="#6-4-5-P1-1上产生周期为1s的方波" class="headerlink" title="6.4.5 P1.1上产生周期为1s的方波"></a>6.4.5 P1.1上产生周期为1s的方波</h3><p>  【例6-5】假设系统时钟为12MHz，编程实现从P1.1引脚上输出一个周期为1s的方波。</p>
<p>  基本思想：要在P1.0上产生周期为1s的方波，定时器应产生500ms的周期性定时，定时到则对P1.0求反。由于定时时间较长，用定时器不能直接实现，直接定时时间最长的就是方式1，仅为65ms(系统时钟12MHz)多一点。</p>
<p>  实现：T0定为10ms定时，每10ms对P1.0求反一次，P1.0输出的脉冲加到定时器T1的计数输入脚P3.5（T1脚），作为计数输入，定时500ms需计数50次。T1设为方式2计数，初值X为：28−X&#x3D;50，则X&#x3D;206，所以TH1&#x3D; TL1&#x3D;206。T0设为方式1定时，则控制字为61H。定时器T0和T1均采用中断方式工作。</p>
<p>参考程序如下：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg51.h></span></span>
sbit P1_0 <span class="token operator">=</span> P1 <span class="token operator">^</span> <span class="token number">0</span><span class="token punctuation">;</span>
sbit P1_1 <span class="token operator">=</span> P1 <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    TMOD <span class="token operator">=</span> <span class="token number">0x61</span>； <span class="token comment">/*设置定时器T0为方式1定时，T1为方式2计数*/</span>
        P1_0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    TH0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">10000</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">256</span>；                   <span class="token comment">/*给T0装初值*/</span>
          TL0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">10000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>； TH1 <span class="token operator">=</span> <span class="token number">206</span>； <span class="token comment">/*给T1装初值*/</span>
        TL1 <span class="token operator">=</span> <span class="token number">206</span>； EA <span class="token operator">=</span> <span class="token number">1</span>；                       <span class="token comment">/* 总中断开 */</span>
        ET0 <span class="token operator">=</span> <span class="token number">1</span>；                                  <span class="token comment">/* 允许T0中断 */</span>
        ET1 <span class="token operator">=</span> <span class="token number">1</span>；                                  <span class="token comment">/* 允许T1中断 */</span>
        TR0 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    TR1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">T0_int</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> interrupt <span class="token number">1</span>
<span class="token punctuation">&#123;</span>
    TH0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">256</span>； TL0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>； P1_0 <span class="token operator">=</span> <span class="token operator">!</span>P1_0<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">T1_int</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> interrupt <span class="token number">3</span>
<span class="token punctuation">&#123;</span>
    P1_1 <span class="token operator">=</span> <span class="token operator">!</span>P1_1<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
； <span class="token comment">/* P1.1脚产生1s的方波*/</span> 。
</code></pre>

<h3 id="6-4-6-T1控制发出1KHz的音频信号"><a href="#6-4-6-T1控制发出1KHz的音频信号" class="headerlink" title="6.4.6 T1控制发出1KHz的音频信号"></a>6.4.6 T1控制发出1KHz的音频信号</h3><p>【例6-6】 利用定时器T1的中断来控制蜂鸣器发出1KHz的音频信号，电路图见图6-15。</p>
<p>假设系统时钟为11.0592MHz，则每个脉冲的周期为12&#x2F;11.0592&#x3D;1.085µs。1KHz的音频信号周期为1ms，因此要计数的脉冲数为1000&#x2F;1.085&#x3D;921次。所以T1的初值：</p>
<p>​    TH1&#x3D;(65536 −921) &#x2F;256；TL1&#x3D;(65536 −921) %256       </p>
<p>参考程序如下：</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223182920548.png" class="" title="image-20231223182920548">

<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg51.h></span></span>
sbit P1_0 <span class="token operator">=</span> P1 <span class="token operator">^</span> <span class="token number">0</span><span class="token punctuation">;</span>
sbit sound <span class="token operator">=</span> P1 <span class="token operator">^</span> <span class="token number">7</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    EA <span class="token operator">=</span> <span class="token number">1</span>；          <span class="token comment">/* 总中断开 */</span>
        ET1 <span class="token operator">=</span> <span class="token number">1</span>；     <span class="token comment">/* 允许T0中断 */</span>
        TMOD <span class="token operator">=</span> <span class="token number">0x10</span>； <span class="token comment">/*设置定时器T1为方式1定时*/</span>
        P1_0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    TH1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">921</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">256</span>； <span class="token comment">/*给T1装初值*/</span>
          TL1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">921</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>； TR1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">T1_int</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> interrupt <span class="token number">3</span> using0
<span class="token punctuation">&#123;</span>
    sound <span class="token operator">=</span>～sound<span class="token punctuation">;</span>
    TH1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">921</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">256</span>； TL1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">921</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>；
<span class="token punctuation">&#125;</span>
</code></pre>

<h3 id="6-4-7-测量脉冲宽度（门控位GATEx的应用）"><a href="#6-4-7-测量脉冲宽度（门控位GATEx的应用）" class="headerlink" title="6.4.7 测量脉冲宽度（门控位GATEx的应用）"></a>6.4.7 测量脉冲宽度（门控位GATEx的应用）</h3><p>  下面以定时器T1为例，介绍门控制位GATE的具体应用，即测量INT0<em>（或INT1</em> ）引脚上正脉冲的宽度。</p>
<p>  【例6-7】 门控位GATE1可使T1的启动计数受的控制，当GATE1&#x3D;1，TR1&#x3D;1时，只有引脚INT1<em>输入高电平时，T1才被允许计数。利用GATE1的这一功能，可测量引脚INT1</em>（P3.3）上正脉冲的宽度（机器周期数），利用门控制位GATE1，测量引脚INT1*上正脉冲的宽度。方法如图6-16所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/image-20231223183024935.png" class="" title="image-20231223183024935">

<p>参考程序如下：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg51.h></span></span>
sbit P3_3 <span class="token operator">=</span> P3 <span class="token operator">^</span> <span class="token number">3</span>；              <span class="token comment">/* 位变量定义*/</span>
            <span class="token keyword">unsigned</span> count_high； <span class="token comment">/* 定义计数变量，用来读取TH0*/</span>
            <span class="token keyword">unsigned</span> count_low；  <span class="token comment">/* 定义计数变量，用来读取TL0*/</span>
            <span class="token keyword">void</span> read_
            <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> ； <span class="token comment">/* 读计数器函数*/</span>
            <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    TMOD <span class="token operator">=</span> <span class="token number">0x90</span>；                              <span class="token comment">/*设置定时器T1为方式1定时*/</span>
        TH1 <span class="token operator">=</span> <span class="token number">0</span>；                              <span class="token comment">/*向定时器T1写入计数初值*/</span>
        TL1 <span class="token operator">=</span> <span class="token number">0</span>； TR1 <span class="token operator">=</span> <span class="token number">1</span>； <span class="token keyword">while</span> <span class="token punctuation">(</span>P3_3 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 等待变低*/</span>
    TR1 <span class="token operator">=</span> <span class="token number">1</span>；                                  <span class="token comment">/* 如果为低，启动T1(未真正开始计数)*/</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>P3_3 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment">/* 等待变高，变高后T1真正开始计数*/</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>P3_3 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>                   <span class="token comment">/* 等待变低，变低后T1停止计数*/</span>
    TR1 <span class="token operator">=</span> <span class="token number">0</span>； read_ <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/* 读计数寄存器内容的函数*/</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> read_ <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/* 读取计数寄存器的内容*/</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">do</span>
    <span class="token punctuation">&#123;</span>
        count_high <span class="token operator">=</span> TH1； <span class="token comment">/* 读高字节*/</span>
            count_low <span class="token operator">=</span> TL1； <span class="token comment">/* 读低字节*/</span>
………                       <span class="token comment">/* 可将两字节的机器周期数进行显示处理*/</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>count_high <span class="token operator">!=</span> TH1<span class="token punctuation">)</span>；
<span class="token punctuation">&#125;</span>
</code></pre>

<p>执行以上程序，使引脚上出现的正脉冲宽度以机器周期数的形式读入到count_high 和count_low两个单元中，如果编写了显示程序，可将其显示在显示器上。</p>
<h3 id="6-4-8-实时时钟的设计"><a href="#6-4-8-实时时钟的设计" class="headerlink" title="6.4.8 实时时钟的设计"></a>6.4.8 实时时钟的设计</h3><p>  本节介绍如何使用定时器&#x2F;计数器来实现实时时钟。实时时钟就是以秒、分、时为单位计时。</p>
<p>1．计时的实现</p>
<p>  时钟最小计时单位是秒，如何获得1s定时？可将定时器T0的定时时间定为50ms，采用中断方式进行溢出次数的累计，计满20次，则秒计数变量s加1；若秒计满60，则分计数变量m加1，同时将秒计数变量s清0；若分钟计满60，则小时计数。变量h加1；若小时计数变量满24，则将小时计数变量清0。</p>
<p>2．程序设计</p>
<p> 先将定时器以及各计数变量，然后调用时间显示的子程序。计时功能由定时器T0的中断服务子程序来实现。</p>
<p>  参考程序如下：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;reg51.h></span></span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> int_time；	<span class="token comment">/*定义中断次数计数变量*/</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> second；	<span class="token comment">/*秒计数变量*/</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> minute；	<span class="token comment">/*分钟计数变量*/</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> hour；		<span class="token comment">/*小时计数变量*/</span>
<span class="token keyword">void</span>  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">)</span> ；		<span class="token comment">/*延时函数*/</span>
<span class="token punctuation">&#123;</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> j；
<span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">200</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>					
<span class="token punctuation">&#123;</span>	TMOD<span class="token operator">=</span><span class="token number">0x01</span>；			<span class="token comment">/*设置定时器T0为方式1定时*/</span>
	EA<span class="token operator">=</span><span class="token number">1</span>；            		<span class="token comment">/* 总中断开 */</span>
	ET0<span class="token operator">=</span><span class="token number">1</span>； 			<span class="token comment">/* 允许T0中断 */</span>
	TH0<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">46483</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">256</span>；	<span class="token comment">/*给T0装初值*/</span>
	TL0<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">46483</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">256</span>；
	TR0<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	int_time<span class="token operator">=</span><span class="token number">0</span>；		<span class="token comment">/*中断次数、秒、分、时单元清0*/</span>
	second<span class="token operator">=</span><span class="token number">0</span>；
	minute<span class="token operator">=</span><span class="token number">0</span>；
	hour<span class="token operator">=</span><span class="token number">0</span>；
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">&#123;</span>	<span class="token function">DisplaySecond</span><span class="token punctuation">(</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">/*显示秒的子程序，此处没有编写*/</span>
	<span class="token function">delay</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">/*显示延时*/</span>
<span class="token function">DisplayMinute</span> <span class="token punctuation">(</span>minute<span class="token punctuation">)</span>	<span class="token punctuation">;</span>	<span class="token comment">/*显示分钟子程序，此处没有编写*/</span>
<span class="token function">delay</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 			<span class="token comment">/*显示延时*/</span>
<span class="token function">DisplayHour</span> <span class="token punctuation">(</span>hour<span class="token punctuation">)</span>	<span class="token punctuation">;</span> 	<span class="token comment">/*显示小时子程序，此处没有编写*/</span>
<span class="token function">delay</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">/*显示延时*/</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">void</span>  <span class="token function">T0_interserve</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>  interrupt <span class="token number">1</span>  using1 <span class="token comment">/*定时器T0中断服务子程序*/</span>
<span class="token punctuation">&#123;</span>	int_time<span class="token operator">++</span><span class="token punctuation">;</span>			<span class="token comment">/*中断次数加1*/</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>int_time<span class="token operator">==</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 		<span class="token comment">/*若中断次数计满20次*/</span>
	<span class="token punctuation">&#123;</span> int_time<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 			<span class="token comment">/*中断次数变量清0*/</span>
	second<span class="token operator">++</span><span class="token punctuation">;</span>			<span class="token comment">/*秒计数变量加 1*/</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>second<span class="token operator">==</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">/*若计满60s*/</span>
	<span class="token punctuation">&#123;</span> second<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 			<span class="token comment">/*秒计数变量清0*/</span>
	minute<span class="token operator">++</span><span class="token punctuation">;</span>			<span class="token comment">/*分计数变量加 1*/</span>
	<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>minute<span class="token operator">==</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 			<span class="token comment">/*若计满60分*/</span>
<span class="token punctuation">&#123;</span>   minute<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>			<span class="token comment">/*分计数变量清0*/</span>
	hour<span class="token operator">++</span><span class="token punctuation">;</span>			<span class="token comment">/*小时计数变量加1*/</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>hour<span class="token operator">==</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#123;</span> 	hour<span class="token operator">++</span><span class="token punctuation">;</span>			<span class="token comment">/*小时计数计满24，将小时计数变量清0*/</span>
	<span class="token punctuation">&#125;</span>
	TH0<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">46083</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">256</span>；	<span class="token comment">/*定时器T0重新赋值*/</span>
	TL0<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">65536</span> −<span class="token number">46083</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">256</span>；
<span class="token punctuation">&#125;</span>
</code></pre>

<p>本例中的小时、分钟、秒的显示函数，要根据显示器件、显示电路来具体编写，这里只给出函数名称。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/tx.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/tx.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">ryz</div><div class="post-copyright__author_desc">生活就是白云苍狗</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://ybjryz.github.io/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://ybjryz.github.io/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/')">第六章</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://ybjryz.github.io/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=第六章&amp;url=http://ybjryz.github.io/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://ybjryz.github.io" target="_blank">ryz</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>学校课程<span class="tagsPageCount">4</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/img/tx.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2023/12/17/ICT/%E5%85%B6%E4%BB%96%E6%A8%A1%E6%8B%9F%E5%99%A8/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">其他模拟器</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2023/12/10/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%8C%E7%AB%A0/" title="第二章"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-10</div><div class="title">第二章</div></div></a></div><div><a href="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%9B%9B%E7%AB%A0/" title="第四章"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-16</div><div class="title">第四章</div></div></a></div><div><a href="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/" title="第五章"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-16</div><div class="title">第五章</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/tx.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2021/01/15/752a5d910377a.png" ait="status"/></div></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0"><span class="toc-number">1.</span> <span class="toc-text">第六章</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0-%E5%A4%A7%E7%BA%B2"><span class="toc-number">1.1.</span> <span class="toc-text">0.大纲</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%AE%9A%E6%97%B6%E5%99%A8-%E8%AE%A1%E6%95%B0%E5%99%A8%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">6.1 定时器&#x2F;计数器的结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-1-%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F%E6%8E%A7%E5%88%B6%E5%AF%84%E5%AD%98%E5%99%A8TMOD"><span class="toc-number">1.2.1.</span> <span class="toc-text">6.1.1 工作方式控制寄存器TMOD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-2-%E5%AE%9A%E6%97%B6%E5%99%A8-%E8%AE%A1%E6%95%B0%E5%99%A8%E6%8E%A7%E5%88%B6%E5%AF%84%E5%AD%98%E5%99%A8TCON"><span class="toc-number">1.2.2.</span> <span class="toc-text">6.1.2 定时器&#x2F;计数器控制寄存器TCON</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E5%AE%9A%E6%97%B6%E5%99%A8-%E8%AE%A1%E6%95%B0%E5%99%A8%E7%9A%844%E7%A7%8D%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">6.2 定时器&#x2F;计数器的4种工作方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1-%E6%96%B9%E5%BC%8F0"><span class="toc-number">1.3.1.</span> <span class="toc-text">6.2.1 方式0</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89T1%E5%B7%A5%E4%BD%9C%E5%9C%A8%E6%96%B9%E5%BC%8F0"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">（1）T1工作在方式0</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-2-%E6%96%B9%E5%BC%8F1"><span class="toc-number">1.3.2.</span> <span class="toc-text">6.2.2 方式1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89T1%E5%B7%A5%E4%BD%9C%E5%9C%A8%E6%96%B9%E5%BC%8F1"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">（2）T1工作在方式1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-3-%E6%96%B9%E5%BC%8F2"><span class="toc-number">1.3.3.</span> <span class="toc-text">6.2.3 方式2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89T1%E5%B7%A5%E4%BD%9C%E5%9C%A8%E6%96%B9%E5%BC%8F2"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">（3）T1工作在方式2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-4-%E6%96%B9%E5%BC%8F3"><span class="toc-number">1.3.4.</span> <span class="toc-text">6.2.4 方式3</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%8E%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F3%E4%B8%8B%E7%9A%84T0"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">1．工作方式3下的T0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%884%EF%BC%89T1%E8%AE%BE%E7%BD%AE%E5%9C%A8%E6%96%B9%E5%BC%8F3%E3%80%82"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">（4）T1设置在方式3。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E5%AF%B9%E5%A4%96%E9%83%A8%E8%BE%93%E5%85%A5%E7%9A%84%E8%AE%A1%E6%95%B0%E4%BF%A1%E5%8F%B7%E7%9A%84%E8%A6%81%E6%B1%82"><span class="toc-number">1.4.</span> <span class="toc-text">6.3 对外部输入的计数信号的要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-%E5%AE%9A%E6%97%B6%E5%99%A8-%E8%AE%A1%E6%95%B0%E5%99%A8%E7%9A%84%E7%BC%96%E7%A8%8B%E5%92%8C%E5%BA%94%E7%94%A8"><span class="toc-number">1.5.</span> <span class="toc-text">6.4 定时器&#x2F;计数器的编程和应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-1-P1%E5%8F%A3%E5%A4%96%E6%8E%A5%E7%9A%848%E5%8F%AALED%E6%AF%8F0-5s%E9%97%AA%E4%BA%AE%E4%B8%80%E6%AC%A1%E3%80%82"><span class="toc-number">1.5.1.</span> <span class="toc-text">6.4.1 P1口外接的8只LED每0.5s闪亮一次。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-2-%E8%AE%A1%E6%95%B0%E5%99%A8%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.5.2.</span> <span class="toc-text">6.4.2 计数器的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-3-%E6%89%A9%E5%B1%95%E4%B8%80%E4%B8%AA%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD%E6%BA%90"><span class="toc-number">1.5.3.</span> <span class="toc-text">6.4.3 扩展一个外部中断源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-4-P1-0%E4%B8%8A%E4%BA%A7%E7%94%9F%E5%91%A8%E6%9C%9F%E4%B8%BA2ms%E7%9A%84%E6%96%B9%E6%B3%A2"><span class="toc-number">1.5.4.</span> <span class="toc-text">6.4.4 P1.0上产生周期为2ms的方波</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-5-P1-1%E4%B8%8A%E4%BA%A7%E7%94%9F%E5%91%A8%E6%9C%9F%E4%B8%BA1s%E7%9A%84%E6%96%B9%E6%B3%A2"><span class="toc-number">1.5.5.</span> <span class="toc-text">6.4.5 P1.1上产生周期为1s的方波</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-6-T1%E6%8E%A7%E5%88%B6%E5%8F%91%E5%87%BA1KHz%E7%9A%84%E9%9F%B3%E9%A2%91%E4%BF%A1%E5%8F%B7"><span class="toc-number">1.5.6.</span> <span class="toc-text">6.4.6 T1控制发出1KHz的音频信号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-7-%E6%B5%8B%E9%87%8F%E8%84%89%E5%86%B2%E5%AE%BD%E5%BA%A6%EF%BC%88%E9%97%A8%E6%8E%A7%E4%BD%8DGATEx%E7%9A%84%E5%BA%94%E7%94%A8%EF%BC%89"><span class="toc-number">1.5.7.</span> <span class="toc-text">6.4.7 测量脉冲宽度（门控位GATEx的应用）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-8-%E5%AE%9E%E6%97%B6%E6%97%B6%E9%92%9F%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.5.8.</span> <span class="toc-text">6.4.8 实时时钟的设计</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/" title="第六章">第六章</a><time datetime="2023-12-23T08:32:18.473Z" title="发表于 2023-12-23 16:32:18">2023-12-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/17/ICT/%E5%85%B6%E4%BB%96%E6%A8%A1%E6%8B%9F%E5%99%A8/" title="其他模拟器">其他模拟器</a><time datetime="2023-12-17T01:00:00.000Z" title="发表于 2023-12-17 09:00:00">2023-12-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/17/ICT/%E7%BD%91%E7%BB%9C%E5%87%86%E5%85%A5%E6%8E%A7%E5%88%B6/" title="网络准入控制">网络准入控制</a><time datetime="2023-12-17T01:00:00.000Z" title="发表于 2023-12-17 09:00:00">2023-12-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%9B%9B%E7%AB%A0/" title="第四章">第四章</a><time datetime="2023-12-16T09:07:00.000Z" title="发表于 2023-12-16 17:07:00">2023-12-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/" title="第五章">第五章</a><time datetime="2023-12-16T09:07:00.000Z" title="发表于 2023-12-16 17:07:00">2023-12-16</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2023 By <a class="footer-bar-link" href="/" title="ryz" target="_blank">ryz</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">54</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/ICT/" style="font-size: 0.88rem;">ICT<sup>13</sup></a><a href="/tags/WEB-Trojans/" style="font-size: 0.88rem;">WEB-Trojans<sup>1</sup></a><a href="/tags/code/" style="font-size: 0.88rem;">code<sup>1</sup></a><a href="/tags/ctf/" style="font-size: 0.88rem;">ctf<sup>1</sup></a><a href="/tags/tools/" style="font-size: 0.88rem;">tools<sup>1</sup></a><a href="/tags/typora/" style="font-size: 0.88rem;">typora<sup>1</sup></a><a href="/tags/web-tools/" style="font-size: 0.88rem;">web-tools<sup>1</sup></a><a href="/tags/web%E5%90%8E%E7%AB%AF%E6%BC%8F%E6%B4%9E/" style="font-size: 0.88rem;">web后端漏洞<sup>1</sup></a><a href="/tags/web%E6%BC%8F%E6%B4%9E/" style="font-size: 0.88rem;">web漏洞<sup>1</sup></a><a href="/tags/web%E6%BC%8F%E6%B4%9E%E5%AE%9E%E9%AA%8C/" style="font-size: 0.88rem;">web漏洞实验<sup>14</sup></a><a href="/tags/%E4%BB%A3%E5%8A%9E/" style="font-size: 0.88rem;">代办<sup>1</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2%E4%BC%98%E5%8C%96/" style="font-size: 0.88rem;">博客优化<sup>1</sup></a><a href="/tags/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/" style="font-size: 0.88rem;">学校课程<sup>4</sup></a><a href="/tags/%E5%AE%89%E5%85%A8-%E6%9D%82%E9%A1%B9/" style="font-size: 0.88rem;">安全--杂项<sup>1</sup></a><a href="/tags/%E5%B0%8F%E6%8A%80%E5%B7%A7/" style="font-size: 0.88rem;">小技巧<sup>1</sup></a><a href="/tags/%E6%9D%82%E9%A1%B9/" style="font-size: 0.88rem;">杂项<sup>1</sup></a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 0.88rem;">渗透测试<sup>1</sup></a><a href="/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" style="font-size: 0.88rem;">环境搭建<sup>1</sup></a><a href="/tags/%E9%97%AE%E9%A2%98/" style="font-size: 0.88rem;">问题<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8779107562" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/playlist?id=8779107562&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("05/14/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.8",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 ryz 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>