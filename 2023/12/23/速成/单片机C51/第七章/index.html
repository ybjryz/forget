<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>第七章 | ryz</title><meta name="keywords" content="学校课程"><meta name="author" content="ryz"><meta name="copyright" content="ryz"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="第七章"><meta name="application-name" content="第七章"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="第七章"><meta property="og:url" content="http://ybjryz.github.io/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/index.html"><meta property="og:site_name" content="ryz"><meta property="og:description" content="第七章7.0 大纲第七章  AT89S51单片机的串行口（了解AT89S51单片机串行口的基本工作原理，串行口的四种工作方式、SCON和PCON寄存器的用法以及串行口多机通信的工作原理，串口通信接口设计的要点，了解各种常用的串行通信的接口标准，熟练掌握串口通信波特率计算方法、串口与计算机通信方法和编"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://ybjryz.github.io/img/tx.png"><meta property="article:author" content="ryz"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://ybjryz.github.io/img/tx.png"><meta name="description" content="第七章7.0 大纲第七章  AT89S51单片机的串行口（了解AT89S51单片机串行口的基本工作原理，串行口的四种工作方式、SCON和PCON寄存器的用法以及串行口多机通信的工作原理，串口通信接口设计的要点，了解各种常用的串行通信的接口标准，熟练掌握串口通信波特率计算方法、串口与计算机通信方法和编"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://ybjryz.github.io/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":4000,"accessToken":"","mailMd5":""},
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: ryz","link":"链接: ","source":"来源: ryz","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'ryz',
  title: '第七章',
  postAI: '',
  pageFillDescription: '第七章, 7.0 大纲, 7.1 串行口的结构, 7.1.1 串行口控制寄存器SCON, （1）SM0、SM1—工作方式选择位, （2）SM2—多机通信控制位, （3）REN—允许串行接收位。, （4）TB8—发送的第9位数据, （5）RB8—接收的第9位数据, （6）TI—发送中断标志位, （7）RI—接收中断标志位, 7.1.2 特殊功能寄存器PCON, 7.2 串行口的4种工作方式, 7.2.1 方式0, 1．方式0输出, 2．方式0输入, 7.2.2  方式1, 1．方式1发送, 2．方式1接收, 7.2.3  方式2, 1．方式2发送, 2．方式2接收, 7.2.4  方式3, 7.3  多机通信, 多机通信的工作原理, 多机通信的工作过程, 7.4  波特率的制定, 7.4.1  波特率的定义, 7.5  串行通信的应用设计, 7.5.1  各种串行通信接口标准, 1．TTL电平通信接口, 2．RS-232C双机通信接口, 3．RS-422A双机通信接口, 4．RS-485双机通信接口, 7.5.2  方式1的应用, 7.5.3  方式2和方式3的应用, 7.5.4  主从式多机通信的应用, 7.5.5  单片机与PC机的串行通信, 一、单片机向计算机发送数据, 7.5.6  PC机与单片机与多个单片机的串行通信接口设计第七章大纲第七章单片机的串行口了解单片机串行口的基本工作原理串行口的四种工作方式和寄存器的用法以及串行口多机通信的工作原理串口通信接口设计的要点了解各种常用的串行通信的接口标准熟练掌握串口通信波特率计算方法串口与计算机通信方法和编程串行口通信的编程的串行口为全双工的通用异步收发的串行口全双工就是两个单片机之间串行数据可同时双向传输异步通信是指收发双方使用各自的时钟控制发送和接收过程这样可省去收发双方的一条同步时钟信号线使得异步串行通信连接更加简单且容易实现串行口的结构内部结构如图两个物理上独立的接收发送缓冲器属于特殊功能寄存器可同时发送接收数据发送缓冲器只写不能读接收缓冲器只读不能写两个缓冲器共用一个特殊功能寄存器字节地址控制寄存器两个特殊功能寄存器和串行口控制寄存器字节地址可位寻址位地址为格式如图图串行口控制寄存器的格式中各位功能工作方式选择位两位编码所对应的种工作方式如表多机通信控制位多机通信仅在方式和方式下进行当串口以方式或方式接收时如果则只有当接收到的第位数据为时才使置产生中断请求并将接收到的前位数据送入当接收到的第位数据为时则将接收到的前位数据丢弃当时则不论第位数据是还是都将前位数据送入中并使置产生中断请求方式时如果则只有收到有效的停止位时才会激活方式时必须为允许串行接收位由软件置或清允许串行口接收数据禁止串行口接收数据发送的第位数据方式和方式是要发送的第位数据由软件置或清双机串行通信时一般作为奇偶校验位在多机通信中用来表示主机发送的是地址帧还是数据帧为地址帧为数据帧接收的第位数据方式和方式存放接收到的第位数据在方式如是接收到的停止位在方式不使用发送中断标志位方式串行发送的第位数据结束时由硬件置在其他方式中串行口发送停止位的开始时置为表示一帧数据发送结束状态可供软件查询也可申请中断响应中断后在中断服务程序中向写入要发送的下一帧数据必须由软件清接收中断标志位方式时接收完第位数据时由硬件置在其他工作方式中串行接收到停止位时该位置表示一帧数据接收完毕并申请中断要求从接收取走数据该位的状态也可供软件查询必须由软件清的所有位都可进行位操作清或置特殊功能寄存器字节地址为不能位寻址格式图介绍中各位功能仅最高位与串口有关其它各位的功能已在第章的节电工作方式一节中作过介绍波特率选择位例如方式的波特率计算公式当时要比时波特率加倍所以也称位为波特率倍增位串行口的种工作方式种工作方式由中位定义编码见表方式同步移位寄存器输入输出方式该方式并不用于两个单片机之间的异步串行通信而是用于串行口外接移位寄存器扩展并行口位数据为一帧无起始位和停止位先发送或接收最低位波特率为帧格式如图方式输出方式输出的工作原理当执行一条将数据写入发送缓冲器指令时产生一个正脉冲串行口开始把中的位数据以的固定波特率从引脚串行输出低位在先引脚输出同步移位脉冲发送完位数据中断标志位置发送时序如图方式输出的应用典型应用是外扩串行输入并行输出的同步移位寄存器实现并行输出端口的扩展图为串行口工作在方式通过的输出来控制个外接发光二极管亮灭的接口电路当串行口被设置在方式输出时串行数据由端送出移位脉冲由端送出在移位脉冲的作用下串行口发送缓冲器的数据逐位地从端串行地移入中例如图所示编写程序控制个发光二极管轮流点亮图中的端为同步脉冲输入端为控制端当时允许串行数据从和端输入但是位并行输出端关闭当时和输入端关闭但是允许中的位数据并行输出当位串行数据发送完毕后引起中断在中断服务程序中单片机通过串行口输出下一个位数据采用中断方式的参考程序如下设置串行口为方式全局中断允许允许串行口中断程序说明定义了全局变量以便在中断服务程序中能访问该变量用于存放从串口发出的字符在程序中使用操作符对变量进行移位使得从串口发出的数据为从而逐个点亮不同的发光二极管语句的作用是当左移一位由变为后需对变量重新赋值为主程序中的语句必不可少如没有该语句主程序并不从串行口发送数据也就不会有发送完成中断循环语句的循环条件为空表示循环为一个无限循环与实现同样的功能方式输入方式输入工作原理方式接收为允许接收控制位禁止接收允许接收当向寄存器写入控制字设置为方式并使位置同时时产生一个正脉冲串行口开始接收数据引脚为数据输入端为移位脉冲信号输出端接收器以的固定波特率采样引脚的数据信息当接收完位数据时中断标志置表示一帧数据接收完毕可进行下一帧数据的接收时序如图方式输入应用举例例图为串口外接一片位并行输入串行输出的同步移位寄存器扩展一个位并行输入口的电路可将接在的个开关的状态通过串口方式读入到单片机内的端为控制端若则可并行输入数据且串行输出端关闭则并行输入关断可以串行输出图中由检测的开关合上时开始数字量并行读入采用中断方式来完成数字量的读取参考程序如下串行口初始化为方式允许串行口中断允许全局中断为真表示要并行读入数字量清将数字量并行读入置将并行读入数字量串行输出给单片机读入中的数据清除和标志位程序说明当为表示要并行读入数字量通过把复位则并行读入再把置就将并行读入的数字量通过端串行发给单片机在中断服务程序中读入中的数据方式方式为双机串行通信方式如图所示当时串行口设为方式的双机串行通信脚和脚分别用于发送和接收数据方式一帧数据为位个起始位个数据位个停止位先发送或接收最低位帧格式如图方式为波特率可变的位异步通信接口波特率由下式确定为寄存器的最高位的值或方式发送方式输出时数据位由端输出发送一帧信息为位位起始位位数据位先低位和位停止位当执行一条数据写的指令就启动发送发送时序见图图中时钟的频率就是发送的波特率发送开始时内部发送控制信号变为有效将起始位向脚输出此后每经过一个时钟周期便产生一个移位脉冲并由引脚输出一个数据位位数据位全部发送完毕后中断标志位置方式接收方式接收时数据从引脚输入当检测到起始位的负跳变则开始接收接收时序见图接收时定时控制信号有两种一种是接收移位时钟时钟它的频率和传送的波特率相同另一种是位检测器采样脉冲频率是时钟的倍以波特率的倍速率采样脚状态当采样到端从到的负跳变时就启动检测器接收的值是次连续采样第个脉冲时采样取两次相同的值以确认起始位负跳变的开始较好地消除干扰引起的影响当起始位有效时开始接收一帧信息每一位数据都进行次连续采样第个脉冲采样接收的值是次采样中至少两次相同的值当一帧数据接收完毕后同时满足以下两个条件接收才有效即上一帧数据接收完成时发出的中断请求已被响应中的数据已被取走说明接收已空或收到的停止位方式时停止位已进入则将接收到的数据装入和装入的是停止位且中断标志置若不同时满足两个条件收的数据不能装入该帧数据将丢弃方式方式和方式位异步通信接口每帧数据为位位起始位位数据位先低位位可程控为或的第位数据和位停止位方式方式帧格式如图方式发送发送前先根据协议由软件设置如奇偶校验位或多机通信的地址数据标志位然后将要发送的数据写入即启动发送自动装入第位数据位逐一发送发送完毕使位置发送时序如图方式接收且时方式接收数据由端输入接收位信息当位检测逻辑采样到的负跳变判断起始位有效便开始接收一帧信息在接收完第位数据后需满足以下两个条件才能将接收到的数据送入接收缓冲器意味着接收缓冲器为空或接收到的第位数据位当满足上述两个条件时收到的数据送接收缓冲器第位数据送入且置若不满足这两个条件接收的信息将被丢弃串行口方式和方式接收时序如图方式时方式为波特率可变的位异步通信方式除了波特率外方式和方式相同方式发送和接收时序如图和图所示多机通信多个单片机可利用串口进行多机通信常采用图的主从式结构系统中个主机单片机或其他有串行接口的微机和多个单片机组成的从机系统主机的与所有从机的端相连与所有从机的端相连从机地址分别为和主从式只有一个主机其余全是从机主机发送的信息可以被所有从机接收任何一个从机发送的信息只能由主机接收从机和从机之间不能进行直接通信只能经主机才能实现多机通信的工作原理要保证主机与所选择的从机通信须保证串口有识别功能中的位就是为满足这一条件设置的多机通信控制位其工作原理是在串行口以方式或方式接收时若则表示进行多机通信可能以下两种情况从机接收到的主机发来的第位数据时前位数据才装入并置中断标志向发出中断请求在中断服务程序中从机把接收到的中的数据存入数据缓冲区中如果从机接收到的第位数据时则不产生中断标志不引起中断从机不接收主机发来的数据若则接收的第位数据不论是还是从机都将产生中断标志接收到的数据装入中应用这一特性可实现多机通信多机通信的工作过程各从机初始化程序允许从机串口中断将串口编程为方式或方式接收即位异步通信方式且和位置使从机处于多机通信且只接收地址帧的状态在主机和某从机通信之前先将从机地址即准备接收数据的从机发送给各个从机接着才传送数据或命令主机发出的地址帧信息的第位为数据或命令帧的第位为当主机向各从机发送地址帧时各从机的串行口接收到的第位信息为且由于各从机的则置各从机响应中断在中断服务子程序中判断主机送来的地址是否和本机地址相符合若为本机地址则该从机位清准备接收主机的数据或命令若地址不相符则保持接着主机发送数据或命令帧数据帧的第位为此时各从机接收到的只有与前面地址相符合的从机即位已清的从机才能激活中断标志位从而进入中断服务程序接收主机发来的数据或命令与主机发来的地址不相符的从机由于保持为又因此不能激活中断标志就不能接受主机发来的数据帧从而保证主机与从机间通信的正确性此时主机与建立联系的从机已经设置为单机通信模式即在整个通信中通信的双方都要保持发送数据的第位即位为防止其他从机误接收数据结束数据通信并为下一次的多机通信做好准备在多机系统每个从机都被赋予唯一的地址例如图三个从机的地址可设为还要预留个广播地址它是所有从机共有的地址例如将广播地址设为当主机与从机的数据通信结束后一定要将从机再设置为多机通信模式以便进行下一次的多机通信这时要求与主机正在进行数据传输的从机须随时注意一旦接收的数据第位为说明主机传送的不再是数据而是地址这个地址就有可能是广播地址当收到广播地址后便将从机的通信模式再设置成多机模式为下一次多机通信做好准备波特率的制定串行通信收发双方发送或接收的波特率必须一致种工作方式方式和方式的波特率是固定的方式和方式的波特率是可变的由溢出率确定波特率的定义波特率的定义串行口每秒钟发送或接收的位数设发送一位所需要的时间为则波特率为定时器的不同工作方式得到的波特率的范围不一样这是由在不同工作方式下计数位数的不同所决定定时器产生波特率的计算和串行口的工作方式有关方式时波特率固定为时钟频率的不受位值的影响若波特率方式时波特率仅与位的值有关若波特率波特率方式或方式定时常用作为波特率发生器其关系式为由式见溢出率和的值共同决定波特率在实际设定波特率时常设置为方式定时自动装初值即作为位计数器存放备用初值这种方式操作方便也避免因软件重装初值带来的定时误差设定时器方式的初值为则有将式代入式则由式可见波特率随和初值而变化实际使用时经常根据已知波特率和时钟频率来计算的初值为避免繁杂的初值计算常用的波特率和初值间的关系常列成表形式供查用波特率位方式初值表有两点需要注意在使用的时钟振荡频率为或时将初值和带入式中计算出的波特率有一定误差消除误差可采用时钟频率如果选用很低的波特率如选为可将定时器设为方式定时但这种情况溢出时需在中断服务程序中重新装入初值中断响应时间和执行指令时间会使波特率产生一定的误差可用改变初值的方法加以调整例若时钟频率为选用的方式定时作为波特率发生器波特率为求初值设为方式定时选将已知条件带入式中从中解得只要把装入和则产生的波特率为也可直接从表中查到这里时钟振荡频率选为就可使初值为整数从而产生精确的波特率串行通信的应用设计串行通信接口设计时需考虑如下问题首先确定串行通信双方的数传速率和通信距离由串行通信的数传速率和通信距离确定采用的串行通信接口标准注意串行通信的通信线选择一般选用双绞线较好并根据传输的距离选择纤芯的直径如空间干扰较多还要选择带有屏蔽层的双绞线下面首先介绍有关串行通信的接口设计问题各种串行通信接口标准单串口的输入输出均为电平以电平串行传输数据的方式抗干扰性差传输距离短速率低为了提高串行通信可靠性增大串行通信的距离和提高传输速率一般都采用标准串行接口如等根据单片机的双机通信距离和抗干扰性的实际要求可选择电平传输或选择串行接口进行串行数据传输电平通信接口如两个单片机相距在内它们的串口可直接相连接口电路如图所示甲机的与乙机的端相连乙机的与甲机的端相连从而直接用电平传输方法来实现双机通信双机通信接口如果双机通信距离在之间时可利用标准接口实现点对点的双机通信接口电路如图所示双机通信接口缺点传输速率低通讯距离短接口处信号容易产生串扰等国际上又推出了标准与的主要区别是收发双方的信号地不再共地采用了平衡驱动和差分接收的方法用于数据传输是两条平衡导线这相当于两个单端驱动器两条线上传输的信号电平当一个表示逻辑时另一条一定为逻辑若传输中信号中混入干扰和噪声共模形式由于差分接收器的作用就能识别有用信号并正确接收传输的信息并使干扰和噪声相互抵消能在长距离高速率下传输最大传输率为电缆允许长度为如采用较低传输速率时最大传输距离可达为了增加通信距离可采用光电隔离利用标准进行双机通信的接口电路如图图中每个通道的接收端都接有个电阻和其中为传输线的匹配电阻取值范围在其他两个电阻是为了解决第一个数据的误码而设置的匹配电阻为了起到隔离抗干扰的作用图中须使用两组独立的电源图中的是电平到电平与电平到电平的电平转换芯片双机通信接口通信需四芯传输线长距离通信很不经济故在工业现场通常采用双绞线传输的串行通信接口很容易实现多机通信是的变型它与的区别为全双工采用两对平衡差分信号线为半双工采用一对平衡差分信号线对于多站互连是十分方便的容易实现多机通信允许最多并联台驱动器和台接收器图为通信接口电路与一样最大传输距离约最大传输速率为通信线路要采用平衡双绞线平衡双绞线的长度与传输速率成反比在速率以下才可能使用规定的最长电缆只有在很短的距离下才能获得最大传输速率一般长双绞线最大传输速率仅为图以双向半双工方式来实现双机通信在单片机系统发送或接收数据前应先将的发送门或接收门打开当时发送门打开接收门关闭当时接收门打开发送门关闭图中的芯片内集成了一个差分驱动器和一个差分接收器且兼有电平到电平电平到电平的转换功能此外常用的接口芯片还有方式的应用例如图所示甲乙双机串行通信双机的和相互交叉相连甲机的口接个开关乙机的口接个发光二极管甲机设置为只发不收的单工方式要求甲机读入口的个开关的状态后通过串行口发送到乙机乙机将接收到的甲机的个开关的状态数据送入口由口的个发光二极管来显示个开关的状态双方晶振均采用参考程序如下甲机串行发送设置定时器为方式波特率方式只发送不接收串行口初始化为方式启动口为输入读入口开关的状态数据数据送串行口发送如果未发送完循环等待已发送完再把清乙机串行接收设置定时器为方式波特率设置串口为方式接收启动若为未接收到数据接收到数据则把清读取数据存入中接收的数据送口控制个的亮与灭例如图所示甲乙两机以方式进行串行通信其中甲机发送信息乙机接收信息双方晶振频率均为波特率为当串行通信开始时双方约定甲机先发送信号乙机收到后应答表示同意接收甲机收到后即可发送数据如果乙机发现数据出错就向甲机发送甲机收到后重新发送数据给乙机设发送的字节块的数据长度为字节数据缓冲区为数据发送完毕要立即发送校验和进行数据发送准确性验证乙机接收到的数据存储到数据缓冲区收到一个数据块后再接收甲机发来的校验和并将其与乙机求得的校验和比较若相等说明接收正确乙机回答若不等说明接收不正确乙机回答请求甲机重新发送选择定时器为方式定时波特率不倍增即查表则写入的初值应为以下为双机通信程序该程序可以在甲乙两机中运行不同的是在程序运行之前要人为地选择若选择表示该机为发送方若选择表示该机是接收方程序根据的设置利用发送函数和接收函数分别实现发送和接收功能接收发送的区别值为发送校验和串口初始化函数方式定时波特率启动串行口方式允许接收主程序为发送调用发送函数调用接收函数发送函数发送联络信号等待数据发送完毕等待乙机应答乙机未准备好继续联络校验和变量清求校验和出错重新发送接收函数判甲机是否发出请求发送应答信号等待发送结束清校验和接收校验和接收一个数据求校验和接收甲机的校验和比较校验和校验和相等则发出错发重新接收方式和方式的应用方式和方式两点不同方式收发位信息第位为起始位第位为数据位第位是程控位可由用户置决定第位是停止位这是一个不同点另一不同点是方式波特率变化范围比方式小方式波特率振荡器频率当时当时除波特率的差别外方式的使用和方式是一样的所以下面介绍的方式应用编程也适用于方式例甲乙两个单片机进行方式或方式串行通讯甲机将个流水灯控制数据发送给乙机乙机再利用该数据点亮其口的个方式比方式多了一个可编程位该位一般作奇偶校验位乙机接收到的位二进制数据有可能出错需进行奇偶校验其方法是将乙机的和的奇偶校验位进行比较如相同接收数据否则拒绝接收参考程序如下甲机发送程序如下位定义为寄存器的第位即奇偶校验位控制流水灯显示数据数组被定义为全局变量发送一个字节数据的函数将奇偶校验位写入将待发送的数据写入发送缓冲器检测发送标志位未发送完空操作一个字节发送完清延时大约函数主函数设置定时器为方式设置串口为方式给定时器赋初值波特率设置为启动定时器大约发送一次数据乙机接收程序如下位为寄存器的第位即奇偶校验位接收一个字节数据的函数检测接收中断标志未接收完则循环等待已接收一帧数据将清将接收缓冲器的数据存于只有奇偶校验成功才接收数据将接收缓冲器的数据存于将接收的数据返回主函数设置定时器为方式设置串口为方式允许接收给定时器赋初值波特率为接通定时器允许接收将接收到的数据送口显示主从式多机通信的应用介绍主从式多机通信的应用编程例如图所示主机分别与三个从机进行通信这里仅以地址为的从机为例实现主从机的通信其他从机的程序与从机相同只是定义的地址不同约定如下台从机的地址为主机发出的地址为一条控制指令使所有从机都处于的状态其余的控制指令接收指令发送指令这两条指令是作为数据发送的从机的状态字如图所示主机程序传送一次的字节数从机地址延时参数可根据需要调整设置为定时器方式波特率方式允许接收启动方式允许接收发给从机数据出错标志等待发送完发呼叫地址等待发送完等待从机应答若地址出错发出错标志从机复位清地址标志位准备接收数据发命令帧接收从机返回的地址帧若主机命令非法发复位信号给从机主机发送的命令是请求从机接收数据从机准备接收就绪清校验和发送数据计算校验和发送校验和给从机从机接收不正确主机重新发送主机发送的是接收命令从机发送数据从机准备接收就绪清校验和主机接收数据校验和相同发送给从机校验和不同发送给从机重置地址标志位从机程序传送一次的字节数设置为定时器方式波特率方式允许接收允许串口中断准备好发送和接收关串口中断非本机地址继续监听取消监听状态发回从机地址确认地址不符从机复位从机接收主机的数据接收准备好发回确认地址不符从机复位接收数据从机向主机发送数据发送准备好发送数据命令非法恢复监听发送数据函数发送数据发送校验和主机接收不正确重新发送接收数据函数初始化校验和为校验和相同发校验不同发重新接收单片机与机的串行通信测控系统中常使用单片机进行数据采集但由于单片机的数据存储容量和数据处理能力都较低所以一般情况下单片机通过串口与机串口相连把采集到的数据传送到机上再在机上进行数据处理由于单片机的输入输出是电平而机配置的都是标准串行接口为针型连接器插座如图所示表为的型针插头的引脚定义由于两者的电平不匹配因此必须把单片机输出的电平转换为电平单片机与机的接口方案如图图中所用的电平转换芯片为接口连接只用条线即插座中的脚脚与脚一单片机向计算机发送数据例单片机向计算机发送数据的接口电路如图要求单片机通过串行口的脚向计算机串行发送个数据字节实际上单片机向计算机与单片机向单片机发送数据的方法是完全一样的单片机向计算机发送数据的参考程序如下欲发送的流水灯控制码数组定义为全局变量待发送数据写入发送缓冲寄存器串口未发送完等待空操作一个字节发送完毕软件将标志清主函数设置为定时器方式串行口方式波特率启动循环发送次流水灯控制码发送数据每隔发送一次数据延时函数延时约二单片机接收计算机发送的数据例单片机接收计算机发送的串行数据并把接收到的数据送口的位显示参考程序如下接收数据中断标志未被置等待直至接收完毕空操作将接收中断标志清为接收下一帧数据做准备将接收缓冲器中的数据存入将接收到的数据返回主函数设置为定时器模式方式设置串行口方式接收波特率启动允许接收循环将接收到的数据送口显示机与单片机与多个单片机的串行通信接口设计一台机和多片可构成小型分布式测控系统如图是单片机应用的一个热点分布式测控系统在工业控制和数据采集系统中充分发挥单片机功能强抗干扰性好面向控制等优点同时又可利用机弥补单片机在数据处理和交互性等方面不足在应用系统中一般以机为主机定时扫描以为核心的前沿单片机以便采集数据或发送控制信息这样系统中以为核心的智能式测量和控制仪表从机既能独立地完成数据处理和控制任务又可将数据传送给机机将这些数据进行处理或显示或打印同时将控制命令传送给各子机以实现集中管理和最优控制显然要组成一个这样的分布式测控系统系统首先要解决的是机与单片机间的串行通信接口问题下面以串行多机通信为例说明机与数台单片机进行多机通信的接口设计方案机配有串行标准接口可通过转换电路转换成串行接口本身有一个全双工的串行口该串行口加上驱动电路后就可实现串行通信机与数台进行多机通信的串行通信接口如图所示在图中的串口通过芯片驱动后就可转换成标准接口根据标准接口的电气特性从机数量不多于个机与之间的通信采用主从方式机为主机单片机为从机由机来确定与哪个单片机进行通信有关机与多个单片机的串行通信的软件编程可供读者使用的参考资料较多读者可查阅相关的参考文献',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-24 21:19:27',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/tx.png"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">ryz</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">音乐</div><span class="author-content-item-title">灵魂的碰撞💥</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>学校课程</span></a></span></div></div><h1 class="post-title" itemprop="name headline">第七章</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-12-23T13:10:00.000Z" title="发表于 2023-12-23 21:10:00">2023-12-23</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-12-24T13:19:27.428Z" title="更新于 2023-12-24 21:19:27">2023-12-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为重庆"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>重庆</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://ybjryz.github.io/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/"><header><a href="/tags/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/" tabindex="-1" itemprop="url">学校课程</a><h1 id="CrawlerTitle" itemprop="name headline">第七章</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">ryz</span><time itemprop="dateCreated datePublished" datetime="2023-12-23T13:10:00.000Z" title="发表于 2023-12-23 21:10:00">2023-12-23</time><time itemprop="dateCreated datePublished" datetime="2023-12-24T13:19:27.428Z" title="更新于 2023-12-24 21:19:27">2023-12-24</time></header><h1 id="第七章"><a href="#第七章" class="headerlink" title="第七章"></a>第七章</h1><h2 id="7-0-大纲"><a href="#7-0-大纲" class="headerlink" title="7.0 大纲"></a>7.0 大纲</h2><p>第七章  AT89S51单片机的串行口（了解AT89S51单片机串行口的基本工作原理，串行口的四种工作方式、SCON和PCON寄存器的用法以及串行口多机通信的工作原理，串口通信接口设计的要点，了解各种常用的串行通信的接口标准，熟练掌握串口通信波特率计算方法、串口与计算机通信方法和编程、串行口通信的C51编程）</p>
<p>AT89S51的串行口为全双工的通用异步收发（UART）的串行口。全双工就是两个单片机之间串行数据可同时双向传输。异步通信是指收、发双方使用各自的时钟控制发送和接收过程，这样可省去收、发双方的一条同步时钟信号线，使得异步串行通信连接更加简单且容易实现。</p>
<h2 id="7-1-串行口的结构"><a href="#7-1-串行口的结构" class="headerlink" title="7.1 串行口的结构"></a>7.1 串行口的结构</h2><p>内部结构如图7-1。</p>
<p>两个物理上独立的接收、发送缓冲器SBUF（属于特殊功能寄存器），可同时发送、接收数据。</p>
<p>发送缓冲器只写不能读。</p>
<p>接收缓冲器只读不能写。</p>
<p>两个缓冲器共用一个特殊功能寄存器字节地址（99H）。</p>
<p>控制寄存器两个：特殊功能寄存器SCON和PCON。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223211219008.png" class="" title="image-20231223211219008">

<h3 id="7-1-1-串行口控制寄存器SCON"><a href="#7-1-1-串行口控制寄存器SCON" class="headerlink" title="7.1.1 串行口控制寄存器SCON"></a>7.1.1 串行口控制寄存器SCON</h3><p>字节地址98H，可位寻址，位地址为98H～9FH。格式如图7-2。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/clip_image002.jpg" class="" width="0702">

<p>​      																			 图7-2  串行口控制寄存器SCON的格式</p>
<p>SCON中各位功能。</p>
<h4 id="（1）SM0、SM1—工作方式选择位"><a href="#（1）SM0、SM1—工作方式选择位" class="headerlink" title="（1）SM0、SM1—工作方式选择位"></a>（1）SM0、SM1—工作方式选择位</h4><p>SM0、SM1两位编码所对应的4种工作方式如表7-1。</p>
 <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223211333368.png" class="" title="image-20231223211333368">



<h4 id="（2）SM2—多机通信控制位"><a href="#（2）SM2—多机通信控制位" class="headerlink" title="（2）SM2—多机通信控制位"></a>（2）SM2—多机通信控制位</h4><p>多机通信<strong>仅在方式2和方式3</strong>下进行。当串口以方式2或方式3接收时，如果SM2 &#x3D; 1，则<strong>只有当接收到的第9位数据（RB8）为“1”时，才使RI置“1”</strong>，产生中断请求，并将接收到的前8位数据送入SBUF。</p>
<p><strong>当接收到的第9位数据（RB8）为“0”时，则将接收到的前8位数据丢弃。</strong></p>
<p>当SM2 &#x3D; 0时，则不论第9位数据是“1”还是“0”，都将前8位数据送入SBUF中，并使RI置“1”，产生中断请求。</p>
<p>方式1时，如果SM2 &#x3D; 1，则只有收到有效的停止位时才会激活RI。</p>
<p><strong>方式0时，SM2必须为0</strong>。</p>
<h4 id="（3）REN—允许串行接收位。"><a href="#（3）REN—允许串行接收位。" class="headerlink" title="（3）REN—允许串行接收位。"></a>（3）REN—允许串行接收位。</h4><p>由软件置“1”或清“0”。</p>
<p>REN&#x3D;1，允许串行口接收数据。</p>
<p>REN&#x3D;0，禁止串行口接收数据。</p>
<h4 id="（4）TB8—发送的第9位数据"><a href="#（4）TB8—发送的第9位数据" class="headerlink" title="（4）TB8—发送的第9位数据"></a>（4）TB8—发送的第9位数据</h4><p>方式2和方式3，TB8是要发送的第9位数据，由软件置“1”或清“0”。双机串行通信时，一般作为奇偶校验位；在多机通信中用来表示主机发送的是地址帧还是数据帧，TB8&#x3D;1为地址帧，TB8&#x3D;0为数据帧。</p>
<h4 id="（5）RB8—接收的第9位数据"><a href="#（5）RB8—接收的第9位数据" class="headerlink" title="（5）RB8—接收的第9位数据"></a>（5）RB8—接收的第9位数据</h4><p>方式2和方式3，RB8存放接收到的第9位数据。在方式1，如SM2 &#x3D; 0，RB8是接收到的停止位。在方式0，不使用RB8。</p>
<h4 id="（6）TI—发送中断标志位"><a href="#（6）TI—发送中断标志位" class="headerlink" title="（6）TI—发送中断标志位"></a>（6）TI—发送中断标志位</h4><p><strong>方式0</strong>，串行发送的第8位数据<strong>结束</strong>时<strong>TI由硬件置“1”</strong>，在<strong>其他方式</strong>中，串行口<strong>发送停止位的开始时置TI 为“1”</strong>。</p>
<p>TI &#x3D;1，表示一帧数据发送结束。TI状态可供软件查询，也可申请中断。CPU响应中断后，在中断服务程序中向SBUF写入要发送的下一帧数据。<strong>TI必须由软件清“0”</strong>。</p>
<h4 id="（7）RI—接收中断标志位"><a href="#（7）RI—接收中断标志位" class="headerlink" title="（7）RI—接收中断标志位"></a>（7）RI—接收中断标志位</h4><p><strong>方式0</strong>时，接收完第8位数据时，<strong>RI由硬件置“1”</strong>。在其他工作方式中，串行接收到停止位时，该位置“1”。RI&#x3D;1，表示一帧数据接收完毕，并申请中断，要求CPU从接收SBUF取走数据。该位的状态也可供软件查询。<strong>RI必须由软件清“0”</strong>。</p>
<p>SCON的所有位都可进行位操作清“0”或置“1”。</p>
<h3 id="7-1-2-特殊功能寄存器PCON"><a href="#7-1-2-特殊功能寄存器PCON" class="headerlink" title="7.1.2 特殊功能寄存器PCON"></a>7.1.2 特殊功能寄存器PCON</h3><p>  字节地址为87H，<strong>不能位寻址</strong>。格式图7-3。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223211631415.png" class="" title="image-20231223211631415">

<p>介绍PCON中各位功能。仅最高位<strong>SMOD</strong>与串口有关，其它各位的功能已在第2章的节电工作方式一节中作过介绍。</p>
<p>SMOD：波特率选择位。</p>
<p>例如，方式1的波特率计算公式：</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223211748002.png" class="" title="image-20231223211748002">

<p>  当SMOD&#x3D;1时，要比SMOD&#x3D;0时波特率加倍，所以也称SMOD位为波特率倍增位。</p>
<h2 id="7-2-串行口的4种工作方式"><a href="#7-2-串行口的4种工作方式" class="headerlink" title="7.2 串行口的4种工作方式"></a>7.2 串行口的4种工作方式</h2><p>4种工作方式由SCON中SM0、SM1位定义，编码见表7-1。</p>
<h3 id="7-2-1-方式0"><a href="#7-2-1-方式0" class="headerlink" title="7.2.1 方式0"></a>7.2.1 方式0</h3><p>同步移位寄存器输入&#x2F;输出方式。该方式并不用于两个AT89S51单片机之间的异步串行通信，而是用于串行口外接移位寄存器，扩展并行I&#x2F;O口。</p>
<p>8位数据为一帧，无起始位和停止位，先发送或接收最低位。<strong>波特率为fosc&#x2F;12</strong>。帧格式如图7-4。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223211836346.png" class="" title="image-20231223211836346">

<h4 id="1．方式0输出"><a href="#1．方式0输出" class="headerlink" title="1．方式0输出"></a>1．方式0输出</h4><p>（1）方式0输出的工作原理</p>
<p>当执行一条将数据写入发送缓冲器SBUF指令时，产生一个正脉冲，串行口开始把SBUF中的8位数据以fosc&#x2F;12的固定波特率从RXD引脚串行输出，低位在先，TXD引脚输出同步移位脉冲，发送完8位数据，中断标志位TI置“1”。 发送时序如图7-5。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223211909008.png" class="" title="image-20231223211909008">

<p>（2）方式0输出的应用</p>
<p>  典型应用是外扩串行输入&#x2F;并行输出的同步移位寄存器74LS164，实现并行输出端口的扩展。</p>
<p>  图7-6为串行口工作在方式0，通过74LS164的输出来控制8个外接LED发光二极管亮灭的接口电路。当串行口被设置在方式0输出时，串行数据由RXD端（P3.0）送出，移位脉冲由TXD端（P3.1）送出。在移位脉冲的作用下，串行口发送缓冲器的数据逐位地从RXD端串行地移入74LS164中。</p>
 <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223211930167.png" class="" title="image-20231223211930167">

<p>【例7-1】如图7-6所示，编写程序控制8个发光二极管轮流点亮。</p>
<p>  图中74LS164的CLK端为同步脉冲输入端，CLR为控制端，当CLR&#x3D;0时，允许串行数据从A和B端输入但是8位并行输出端关闭；当CLR&#x3D;1时，A和B输入端关闭，但是允许74LS164中的8位数据并行输出。当8位串行数据发送完毕后，引起中断，在中断服务程序中，单片机通过串行口输出下一个8位数据。</p>
<p>  采用中断方式的参考程序如下。</p>
<pre class="language-C" data-language="C"><code class="language-C">#include &lt;reg51.h&gt;
#include &lt;stdio.h&gt;
sbit P1_0 &#x3D; 0x90； xdata char nSendByte；
delay()； main()
&#123;
    SCON &#x3D; 0x00； &#x2F;* 设置串行口为方式0*&#x2F;
        EA &#x3D; 1；  &#x2F;* 全局中断允许 *&#x2F;
        ES &#x3D; 1；  &#x2F;* 允许串行口中断 *&#x2F;
        nIndex &#x3D; 1； SBUF &#x3D; nSendByte；
            P1_0 &#x3D; 0； for (；；)
    &#123;
    &#125;
&#125;
void Serial_Port() interrupt 4 using 0
&#123;
    if (TI &#x3D;&#x3D; 1)
    &#123;
        P1_0 &#x3D; 1； delay()； P1_0 &#x3D; 0； nSendByte &lt;&lt;&#x3D; 1； if (nSendByte &#x3D;&#x3D; 0) nSendByte &#x3D; 1； SBUF &#x3D; nSendByte；
    &#125;
    TI &#x3D; 0； RI &#x3D; 0；
&#125;
delay()
&#123;
    int nCounter； for (nCounter &#x3D; 0；nCounter &lt; 128；nCounter ++)；
&#125;
</code></pre>

<p>程序说明：</p>
<p>  （1）定义了全局变量nSendByte，以便在中断服务程序中能访问该变量。nSendByte用于存放从串口发出的字符，在程序中使用操作符对nSendByte变量进行移位，使得从串口发出的数据为0x01, 0x02, 0x04，0x08，0x10，0x20，0x40，0x80，从而逐个点亮不同的发光二极管。</p>
<p>  （2）if语句的作用是当nSendByte左移一位由0x80变为0x00后，需对变量nIndex重新赋值为1。</p>
<p>  （3）主程序中的SBUF&#x3D;nSendByte语句必不可少，如没有该语句，主程序并不从串行口发送数据，也就不会有发送完成中断。</p>
<p>  （4）循环语句for(；；)的循环条件为空，表示for循环为一个无限循环，与while(1)实现同样的功能。</p>
<h4 id="2．方式0输入"><a href="#2．方式0输入" class="headerlink" title="2．方式0输入"></a>2．方式0输入</h4><p>（1）方式0输入工作原理</p>
<p>方式0接收，REN为允许接收控制位，REN&#x3D;0，禁止接收；REN &#x3D; 1，允许接收。</p>
<p>当向SCON寄存器写入控制字（设置为方式0，并使REN位置“1”，同时RI &#x3D; 0）时，产生一个正脉冲，串行口开始接收数据。</p>
<p>引脚RXD为数据输入端，TXD为移位脉冲信号输出端，接收器以fosc&#x2F;12的固定波特率采样RXD引脚的数据信息，当接收完8位数据时，中断标志RI置“1”，表示一帧数据接收完毕，可进行下一帧数据的接收，时序如图7-7。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223212136664.png" class="" title="image-20231223212136664">

<p>（2）方式0输入应用举例</p>
<p>  【例7-2】图7-8为串口外接一片8位并行输入、串行输出的同步移位寄存器74LS165，扩展一个8位并行输入口的电路，可将接在74LS165的8个开关的状态通过串口方式0读入到单片机内。74LS165的SH&#x2F;LD<em>端为控制端。若SH&#x2F;LD</em>&#x3D;0，则74LS165可并行输入数据，且串行输出端关闭；SH&#x2F;LD*&#x3D;1，则并行输入关断，可以串行输出。</p>
<p>  图中由P1.0检测的开关S合上时开始数字量并行读入，采用中断方式来完成数字量的读取。参考程序如下。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223212155425.png" class="" title="image-20231223212155425">

<pre class="language-C" data-language="C"><code class="language-C">#include &lt;reg51.h&gt;
#include &lt;stdio.h&gt;
sbit P1_0 &#x3D; 0x90； sbit P1_1 &#x3D; 0x91； xdata char nRxByte；
delay()； main()
&#123;
    xdata char nRxByte &#x3D; 0； SCON &#x3D; 0x00； &#x2F;* 串行口初始化为方式0*&#x2F;
        ES &#x3D; 1；                           &#x2F;* 允许串行口中断 *&#x2F;
        EA &#x3D; 1；                           &#x2F;* 允许全局中断 *&#x2F;
        for (；；)
    &#123;
        if (P1_0 &#x3D;&#x3D; 0) &#x2F;* P1.0&#x3D;0为真，表示要并行读入数字量 *&#x2F;
        &#123;
            P1_1 &#x3D; 0；     &#x2F;* P1.1清0，将数字量并行读入*&#x2F;
                P1_1 &#x3D; 1； &#x2F;* P1.1置1，将并行读入数字量串行输出给单片机*&#x2F;
        &#125;
    &#125;
&#125;
void Serial_Port() interrupt 4 using 0
&#123;
    if (RI &#x3D;&#x3D; 1)
    &#123;
        nRxByte &#x3D; SBUF； &#x2F;*读入SBUF 中的数据*&#x2F;
    &#125;
    TI &#x3D; 0； &#x2F;*清除TI和RI标志位*&#x2F;
        RI &#x3D; 0；
&#125;
</code></pre>

<p>  程序说明：当P1.0为0表示要并行读入数字量，通过P1.1把SH&#x2F;LD<em>复位，则并行读入，再把SH&#x2F;LD</em>置1，74LS165就将并行读入的数字量通过QH端串行发给单片机，在中断服务程序中读入SBUF中的数据。</p>
<h3 id="7-2-2-方式1"><a href="#7-2-2-方式1" class="headerlink" title="7.2.2  方式1"></a>7.2.2  方式1</h3><p>方式1为双机串行通信方式，如图7-9所示。</p>
<p>当<code>SM0、SM1=01</code>时，串行口设为方式1的双机串行通信。TXD脚和RXD脚分别用于发送和接收数据。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223212302043.png" class="" title="image-20231223212302043">

<p>方式1一帧数据为10位，1个起始位（0），8个数据位，1个停止位（1），先发送或接收最低位。帧格式如图7-10。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223212330517.png" class="" title="image-20231223212330517">

<p>方式1为波特率可变的8位异步通信接口。波特率由下式确定：</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223212351412.png" class="" title="image-20231223212351412">

<p>SMOD为PCON寄存器的最高位的值（0或1）。</p>
<h4 id="1．方式1发送"><a href="#1．方式1发送" class="headerlink" title="1．方式1发送"></a>1．方式1发送</h4><p>方式1输出时，数据位由TXD端输出，发送一帧信息为10位：1位起始位0，8位数据位（先低位）和1位停止位1。当CPU执行一条数据写SBUF的指令，就启动发送。发送时序见图7-11。</p>
<p>图7-11中TX时钟的频率就是发送的波特率。</p>
<p>发送开始时，内部发送控制信号 变为有效，将起始位向TXD脚（P3.0）输出，此后每经过一个TX时钟周期，便产生一个移位脉冲，并由TXD引脚输出一个数据位。8位数据位全部发送完毕后，中断标志位TI置“1。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223212415318.png" class="" title="image-20231223212415318">

<h4 id="2．方式1接收"><a href="#2．方式1接收" class="headerlink" title="2．方式1接收"></a>2．方式1接收</h4><p>方式1接收时（REN &#x3D; 1），数据从RXD（P3.1）引脚输入。当检测到起始位的负跳变，则开始接收。接收时序见图7-12。</p>
<p>接收时，定时控制信号有两种，一种是接收移位时钟（RX时钟），它的频率和传送的波特率相同。另一种是位检测器采样脉冲，频率是RX时钟的16倍。以波特率的16倍速率采样RXD脚状态。当采样到RXD端从1到0的负跳变时就启动检测器，接收的值是3次连续采样（第7、8、9个脉冲时采样）取两次相同的值，以确认起始位（负跳变）的开始，较好地消除干扰引起的影响。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223212431678.png" class="" title="image-20231223212431678">



<p>当起始位有效时，开始接收一帧信息。每一位数据都进行3次连续采样（第7、8、9个脉冲采样），接收的值是3次采样中至少两次相同的值。当一帧数据接收完毕后，同时满足以下两个条件，接收才有效。</p>
<p>  （1）RI&#x3D;0，即上一帧数据接收完成时，RI &#x3D; 1发出的中断请求已被响应，SBUF中的数据已被取走，说明“接收SBUF”已空。</p>
<p>  （2）SM2&#x3D;0或收到的停止位 &#x3D; 1（方式1时，停止位已进入RB8），则将接收到的数据装入SBUF和RB8（装入的是停止位），且中断标志RI置“1”。</p>
<p>  若不同时满足两个条件，收的数据不能装入SBUF，该帧数据将丢弃。</p>
<h3 id="7-2-3-方式2"><a href="#7-2-3-方式2" class="headerlink" title="7.2.3  方式2"></a>7.2.3  方式2</h3><p>  方式2和方式3，9位异步通信接口。每帧数据为11位，1位起始位0，8位数据位（先低位），1位可程控为1或0的第9位数据和1位停止位。方式2、方式3帧格式如图7-13。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223212522944.png" class="" title="image-20231223212522944">

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223212539167.png" class="" title="image-20231223212539167">

<h4 id="1．方式2发送"><a href="#1．方式2发送" class="headerlink" title="1．方式2发送"></a>1．方式2发送</h4><p>  发送前，先根据协议由软件设置TB8（如奇偶校验位或多机通信的地址&#x2F;数据标志位），然后将要发送的数据写入SBUF，即启动发送。TB8自动装入第9位数据位，逐一发送。发送完毕，使TI位置“1”。</p>
<p>  发送时序如图7-14。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223212601173.png" class="" title="image-20231223212601173">

<h4 id="2．方式2接收"><a href="#2．方式2接收" class="headerlink" title="2．方式2接收"></a>2．方式2接收</h4><p>  SM0、SM1&#x3D;10，且REN&#x3D;1时，方式2接收。数据由RXD端输入，接收11位信息。当位检测逻辑采样到RXD的负跳变，判断起始位有效，便开始接收一帧信息。在接收完第9位数据后，需满足以下两个条件，才能将接收到的数据送入SBUF（接收缓冲器）。</p>
<p>  （1）RI&#x3D;0，意味着接收缓冲器为空。</p>
<p>  （2）SM2&#x3D;0或接收到的第9位数据位RB8&#x3D;1。</p>
<p>  当满足上述两个条件时，收到的数据送SBUF（接收缓冲器），第9位数据送入RB8，且RI置“1”。若不满足这两个条件，接收的信息将被丢弃。</p>
<p>串行口方式2和方式3<strong>接收时序</strong>如图7-15。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223212625078.png" class="" title="image-20231223212625078">

<h3 id="7-2-4-方式3"><a href="#7-2-4-方式3" class="headerlink" title="7.2.4  方式3"></a>7.2.4  方式3</h3><p>  SM0、SM1&#x3D;11时，方式3。为波特率可变的9位异步通信方式，除了波特率外，方式3和方式2相同。方式3发送和接收时序如图7-11和图7-12所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223212642616.png" class="" title="image-20231223212642616">

<h2 id="7-3-多机通信"><a href="#7-3-多机通信" class="headerlink" title="7.3  多机通信"></a>7.3  多机通信</h2><p>  多个单片机可利用串口进行多机通信，常采用图7-16的主从式结构。系统中1个主机（单片机或其他有串行接口的微机）和多个单片机组成的从机系统。主机的RXD与所有从机的TXD端相连，TXD与所有从机的RXD端相连。从机地址分别为01H、02H和03H。</p>
<p>主从式只有一个主机，其余全是从机。主机发送的信息可以被所有从机接收，任何一个从机发送的信息，只能由主机接收。从机和从机之间不能进行直接通信，只能经主机才能实现。</p>
<h4 id="多机通信的工作原理"><a href="#多机通信的工作原理" class="headerlink" title="多机通信的工作原理"></a>多机通信的工作原理</h4><p>  要保证主机与所选择的从机通信，须保证串口有识别功能。SCON中的SM2位就是为满足这一条件设置的多机通信控制位。其工作原理是在串行口以方式2（或方式3）接收时，若SM2&#x3D;1，则表示进行多机通信，可能以下两种情况：</p>
<p>（1）从机接收到的主机发来的第9位数据RB8&#x3D;1时，前8位数据才装入SBUF，并置中断标志RI &#x3D; 1，向CPU发出中断请求。</p>
<p>  在中断服务程序中，从机把接收到的SBUF中的数据存入数据缓冲区中。</p>
<p>  （2）如果从机接收到的第9位数据RB8&#x3D;0时，则不产生中断标志RI&#x3D;1，不引起中断，从机不接收主机发来的数据。</p>
<p>   若SM2 &#x3D; 0，则接收的第9位数据不论是0还是1，从机都将产生RI &#x3D; 1中断标志，接收到的数据装入SBUF中。</p>
<p>应用这一特性，可实现多机通信。</p>
<h4 id="多机通信的工作过程"><a href="#多机通信的工作过程" class="headerlink" title="多机通信的工作过程"></a>多机通信的工作过程</h4><p>（1）各从机初始化程序允许从机串口中断，将串口编程为方式2或方式3接收，即9位异步通信方式，且SM2和REN位置“1”，使从机处于多机通信且只接收地址帧的状态。</p>
<p>（2）在主机和某从机通信之前，先将从机地址（即准备接收数据的从机）发送给各个从机，接着才传送数据（或命令），主机发出的地址帧信息的第9位为1，数据（或命令）帧的第9位为0。当主机向各从机发送地址帧时，各从机的串行口接收到的第9位信息RB8为1，且由于各从机的SM2&#x3D;1，</p>
<p>则RI置“1”，各从机响应中断，在中断服务子程序中，判断主机送来的地址是否和本机地址相符合，若为本机地址，则该从机SM2位清“0”，准备接收主机的数据或命令；若地址不相符，则保持SM2 &#x3D; 1。</p>
<p> （3）接着主机发送数据（或命令）帧，数据帧的第9位为0。此时各从机接收到的RB8&#x3D;0。</p>
<p> 只有与前面地址相符合的从机（即SM2位已清“0”的从机）才能激活中断标志位RI，从而进入中断服务程序，接收主机发来的数据（或命令）；</p>
<p>  与主机发来的地址不相符的从机，由于SM2保持为1，又RB8 &#x3D; 0，因此不能激活中断标志RI，就不能接受主机发来的数据帧。从而保证主机与从机间通信的正确性。</p>
<p>  此时主机与建立联系的从机已经设置为单机通信模式，即在整个通信中，通信的双方都要保持发送数据的第9位（即TB8位）为0，防止其他从机误接收数据。</p>
<p> （4）结束数据通信并为下一次的多机通信做好准备。在多机系统，每个从机都被赋予唯一的地址。例如，图7-16三个从机的地址可设为：01H、02H、03H。</p>
<p>  还要预留1~2个“广播地址”，它是所有从机共有的地址，例如将“广播地址”设为00H。当主机与从机的数据通信结束后，一定要将从机再设置为多机通信模式，以便进行下一次的多机通信。</p>
<p>这时要求与主机正在进行数据传输的从机须随时注意，一旦接收的数据第9位（RB8）为“1”，说明主机传送的不再是数据，而是地址，这个地址就有可能是“广播地址”。</p>
<p>当收到“广播地址”后，便将从机的通信模式再设置成多机模式，为下一次多机通信做好准备。</p>
<h2 id="7-4-波特率的制定"><a href="#7-4-波特率的制定" class="headerlink" title="7.4  波特率的制定"></a>7.4  波特率的制定</h2><p>  串行通信，收、发双方发送或接收的波特率必须一致。4种工作方式：</p>
<p>  方式0和方式2的波特率是固定的；</p>
<p>  方式1和方式3的波特率是可变的，由T1溢出率确定。</p>
<h3 id="7-4-1-波特率的定义"><a href="#7-4-1-波特率的定义" class="headerlink" title="7.4.1  波特率的定义"></a>7.4.1  波特率的定义</h3><p>  波特率的定义：串行口每秒钟发送（或接收）的位数。设发送一位所需要的时间为T，则波特率为1&#x2F;T。</p>
<p>  定时器的不同工作方式，得到的波特率的范围不一样，这是由T1在不同工作方式下计数位数的不同所决定。</p>
<p>7.4.2  定时器T1产生波特率的计算</p>
<p>和串行口的工作方式有关。</p>
<p>（1）方式0时，波特率固定为时钟频率fosc的1&#x2F;12，不受SMOD位值的影响。若fosc &#x3D; 12 MHz，波特率1Mbit&#x2F;s。</p>
<p>（2）方式2时，波特率仅与SMOD位的值有关。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223212950930.png" class="" title="image-20231223212950930">

<p>若fosc &#x3D; 12 MHz： SMOD &#x3D; 0，波特率 &#x3D; 187.5 kbit&#x2F;s；SMOD &#x3D; 1，波特率 &#x3D; 375 kbit&#x2F;s。</p>
<p>（3）方式1或方式3定时，常用T1作为波特率发生器，其关系式为</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223213013289.png" class="" title="image-20231223213013289">

<p>由式（7-1）见，T1溢出率和SMOD的值共同决定波特率。</p>
<p>在实际设定波特率时，T1常设置为方式2定时（自动装初值），即TL1作为8位计数器，TH1存放备用初值。这种方式操作方便，也避免因软件重装初值带来的定时误差。</p>
<p>设定时器T1方式2的初值为X，则有</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223213026543.png" class="" title="image-20231223213026543">

<p>将式（7-2）代入式（7-1），则</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223213055391.png" class="" title="image-20231223213055391">

<p>由式（7-3）可见，波特率随fosc、SMOD和初值X而变化。</p>
<p>实际使用时，经常根据已知波特率和时钟频率fosc来计算T1的初值X。为避免繁杂的初值计算，常用的波特率和初值X间的关系常列成表7-2形式，供查用。</p>
<table>
<thead>
<tr>
<th>波 特 率</th>
<th><em>f</em>osc</th>
<th>SMOD位</th>
<th>方式</th>
<th>初值<em>X</em></th>
</tr>
</thead>
<tbody><tr>
<td>62.5kbit&#x2F;s</td>
<td>12  MHz</td>
<td>1</td>
<td>2</td>
<td>FFH</td>
</tr>
<tr>
<td>19.2kbit&#x2F;s</td>
<td>11.0592  MHz</td>
<td>1</td>
<td>2</td>
<td>FDH</td>
</tr>
<tr>
<td>9.6kbit&#x2F;s</td>
<td>11.0592  MHz</td>
<td>0</td>
<td>2</td>
<td>FDH</td>
</tr>
<tr>
<td>4.8kbit&#x2F;s</td>
<td>11.0592  MHz</td>
<td>0</td>
<td>2</td>
<td>FAH</td>
</tr>
<tr>
<td>2.4kbit&#x2F;s</td>
<td>11.0592  MHz</td>
<td>0</td>
<td>2</td>
<td>F4H</td>
</tr>
<tr>
<td>1.2kbit&#x2F;s</td>
<td>11.0592  MHz</td>
<td>0</td>
<td>2</td>
<td>E8H</td>
</tr>
</tbody></table>
<p>表7-2有两点需要注意：</p>
<p>（1）在使用的时钟振荡频率fosc为12MHz或6MHz时，将初值X和fosc带入式（7-3）中计算出的波特率有一定误差。消除误差可采用时钟频率11.0592MHz。</p>
<p>（2）如果选用很低的波特率，如选为55，可将定时器T1设为方式1定时。但这种情况，T1溢出时，需在中断服务程序中重新装入初值。中断响应时间和执行指令时间会使波特率产生一定的误差，可用改变初值的方法加以调整。</p>
<p>【例7-3】 若时钟频率为11.0592MHz，选用T1的方式2定时作为波特率发生器，波特率为2 400bit&#x2F;s，求初值。</p>
<p>  设T1为方式2定时，选SMOD &#x3D; 0。</p>
<p>  将已知条件带入式（7-3）中</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223213211412.png" class="" title="image-20231223213211412">

<p>从中解得：X &#x3D; 244 &#x3D; F4H。</p>
<p>  只要把F4H装入TH1和TL1，则T1产生的波特率为2 400bit&#x2F;s。也可直接从表7-2中查到。</p>
<p>  这里时钟振荡频率选为11.0592MHz，就可使初值为整数，从而产生精确的波特率。</p>
<h2 id="7-5-串行通信的应用设计"><a href="#7-5-串行通信的应用设计" class="headerlink" title="7.5  串行通信的应用设计"></a>7.5  串行通信的应用设计</h2><p>  串行通信接口设计时，需考虑如下问题。</p>
<p>  （1）首先确定串行通信双方的数传速率和通信距离；</p>
<p>  （2）由串行通信的数传速率和通信距离确定采用的串行通信接口标准；</p>
<p>  （3）注意串行通信的通信线选择，一般选用双绞线较好，并根据传输的距离选择纤芯的直径。如空间干扰较多，还要选择带有屏蔽层的双绞线。</p>
<p>  下面首先介绍有关串行通信的接口设计问题。 </p>
<h3 id="7-5-1-各种串行通信接口标准"><a href="#7-5-1-各种串行通信接口标准" class="headerlink" title="7.5.1  各种串行通信接口标准"></a>7.5.1  各种串行通信接口标准</h3><p>  AT89S51单串口的输入、输出均为TTL电平。以TTL电平串行传输数据的方式，抗干扰性差，传输距离短，速率低。为了提高串行通信可靠性，增大串行通信的距离和提高传输速率，一般都采用标准串行接口，如RS-232、RS-422A、RS-485等。</p>
<p>  根据AT89S51单片机的双机通信距离和抗干扰性的实际要求，可选择TTL电平传输，或选择RS-232C、RS-422A、RS-485串行接口进行串行数据传输。 </p>
<h4 id="1．TTL电平通信接口"><a href="#1．TTL电平通信接口" class="headerlink" title="1．TTL电平通信接口"></a>1．TTL电平通信接口</h4><p>  如两个AT89S51单片机相距在1.5m内，它们的串口可直接相连，接口电路如图7-9所示。甲机的RXD与乙机的TXD端相连，乙机的RXD与甲机的TXD端相连，从而直接用TTL电平传输方法来实现双机通信。</p>
<h4 id="2．RS-232C双机通信接口"><a href="#2．RS-232C双机通信接口" class="headerlink" title="2．RS-232C双机通信接口"></a>2．RS-232C双机通信接口</h4><p>  如果双机通信距离在1.5m ~15m之间时，可利用RS-232C标准接口实现点对点的双机通信，接口电路如图7-17所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223213302470.png" class="" title="image-20231223213302470">

<h4 id="3．RS-422A双机通信接口"><a href="#3．RS-422A双机通信接口" class="headerlink" title="3．RS-422A双机通信接口"></a>3．RS-422A双机通信接口</h4><p>  RS-232C缺点：传输速率低、通讯距离短、接口处信号容易产生串扰等。国际上又推出了RS-422A标准。与RS-232C的主要区别是，收发双方的信号地不再共地，RS-422A采用了平衡驱动和差分接收的方法。用于数据传输是两条平衡导线，这相当于两个单端驱动器。</p>
<p>  两条线上传输的信号电平，当一个表示逻辑“1”时，另一条一定为逻辑“0”。若传输中，信号中混入干扰和噪声（共模形式），由于差分接收器的作用，就能识别有用信号并正确接收传输的信息，并使干扰和噪声相互抵消。</p>
<p>RS-422A能在长距离、高速率下传输。最大传输率为10Mbit&#x2F;s，电缆允许长度为12m，如采用较低传输速率时，最大传输距离可达1219m。</p>
<p>为了增加通信距离，可采用光电隔离，利用RS-422A标准进行双机通信的接口电路如图7-18。</p>
<p>图中，每个通道的接收端都接有3个电阻R1、R2和R3，其中R1为传输线的匹配电阻，取值范围在50OMU～1kOMU，其他两个电阻是为了解决第一个数据的误码而设置的匹配电阻。为了起到隔离、抗干扰的作用，图7-18中须使用两组独立的电源。</p>
<p>图中的SN75174、SN75175是TTL电平到RS-422A电平与RS-422A电平到TTL电平的电平转换芯片。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223213331384.png" class="" title="RS-422A双机通信接口电路">

<h4 id="4．RS-485双机通信接口"><a href="#4．RS-485双机通信接口" class="headerlink" title="4．RS-485双机通信接口"></a>4．RS-485双机通信接口</h4><p>  RS-422A通信需四芯传输线，长距离通信很不经济，故在工业现场，通常采用双绞线传输的RS-485串行通信接口，很容易实现多机通信。</p>
<p>  RS-485是RS-422A的变型，它与RS-422A的区别：RS-422A为全双工，采用两对平衡差分信号线；RS-485为半双工，采用一对平衡差分信号线。</p>
<p>  RS-485对于多站互连是十分方便的，容易实现多机通信。RS-485允许最多并联32台驱动器和32台接收器。图7-19为RS-485通信接口电路。与RS-422A一样，最大传输距离约1219m，最大传输速率为10Mbit&#x2F;s。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223213437641.png" class="" title="image-20231223213437641">

<p>通信线路要采用平衡双绞线。平衡双绞线的长度与传输速率成反比，在100kbit&#x2F;s速率以下，才可能使用规定的最长电缆。</p>
<p>  只有在很短的距离下才能获得最大传输速率。一般100m长双绞线最大传输速率仅为1Mbit&#x2F;s。</p>
<p>  图7-19，RS-485以双向、半双工方式来实现双机通信。在AT89S51单片机系统发送或接收数据前，应先将SN75176的发送门或接收门打开，当P1.0&#x3D;1时，发送门打开，接收门关闭；当P1.0&#x3D;0时，接收门打开，发送门关闭。</p>
<p>图7-19中的SN75176芯片内集成了一个差分驱动器和一个差分接收器，且兼有TTL电平到RS-485电平、RS-485电平到TTL电平的转换功能。</p>
<p>  此外常用的RS-485接口芯片还有MAX485。</p>
<h3 id="7-5-2-方式1的应用"><a href="#7-5-2-方式1的应用" class="headerlink" title="7.5.2  方式1的应用"></a>7.5.2  方式1的应用</h3><p>  【例7-4】如图7-20所示，甲、乙双机串行通信，双机的RXD和TXD相互交叉相连，甲机的P1口接8个开关，乙机的P1口接8个发光二极管。甲机设置为只发不收的单工方式。要求甲机读入P1口的8个开关的状态后，通过串行口发送到乙机，乙机将接收到的甲机的8个开关的状态数据送入P1口，</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223213514933.png" class="" title="image-20231223213514933">

<p>由P1口的8个发光二极管来显示8个开关的状态。双方晶振均采用11.0592MHz。参考程序如下。  </p>
<pre class="language-C" data-language="C"><code class="language-C">&#x2F;*甲机串行发送*&#x2F;
#include &lt;reg51.h&gt;
#define uchar unsigned char
#define uint unsigned int
void main()
&#123;
    uchar temp &#x3D; 0;
    TMOD &#x3D; 0x20；                  &#x2F;*设置定时器T1为方式2*&#x2F;
        TH1 &#x3D; 0xfd；               &#x2F;*波特率9600*&#x2F;
        TL1 &#x3D; 0xfd； SCON &#x3D; 0x40； &#x2F;*方式1只发送，不接收*&#x2F;
        PCON &#x3D; 0x00；              &#x2F;*串行口初始化为方式0*&#x2F;
        TR1 &#x3D; 1；                  &#x2F;*启动T1*&#x2F;
        P1 &#x3D; 0xff；                &#x2F;* P1口为输入*&#x2F;
        while (1)
    &#123;
        temp &#x3D; P1；          &#x2F;*读入P1口开关的状态数据*&#x2F;
            SBUF &#x3D; temp；    &#x2F;*数据送串行口发送*&#x2F;
            while (TI &#x3D;&#x3D; 0); &#x2F;*如果TI&#x3D;0，未发送完，循环等待*&#x2F;
        TI &#x3D; 0;              &#x2F;*已发送完，再把TI清0*&#x2F;
    &#125;
&#125;
&#x2F;*乙机串行接收*&#x2F;
#include &lt;reg51.h&gt;
#define uchar unsigned char
#define uint unsigned int
void main()
&#123;
    uchar temp &#x3D; 0;
    TMOD &#x3D; 0x20；                  &#x2F;*设置定时器T1为方式2*&#x2F;
        TH1 &#x3D; 0xfd；               &#x2F;*波特率9600*&#x2F;
        TL1 &#x3D; 0xfd； SCON &#x3D; 0x50； &#x2F;*设置串口为方式1接收，REN&#x3D;1*&#x2F;
        PCON &#x3D; 0x00；              &#x2F;*SMOD&#x3D;0*&#x2F;
        TR1 &#x3D; 1；                  &#x2F;*启动T1*&#x2F;
        while (1)
    &#123;
        while (RI &#x3D;&#x3D; 0)
            ;           &#x2F;* 若RI为0，未接收到数据*&#x2F;
        RI &#x3D; 0;         &#x2F;* 接收到数据，则把RI清0*&#x2F;
        temp &#x3D; SBUF；   &#x2F;* 读取数据存入temp中*&#x2F;
            P1 &#x3D; temp； &#x2F;* 接收的数据送P1口控制8个LED的亮与灭*&#x2F;
    &#125;
&#125;
</code></pre>

<p>【例7- 5】 如图7-9所示，甲乙两机以方式1进行串行通信，其中甲机发送信息，乙机接收信息，双方晶振频率均为11.0592MHz，波特率为2400bps。 </p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223212302043.png" class="" title="image-20231223212302043">

<p>当串行通信开始时，双方约定，甲机先发送信号AAH，乙机收到后应答BBH，表示同意接收。甲机收到BBH后，即可发送数据。如果乙机发现数据出错，就向甲机发送FFH，甲机收到FFH后，重新发送数据给乙机。</p>
<p>   设发送的字节块的数据长度为10字节，数据缓冲区为buf，数据发送完毕要立即发送校验和，进行数据发送准确性验证。乙机接收到的数据存储到数据缓冲区buf，收到一个数据块后，再接收甲机发来的校验和，并将其与乙机求得的校验和比较：若相等，说明接收正确，乙机回答00H；若不等，说明接收不正确，乙机回答FFH；请求甲机重新发送。     </p>
<p>选择定时器T1为方式2定时，波特率不倍增，即SMOD&#x3D;0。查表7-2，则写入T1的初值应为F4H。</p>
<p>以下为双机通信程序，该程序可以在甲乙两机中运行，不同的是在程序运行之前，要人为地选择TR。若选择TR&#x3D;0，表示该机为发送方；若选择TR&#x3D;1，表示该机是接收方。程序根据TR的设置，利用发送函数send( )和接收函数receive( )分别实现发送和接收功能。      </p>
<pre class="language-C" data-language="C"><code class="language-C">#include &lt;reg51.h&gt;
#define uchar unsigned char
#define TR 1                   &#x2F;* 接收、发送的区别值，TR&#x3D;0，为发送*&#x2F;
uchar idata buf[10] uchar sum; &#x2F;* 校验和*&#x2F;
&#x2F;*串口初始化函数*&#x2F;
void init(void)
&#123;
    TMOD &#x3D; 0x20；                  &#x2F;*T1方式2定时*&#x2F;
        TH1 &#x3D; 0xf4；               &#x2F;*波特率2400*&#x2F;
        TL1 &#x3D; 0xf4； PCON &#x3D; 0x00； &#x2F;*SMOD&#x3D;0*&#x2F;
        TR1 &#x3D; 1；                  &#x2F;*启动T1*&#x2F;
        SCON &#x3D; 0x50；              &#x2F;*串行口方式1，REN&#x3D;1允许接收*&#x2F;
&#125;
&#x2F;*主程序*&#x2F;
void main(void)
&#123;
    init();
    if (TR &#x3D;&#x3D; 0) &#x2F;* TR&#x3D;0，为发送*&#x2F;
    &#123;
        send();
    &#125; &#x2F;*调用发送函数*&#x2F;
    else
    &#123;
        receive();
    &#125; &#x2F;*调用接收函数*&#x2F;
&#125;
&#x2F;*发送函数*&#x2F;
void send(void)
&#123;
    uchar i； do
    &#123;
        SBUF &#x3D; 0xAA; &#x2F;*发送联络信号*&#x2F;
        while (TI &#x3D;&#x3D; 0)
            ; &#x2F;*等待数据发送完毕*&#x2F;
        TI &#x3D; 0;
        while (RI &#x3D;&#x3D; 0)
            ; &#x2F;*等待乙机应答*&#x2F;
        RI &#x3D; 0;
    &#125;
    while (SBUF ^ 0xBB !&#x3D; 0)
        ; &#x2F;*乙机未准备好，继续联络*&#x2F;
    do
    &#123;
        sum &#x3D; 0； &#x2F;*校验和变量清0*&#x2F;
            for (i &#x3D; 0; i &lt; 16; i++)
        &#123;
            sum + &#x3D; buf[i]; &#x2F;*求校验和*&#x2F;
            while (TI &#x3D;&#x3D; 0)
                ;
            TI &#x3D; 0;
        &#125;
        SBUF &#x3D; sum while (TI &#x3D;&#x3D; 0);
        TI &#x3D; 0;
        while (RI &#x3D;&#x3D; 0)
            ;
        RI &#x3D; 0;
    &#125; while (SBUF !&#x3D; 0); &#x2F;*出错，重新发送*&#x2F;
&#125;
&#x2F;*接收函数*&#x2F;
void receive（）
&#123;
    uchar i； do &#123;&#125;
    while (RI &#x3D;&#x3D; 0)
        ;
    RI &#x3D; 0;
    while (SBUF ^ 0xAA !&#x3D; 0)
        ;        &#x2F;*判甲机是否发出请求*&#x2F;
    SBUF &#x3D; 0xBB; &#x2F;*发送应答信号BBH*&#x2F;
    while (TI &#x3D;&#x3D; 0)
        ; &#x2F;*等待发送结束*&#x2F;
    TI &#x3D; 0;
    while (1)
    &#123;
        sum &#x3D; 0； &#x2F;*清校验和*&#x2F;
            for (i &#x3D; 0; i &lt; 16; i++) while (RI &#x3D;&#x3D; 0);
        RI &#x3D; 0;        &#x2F;*接收校验和*&#x2F;
        buf[i] &#x3D; SBUF; &#x2F;*接收一个数据*&#x2F;
        sum +&#x3D; buf[i]; &#x2F;*求校验和*&#x2F;
    &#125;
    while (RI &#x3D;&#x3D; 0)
        ;
    RI &#x3D; 0; &#x2F;*接收甲机的校验和*&#x2F;
    if ((SBUF ^ sum) &#x3D;&#x3D; 0)
        ; &#x2F;*比较校验和*&#x2F;
    &#123;
        SBUF &#x3D; 0x00;
        break;
    &#125; &#x2F;*校验和相等，则发00H*&#x2F;
    else
    &#123;
        SBUF &#x3D; 0xFF; &#x2F;*出错发FFH，重新接收*&#x2F;
        while (TI &#x3D;&#x3D; 0)
            ;
        TI &#x3D; 0;
    &#125;
&#125;
</code></pre>

<h3 id="7-5-3-方式2和方式3的应用"><a href="#7-5-3-方式2和方式3的应用" class="headerlink" title="7.5.3  方式2和方式3的应用"></a>7.5.3  方式2和方式3的应用</h3><p>  方式2和方式1两点不同。方式2收&#x2F;发11位信息，第0位为起始位，第1～8位为数据位，第9位是程控位，可由用户置TB8决定，第10位是停止位1，这是一个不同点。另一不同点是方式2波特率变化范围比方式1小，方式2波特率&#x3D;振荡器频率&#x2F;n。</p>
<p>  当SMOD &#x3D; 0时，n &#x3D; 64。</p>
<p>  当SMOD &#x3D; 1时，n &#x3D; 32。</p>
<p>  除波特率的差别外，方式2的使用和方式3是一样的，所以下面介绍的方式3应用编程，也适用于方式2。</p>
<p>  【例7-6】甲乙两个单片机进行方式3（或方式2）串行通讯。甲机将8个流水灯控制数据发送给乙机，乙机再利用该数据点亮其P1口的8个LED。方式3比方式1多了一个可编程位TB8，该位一般作奇偶校验位。乙机接收到的8位二进制数据有可能出错，需进行奇偶校验，其方法是将乙机的RB8和PSW的奇偶校验位P进行比较，如相同，接收数据；否则拒绝接收。参考程序如下。 </p>
<pre class="language-C" data-language="C"><code class="language-C">甲机发送程序如下：
#include &lt;reg51.h&gt;
sbit p &#x3D; PSW ^ 0;                                                            &#x2F;* p位定义为PSW 寄存器的第0位，即奇偶校验位*&#x2F;
unsigned char code Tab[] &#x3D; &#123;0xfe, 0xfd, 0xfb, 0xf7, 0xef, 0xdf, 0xbf, 0x7f&#125;; &#x2F;*控制流水灯显示数据，数组被定义为全局变量*&#x2F;
void Send(unsigned char dat)                                                 &#x2F;* 发送一个字节数据的函数*&#x2F;
&#123;
    dat &#x3D; ACC;
    TB8 &#x3D; p；            &#x2F;* 将奇偶校验位写入TB8*&#x2F;
        SBUF &#x3D; dat；     &#x2F;* 将待发送的数据写入发送缓冲器*&#x2F;
        while (TI &#x3D;&#x3D; 0); &#x2F;* 检测发送标志位TI， TI&#x3D;0，未发送完*&#x2F;
    ;                    &#x2F;* 空操作*&#x2F;
    TI &#x3D; 0;              &#x2F;* 一个字节发送完，TI清0*&#x2F;
&#125;
void Delay(void) &#x2F;* 延时大约200ms函数*&#x2F;
&#123;
    unsigned char m, n;
    for (m &#x3D; 0; m &lt; 250; m++)
        ;
    for (n &#x3D; 0; n &lt; 250; n++)
        ;
&#125;
void main(void) &#x2F;* 主函数*&#x2F;
&#123;
    unsigned char i;
    TMOD &#x3D; 0x20；              &#x2F;*设置定时器T1为方式2*&#x2F;
        SCON &#x3D; 0xc0；          &#x2F;*设置串口为方式3*&#x2F;
        PCON &#x3D; 0x00；          &#x2F;*SMOD&#x3D;0*&#x2F;
        TH1 &#x3D; 0xfd；           &#x2F;*给定时器T1赋初值，波特率设置为9600*&#x2F;
        TL1 &#x3D; 0xfd； TR1 &#x3D; 1； &#x2F;*启动定时器T1*&#x2F;
        while (1)
    &#123;
        for (i &#x3D; 0; i &lt; 8; i++)
            ;
        &#123;
            Send(Tab[i]);
            Delay()；&#x2F;*大约200ms发送一次数据*&#x2F;
        &#125;
    &#125;
&#125;
&#x2F;&#x2F; 乙机接收程序如下：
#include &lt;reg51.h&gt;
sbit p &#x3D; 0xd0;              &#x2F;* p位为PSW 寄存器的第0位，即奇偶校验位*&#x2F;
unsigned char Receive(void) &#x2F;*接收一个字节数据的函数*&#x2F;
&#123;
    unsigned char dat;
    while (RI &#x3D;&#x3D; 0)
        ;             &#x2F;*检测接收中断标志RI，RI&#x3D;0，未接收完，则循环等待*&#x2F;
    ； RI &#x3D; 0；       &#x2F;*已接收一帧数据，将RI清0*&#x2F;
        ACC &#x3D; SBUF；  &#x2F;*将接收缓冲器的数据存于ACC*&#x2F;
        if (RB8 &#x3D;&#x3D; P) &#x2F;*只有奇偶校验成功才接收数据*&#x2F;
    &#123;
        dat &#x3D; ACC；     &#x2F;*将接收缓冲器的数据，存于dat*&#x2F;
            return dat; &#x2F;*将接收的数据返回*&#x2F;
    &#125;
&#125;
void main(void) &#x2F;*主函数*&#x2F;
&#123;
    TMOD &#x3D; 0x20；     &#x2F;*设置定时器T1为方式2*&#x2F;
        SCON &#x3D; 0xd0； &#x2F;*设置串口为方式3，允许接收REN&#x3D;1*&#x2F;
        PCON &#x3D; 0x00； &#x2F;* SMOD&#x3D;0*&#x2F;
        TH1 &#x3D; 0xfd；  &#x2F;*给定时器T1赋初值，波特率为9600&#x2F;
          TL1&#x3D;0xfd；
          TR1&#x3D;1；	&#x2F;*接通定时器T1*&#x2F;
        REN &#x3D; 1;      &#x2F;*允许接收*&#x2F;
    while (1)
    &#123;
        P1 &#x3D; Receive(); &#x2F;*将接收到的数据送P1口显示*&#x2F;
    &#125;
&#125;</code></pre>

<h3 id="7-5-4-主从式多机通信的应用"><a href="#7-5-4-主从式多机通信的应用" class="headerlink" title="7.5.4  主从式多机通信的应用"></a>7.5.4  主从式多机通信的应用</h3><p>介绍主从式多机通信的应用编程。</p>
<p>  【例7-7】如图7-16所示，主机分别与三个从机进行通信，这里仅以地址为01H的1#从机为例，实现主从机的通信，其他从机的程序与1#从机相同，只是定义的地址不同。约定如下。</p>
<p>（1）3台从机的地址为00H~02H。</p>
<p>（2）主机发出的地址FFH为一条控制指令，使所有从机都处于SM2&#x3D;1的状态。</p>
<p>（3）其余的控制指令：00H—接收指令，01H—发送指令。这两条指令是作为数据发送的。</p>
<p>（4）从机的状态字如图7-21所示</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223214209859.png" class="" title="image-20231223214209859">

<pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">/*主机程序*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg51.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">uchar</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">char</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Bytenum</span> <span class="token expression"><span class="token number">16</span> </span><span class="token comment">/*传送一次的字节数*/</span></span>

uchar <span class="token function">master</span><span class="token punctuation">(</span>uchar addrs<span class="token punctuation">,</span> uchar comnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
uchar slave <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span> <span class="token comment">/*从机地址*/</span>
uchar idata rdata<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
uchar idata tdata<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>“abcdefghijklmnop”<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    uchar i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>        <span class="token comment">/*延时参数可根据需要调整*/</span>
    TMOD <span class="token operator">=</span> <span class="token number">0x20</span><span class="token punctuation">;</span> <span class="token comment">/*设置T1为定时器方式2*/</span>
    TH1 <span class="token operator">=</span> <span class="token number">0xfa</span><span class="token punctuation">;</span>  <span class="token comment">/*波特率4800*/</span>
    TL1 <span class="token operator">=</span> <span class="token number">0xfa</span><span class="token punctuation">;</span>
    PCON <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
    SCON <span class="token operator">=</span> <span class="token number">0xd0</span><span class="token punctuation">;</span> <span class="token comment">/*方式3，允许接收，SM2=1*/</span>
    TR1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>     <span class="token comment">/*启动T1*/</span>
    SCON <span class="token operator">=</span> <span class="token number">0xd0</span><span class="token punctuation">;</span> <span class="token comment">/*方式3允许接收*/</span>
    <span class="token function">master</span><span class="token punctuation">(</span>slave<span class="token punctuation">,</span>
           <span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">master</span><span class="token punctuation">(</span>slave<span class="token punctuation">,</span> <span class="token number">0x02</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    slave<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    SBUF <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span> <span class="token comment">/*发给从机数据出错标志*/</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>TI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span> <span class="token comment">/*等待发送完*/</span>
    TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
uchar <span class="token function">master</span><span class="token punctuation">(</span>uchar addrs<span class="token punctuation">,</span> uchar comnd<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    uchar a<span class="token punctuation">,</span> i<span class="token punctuation">,</span> p<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        SBUF <span class="token operator">=</span> slave         <span class="token comment">/*发呼叫地址*/</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>TI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*等待发送完*/</span>
        TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>RI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">;</span> <span class="token comment">/*等待从机应答*/</span>
        RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>SBUF <span class="token operator">!=</span> addrs<span class="token punctuation">)</span>
            <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/*若地址出错，发出错标志，从机复位*/</span>
                <span class="token keyword">else</span>
            <span class="token punctuation">&#123;</span>
                TB8 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token comment">/*清地址标志位，准备接收数据*/</span>
                SBUF <span class="token operator">=</span> comnd<span class="token punctuation">;</span> <span class="token comment">/*发命令帧*/</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>TI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    <span class="token punctuation">;</span>
                TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>RI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    <span class="token punctuation">;</span>
                RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                a <span class="token operator">=</span> SBUF<span class="token punctuation">;</span> <span class="token comment">/*接收从机返回的地址帧*/</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">80</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                        TB8 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                        <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token comment">/*若主机命令非法，发复位信号给从机*/</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>comnd <span class="token operator">==</span> <span class="token number">0x01</span><span class="token punctuation">)</span>
                        <span class="token punctuation">;</span>                       <span class="token comment">/*主机发送的命令是请求从机接收数据*/</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&amp;</span> <span class="token number">0x01</span><span class="token punctuation">)</span><span class="token operator">==</span> <span class="token number">0x01</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>		<span class="token comment">/*从机准备接收就绪*/</span>
                    <span class="token punctuation">&#123;</span>
                        <span class="token keyword">do</span>
                        <span class="token punctuation">&#123;</span>
                            p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/*清校验和*/</span>
                            <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Bytenum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                                <span class="token punctuation">;</span>
                            <span class="token punctuation">&#123;</span>
                                SBUF <span class="token operator">=</span> tdata<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/*发送数据*/</span>
                                p <span class="token operator">=</span> p <span class="token operator">+</span> tdata<span class="token punctuation">;</span>   <span class="token comment">/*计算校验和*/</span>
                                <span class="token keyword">while</span> <span class="token punctuation">(</span>TI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">;</span>
                                TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>
                            SBUF <span class="token operator">=</span> p<span class="token punctuation">;</span> <span class="token comment">/*发送校验和给从机*/</span>
                            <span class="token keyword">while</span> <span class="token punctuation">(</span>TI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                                <span class="token punctuation">;</span>
                            TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                            <span class="token keyword">while</span> <span class="token punctuation">(</span>RI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                                <span class="token punctuation">;</span>
                            RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>SBUF <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*从机接收不正确，主机重新发送*/</span>
                        TB8 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>comnd <span class="token operator">==</span> <span class="token number">0x02</span><span class="token punctuation">)</span>
                        <span class="token punctuation">;</span> <span class="token comment">/*主机发送的是接收命令，从机发送数据*/</span>
                    <span class="token punctuation">&#123;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&amp;</span> <span class="token number">0x02</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0x02</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>		<span class="token comment">/*从机准备接收就绪*/</span>
                        <span class="token punctuation">&#123;</span>
                            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                                <span class="token punctuation">;</span>
                            p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/*清校验和*/</span>
                            <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Bytenum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                                <span class="token punctuation">;</span>
                            <span class="token keyword">while</span> <span class="token punctuation">(</span>RI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                                <span class="token punctuation">;</span>
                            RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                            rdata<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> SBUF<span class="token punctuation">;</span> <span class="token comment">/*主机接收数据*/</span>
                            p <span class="token operator">+=</span> rdata<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                        <span class="token keyword">while</span> <span class="token punctuation">(</span>RI <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                            <span class="token punctuation">;</span>
                        RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>SBUF <span class="token operator">==</span> p<span class="token punctuation">)</span>
                            <span class="token punctuation">;</span>
                        <span class="token punctuation">&#123;</span>
                            SBUF <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span> <span class="token comment">/*校验和相同，发送0x00给从机*/</span>
                            <span class="token keyword">while</span> <span class="token punctuation">(</span>TI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                                <span class="token punctuation">;</span>
                            TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                        <span class="token keyword">else</span>
                        <span class="token punctuation">&#123;</span>
                            SBUF <span class="token operator">=</span> <span class="token number">0x0f</span><span class="token punctuation">;</span> <span class="token comment">/*校验和不同，发送0x0f给从机*/</span>
                            <span class="token keyword">while</span> <span class="token punctuation">(</span>TI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                                <span class="token punctuation">;</span>
                            TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    TB8 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/*重置地址标志位*/</span>
                    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

</code></pre>

<pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">/*从机程序*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg51.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">uchar</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">char</span> </span><span class="token comment">/*传送一次的字节数*/</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">slave</span> <span class="token expression"><span class="token number">0x00</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Bytenum</span> <span class="token expression"><span class="token number">16</span></span></span>
uchar idata tdata<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
uchar idata rdata<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
bit trdy<span class="token punctuation">;</span>
bit rrdy<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    TMOD <span class="token operator">=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>    <span class="token comment">/*设置T1为定时器方式2*/</span>
        TL1 <span class="token operator">=</span> <span class="token number">0xfa</span><span class="token punctuation">;</span> <span class="token comment">/*波特率4800*/</span>
        TH1 <span class="token operator">=</span> <span class="token number">0xfa</span><span class="token punctuation">;</span>
    PCON <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span> TR1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> SCON <span class="token operator">=</span> <span class="token number">0xf0</span><span class="token punctuation">;</span> <span class="token comment">/*方式3，允许接收，SM2=1*/</span>
        ES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    EA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/*允许串口中断*/</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        trdy <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        rrdy <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">/*准备好发送和接收*/</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">slave</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> interrupt <span class="token number">4</span> using <span class="token number">1</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">void</span> <span class="token function">str</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">sre</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uchar a<span class="token punctuation">;</span>
    RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    ES <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/*关串口中断*/</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>SBUF <span class="token operator">!=</span> slave<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        ES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> reti<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>              <span class="token comment">/*非本机地址，继续监听*/</span>
    SM2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>       <span class="token comment">/*取消监听状态*/</span>
    SBUF <span class="token operator">=</span> slave<span class="token punctuation">;</span> <span class="token comment">/*发回从机地址*/</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>TI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>RI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>RB8 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        SM2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        ES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> reti<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">/*确认地址不符，从机复位*/</span>
    a <span class="token operator">=</span> SBUF<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token number">0x01</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span> <span class="token comment">/*从机接收主机的数据*/</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rrdy <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
            SBUF <span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">;</span> <span class="token comment">/*接收准备好，发回0x01*/</span>
        <span class="token keyword">else</span>
            SBUF <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>TI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">;</span>TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>RI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>RB8 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                SM2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                ES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">goto</span> reti<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>  <span class="token comment">/*确认地址不符，从机复位*/</span>
        <span class="token function">sre</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*接收数据*/</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token number">0x02</span><span class="token punctuation">)</span> <span class="token comment">/*从机向主机发送数据*/</span>
        <span class="token punctuation">&#123;</span>
            <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>trdy <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    SBUF <span class="token operator">=</span> <span class="token number">0x02</span><span class="token punctuation">;</span> <span class="token comment">/*发送准备好*/</span>
                <span class="token keyword">else</span>
                    SBUF <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>TI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    <span class="token punctuation">;</span>TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>RI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>RB8 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                        SM2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                        ES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                        <span class="token keyword">goto</span> reti<span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*发送数据*/</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">&#123;</span>
                SBUF <span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span> <span class="token comment">/*命令非法*/</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>TI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    <span class="token punctuation">;</span>TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> SM2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                ES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/*恢复监听*/</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    reti<span class="token operator">:</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">void</span> <span class="token function">str</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token comment">/*发送数据函数*/</span>
    <span class="token punctuation">&#123;</span>
        uchar p<span class="token punctuation">,</span> i<span class="token punctuation">;</span>
        trdy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">do</span>
        <span class="token punctuation">&#123;</span>
            p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Bytenum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token punctuation">;</span>
            <span class="token punctuation">&#123;</span>
                SBUF <span class="token operator">=</span> tdata<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/*发送数据*/</span>
                p <span class="token operator">+=</span> tdata<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>TI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    <span class="token punctuation">;</span>TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            SBUF <span class="token operator">=</span> p<span class="token punctuation">;</span> <span class="token comment">/*发送校验和*/</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>TI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">;</span>TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>RI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>SBUF <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">/*主机接收不正确，重新发送*/</span>
            SM2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        ES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">void</span> <span class="token function">sre</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token comment">/*接收数据函数*/</span>
    <span class="token punctuation">&#123;</span>
        uchar p<span class="token punctuation">,</span> i<span class="token punctuation">;</span>
        rrdy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">;</span>
            <span class="token punctuation">&#123;</span>
                p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/*初始化校验和为0*/</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Bytenum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                    <span class="token punctuation">;</span>
                <span class="token punctuation">&#123;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>RI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                        <span class="token punctuation">;</span>RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> tdata<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> SBUF<span class="token punctuation">;</span>
                            p <span class="token operator">+=</span> rdata<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>RI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    <span class="token punctuation">;</span>RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>SBUF <span class="token operator">!=</span> <span class="token operator">=</span> p<span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                        SBUF <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token comment">/*校验和相同，发00H*/</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">&#123;</span>
                    SBUF <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>TI <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                        <span class="token punctuation">;</span>TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/*校验不同，发FFH，重新接收*/</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        SM2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        ES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span></code></pre>

<h3 id="7-5-5-单片机与PC机的串行通信"><a href="#7-5-5-单片机与PC机的串行通信" class="headerlink" title="7.5.5  单片机与PC机的串行通信"></a>7.5.5  单片机与PC机的串行通信</h3><p>  测控系统中，常使用单片机进行数据采集，但由于单片机的数据存储容量和数据处理能力都较低，所以一般情况下单片机通过串口与PC机串口相连，把采集到的数据传送到PC机上，再在PC机上进行数据处理。由于单片机的输入输出是TTL电平，而PC机配置的都是RS-232标准串行接口，为9针“D”型连接器（插座），如图7-22所示。表7-3为RS-232C的“D”型9针插头的引脚定义。 </p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223214751696.png" class="" title="image-20231223214751696">

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223214758325.png" class="" title="单片机与PC机的串行通信接口">

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223214849364.png" class="" title="image-20231223214849364">

<p>   由于两者的电平不匹配，因此必须把单片机输出的TTL电平转换为RS-232电平。单片机与PC机的接口方案如图7-23。图中所用的电平转换芯片为MAX232，接口连接只用3条线，即RS-232插座中的2脚、3脚与5脚。</p>
<h4 id="一、单片机向计算机发送数据"><a href="#一、单片机向计算机发送数据" class="headerlink" title="一、单片机向计算机发送数据"></a>一、单片机向计算机发送数据</h4><p>   【例7-8】单片机向计算机发送数据的接口电路如图7-23。要求单片机通过串行口的TXD脚向计算机串行发送8个数据字节。实际上单片机向计算机与单片机向单片机发送数据的方法是完全一样的。单片机向计算机发送数据的参考程序如下。 </p>
<pre class="language-C" data-language="C"><code class="language-C">#include &lt;reg51.h&gt;
code Tab[] &#x3D; &#123;0xfe, 0xfd, 0xfb, 0xf7, 0xef, 0xdf, 0xbf, 0x7f&#125;
&#x2F;*欲发送的流水灯控制码数组，定义为全局变量*&#x2F;
void
send(unsigned char dat)
&#123;
    SBUF &#x3D; dat; &#x2F;*待发送数据写入发送缓冲寄存器*&#x2F;
    while (TI &#x3D;&#x3D; 0)
        ;   &#x2F;*串口未发送完，等待*&#x2F;
    ;       &#x2F;*空操作*&#x2F;
    TI &#x3D; 0; &#x2F;*一个字节发送完毕，软件将TI标志清0*&#x2F;
&#125;
&#x2F;*主函数*&#x2F;
void main(void)
&#123;
    unsigned char i;
    TMOD &#x3D; 0x20；                 &#x2F;*设置T1为定时器方式2*&#x2F;
        SCON &#x3D; 0x40；             &#x2F;*串行口方式1，TB8&#x3D;1*&#x2F;
        PCON &#x3D; 0x00； TH1 &#x3D; 0xfd; &#x2F;*波特率9600*&#x2F;
    TL1 &#x3D; 0xfd； TR1 &#x3D; 1；        &#x2F;*启动T1*&#x2F;
        while (1)                 &#x2F;*循环*&#x2F;
    &#123;
        for (i &#x3D; 0; i &lt; 8; i++) &#x2F;*发送8次流水灯控制码*&#x2F;
        &#123;
            send(Tab[i]); &#x2F;*发送数据*&#x2F;
            delay()；     &#x2F;*每隔200ms发送一次数据*&#x2F;
        &#125;
    &#125;
&#125;
void delay(void) &#x2F;*延时函数，延时约200ms*&#x2F;
&#123;
    unsigned char m, n;
    for (m &#x3D; 0; m &lt; 250; m++)
        for (n &#x3D; 0; n &lt; 250; n++)
            ;
&#125;
</code></pre>

<p>二、单片机接收计算机发送的数据</p>
<p>  【例7-9】单片机接收计算机发送的串行数据，并把接收到的数据送P1口的8位LED显示。参考程序如下。 </p>
<pre class="language-C" data-language="C"><code class="language-C">#include &lt;reg51.h&gt;
unsigned char receive(void)
&#123;
    unsigned char dat;
    while (RI &#x3D;&#x3D; 0)
        ;       &#x2F;*接收数据中断标志RI未被置1，等待，直至接收完毕*&#x2F;
    ;           &#x2F;*空操作*&#x2F;
    RI &#x3D; 0;     &#x2F;*将接收中断标志RI清0，为接收下一帧数据做准备*&#x2F;
    dat &#x3D; SBUF; &#x2F;*将接收缓冲器中的数据存入dat *&#x2F;
    return dat; &#x2F;*将接收到的数据返回*&#x2F;
&#125;
&#x2F;*主函数*&#x2F;
void main(void)
&#123;
    TMOD &#x3D; 0x20；     &#x2F;*设置T1为定时器模式，方式2*&#x2F;
        SCON &#x3D; 0x50； &#x2F;*设置串行口方式1接收*&#x2F;
        PCON &#x3D; 0x00； &#x2F;*波特率9600*&#x2F;
        TH1 &#x3D; 0xfd;
    TL1 &#x3D; 0xfd； TR1 &#x3D; 1； &#x2F;*启动T1*&#x2F;
        REN &#x3D; 1；          &#x2F;*允许接收*&#x2F;
        while (1)          &#x2F;*循环*&#x2F;
    &#123;
        P1 &#x3D; receive(); &#x2F;*将接收到的数据送P1口显示*&#x2F;
    &#125;
&#125;
</code></pre>

<h3 id="7-5-6-PC机与单片机与多个单片机的串行通信接口设计"><a href="#7-5-6-PC机与单片机与多个单片机的串行通信接口设计" class="headerlink" title="7.5.6  PC机与单片机与多个单片机的串行通信接口设计"></a>7.5.6  PC机与单片机与多个单片机的串行通信接口设计</h3><p>   一台PC机和多片AT89S51可构成小型分布式测控系统，如图7-24。是单片机应用的一个热点。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223215042818.png" class="" title="image-20231223215042818">

<p>​	</p>
<p>  分布式测控系统在工业控制和数据采集系统中，充分发挥单片机功能强、抗干扰性好、面向控制等优点，同时又可利用PC机弥补单片机在数据处理和交互性等方面不足。</p>
<p>在应用系统中，一般以PC机为主机，定时扫描以AT89S51为核心的前沿单片机，以便采集数据或发送控制信息。这样系统中，以AT89S51为核心的智能式测量和控制仪表(从机)既能独立地完成数据处理和控制任务，又可将数据传送给PC机。</p>
<p>PC机将这些数据进行处理，或显示，或打印，同时将控制命令传送给各子机，以实现集中管理和最优控制。</p>
<p>显然，要组成一个这样的分布式测控系统系统，首先要解决的是PC机与单片机间的串行通信接口问题。</p>
<p>   下面以RS-485串行多机通信为例，说明PC机与数台单片机进行多机通信的接口设计方案。PC机配有RS-232C串行标准接口，可通过转换电路转换成RS-485串行接口，AT89S51本身有一个全双工的串行口，该串行口加上驱动电路后就可实现RS-485串行通信。PC机与数台AT89S51进行多机通信的RS-485串行通信接口如图7-25所示 。</p>
<p>在图7-25中，AT89S517的串口通过75176芯片驱动后就可转换成RS-485标准接口，根据RS-485标准接口的电气特性，从机数量不多于32个。PC机与AT89S51之间的通信采用主从方式，PC机为主机，AT89S51单片机为从机，由PC机来确定与哪个单片机进行通信。</p>
<p>  有关PC机与多个单片机的串行通信的软件编程，可供读者使用的参考资料较多，读者可查阅相关的参考文献。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/image-20231223215134211.png" class="" title="image-20231223215134211"></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/tx.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/tx.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">ryz</div><div class="post-copyright__author_desc">生活就是白云苍狗</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://ybjryz.github.io/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://ybjryz.github.io/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/')">第七章</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://ybjryz.github.io/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=第七章&amp;url=http://ybjryz.github.io/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://ybjryz.github.io" target="_blank">ryz</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>学校课程<span class="tagsPageCount">7</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/img/tx.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">第六章</div></div></a></div><div class="next-post pull-right"><a href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%8D%81%E7%AB%A0/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">第十章</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/" title="第五章"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-16</div><div class="title">第五章</div></div></a></div><div><a href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/" title="第六章"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-23</div><div class="title">第六章</div></div></a></div><div><a href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0/" title="第十一章"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-23</div><div class="title">第十一章</div></div></a></div><div><a href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%8D%81%E7%AB%A0/" title="第十章"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-23</div><div class="title">第十章</div></div></a></div><div><a href="/2023/12/10/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%8C%E7%AB%A0/" title="第二章"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-10</div><div class="title">第二章</div></div></a></div><div><a href="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%9B%9B%E7%AB%A0/" title="第四章"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-16</div><div class="title">第四章</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/tx.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2021/01/15/752a5d910377a.png" ait="status"/></div></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0"><span class="toc-number">1.</span> <span class="toc-text">第七章</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-0-%E5%A4%A7%E7%BA%B2"><span class="toc-number">1.1.</span> <span class="toc-text">7.0 大纲</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E4%B8%B2%E8%A1%8C%E5%8F%A3%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">7.1 串行口的结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-1-%E4%B8%B2%E8%A1%8C%E5%8F%A3%E6%8E%A7%E5%88%B6%E5%AF%84%E5%AD%98%E5%99%A8SCON"><span class="toc-number">1.2.1.</span> <span class="toc-text">7.1.1 串行口控制寄存器SCON</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89SM0%E3%80%81SM1%E2%80%94%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F%E9%80%89%E6%8B%A9%E4%BD%8D"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">（1）SM0、SM1—工作方式选择位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89SM2%E2%80%94%E5%A4%9A%E6%9C%BA%E9%80%9A%E4%BF%A1%E6%8E%A7%E5%88%B6%E4%BD%8D"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">（2）SM2—多机通信控制位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89REN%E2%80%94%E5%85%81%E8%AE%B8%E4%B8%B2%E8%A1%8C%E6%8E%A5%E6%94%B6%E4%BD%8D%E3%80%82"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">（3）REN—允许串行接收位。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%884%EF%BC%89TB8%E2%80%94%E5%8F%91%E9%80%81%E7%9A%84%E7%AC%AC9%E4%BD%8D%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">（4）TB8—发送的第9位数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%885%EF%BC%89RB8%E2%80%94%E6%8E%A5%E6%94%B6%E7%9A%84%E7%AC%AC9%E4%BD%8D%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.1.5.</span> <span class="toc-text">（5）RB8—接收的第9位数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%886%EF%BC%89TI%E2%80%94%E5%8F%91%E9%80%81%E4%B8%AD%E6%96%AD%E6%A0%87%E5%BF%97%E4%BD%8D"><span class="toc-number">1.2.1.6.</span> <span class="toc-text">（6）TI—发送中断标志位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%887%EF%BC%89RI%E2%80%94%E6%8E%A5%E6%94%B6%E4%B8%AD%E6%96%AD%E6%A0%87%E5%BF%97%E4%BD%8D"><span class="toc-number">1.2.1.7.</span> <span class="toc-text">（7）RI—接收中断标志位</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-2-%E7%89%B9%E6%AE%8A%E5%8A%9F%E8%83%BD%E5%AF%84%E5%AD%98%E5%99%A8PCON"><span class="toc-number">1.2.2.</span> <span class="toc-text">7.1.2 特殊功能寄存器PCON</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E4%B8%B2%E8%A1%8C%E5%8F%A3%E7%9A%844%E7%A7%8D%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">7.2 串行口的4种工作方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-1-%E6%96%B9%E5%BC%8F0"><span class="toc-number">1.3.1.</span> <span class="toc-text">7.2.1 方式0</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%8E%E6%96%B9%E5%BC%8F0%E8%BE%93%E5%87%BA"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">1．方式0输出</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%8E%E6%96%B9%E5%BC%8F0%E8%BE%93%E5%85%A5"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">2．方式0输入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-2-%E6%96%B9%E5%BC%8F1"><span class="toc-number">1.3.2.</span> <span class="toc-text">7.2.2  方式1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%8E%E6%96%B9%E5%BC%8F1%E5%8F%91%E9%80%81"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">1．方式1发送</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%8E%E6%96%B9%E5%BC%8F1%E6%8E%A5%E6%94%B6"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">2．方式1接收</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-3-%E6%96%B9%E5%BC%8F2"><span class="toc-number">1.3.3.</span> <span class="toc-text">7.2.3  方式2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%8E%E6%96%B9%E5%BC%8F2%E5%8F%91%E9%80%81"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">1．方式2发送</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%8E%E6%96%B9%E5%BC%8F2%E6%8E%A5%E6%94%B6"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">2．方式2接收</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-4-%E6%96%B9%E5%BC%8F3"><span class="toc-number">1.3.4.</span> <span class="toc-text">7.2.4  方式3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-%E5%A4%9A%E6%9C%BA%E9%80%9A%E4%BF%A1"><span class="toc-number">1.4.</span> <span class="toc-text">7.3  多机通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E6%9C%BA%E9%80%9A%E4%BF%A1%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.0.1.</span> <span class="toc-text">多机通信的工作原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E6%9C%BA%E9%80%9A%E4%BF%A1%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B"><span class="toc-number">1.4.0.2.</span> <span class="toc-text">多机通信的工作过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-%E6%B3%A2%E7%89%B9%E7%8E%87%E7%9A%84%E5%88%B6%E5%AE%9A"><span class="toc-number">1.5.</span> <span class="toc-text">7.4  波特率的制定</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-1-%E6%B3%A2%E7%89%B9%E7%8E%87%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">1.5.1.</span> <span class="toc-text">7.4.1  波特率的定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-%E4%B8%B2%E8%A1%8C%E9%80%9A%E4%BF%A1%E7%9A%84%E5%BA%94%E7%94%A8%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.6.</span> <span class="toc-text">7.5  串行通信的应用设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-1-%E5%90%84%E7%A7%8D%E4%B8%B2%E8%A1%8C%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3%E6%A0%87%E5%87%86"><span class="toc-number">1.6.1.</span> <span class="toc-text">7.5.1  各种串行通信接口标准</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%8ETTL%E7%94%B5%E5%B9%B3%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">1．TTL电平通信接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%8ERS-232C%E5%8F%8C%E6%9C%BA%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">2．RS-232C双机通信接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%8ERS-422A%E5%8F%8C%E6%9C%BA%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">3．RS-422A双机通信接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%8ERS-485%E5%8F%8C%E6%9C%BA%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.6.1.4.</span> <span class="toc-text">4．RS-485双机通信接口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-2-%E6%96%B9%E5%BC%8F1%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.6.2.</span> <span class="toc-text">7.5.2  方式1的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-3-%E6%96%B9%E5%BC%8F2%E5%92%8C%E6%96%B9%E5%BC%8F3%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.6.3.</span> <span class="toc-text">7.5.3  方式2和方式3的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-4-%E4%B8%BB%E4%BB%8E%E5%BC%8F%E5%A4%9A%E6%9C%BA%E9%80%9A%E4%BF%A1%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.6.4.</span> <span class="toc-text">7.5.4  主从式多机通信的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-5-%E5%8D%95%E7%89%87%E6%9C%BA%E4%B8%8EPC%E6%9C%BA%E7%9A%84%E4%B8%B2%E8%A1%8C%E9%80%9A%E4%BF%A1"><span class="toc-number">1.6.5.</span> <span class="toc-text">7.5.5  单片机与PC机的串行通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%8D%95%E7%89%87%E6%9C%BA%E5%90%91%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">一、单片机向计算机发送数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-6-PC%E6%9C%BA%E4%B8%8E%E5%8D%95%E7%89%87%E6%9C%BA%E4%B8%8E%E5%A4%9A%E4%B8%AA%E5%8D%95%E7%89%87%E6%9C%BA%E7%9A%84%E4%B8%B2%E8%A1%8C%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.6.6.</span> <span class="toc-text">7.5.6  PC机与单片机与多个单片机的串行通信接口设计</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0/" title="第十一章">第十一章</a><time datetime="2023-12-23T14:53:00.000Z" title="发表于 2023-12-23 22:53:00">2023-12-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%8D%81%E7%AB%A0/" title="第十章">第十章</a><time datetime="2023-12-23T13:53:00.000Z" title="发表于 2023-12-23 21:53:00">2023-12-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/" title="第七章">第七章</a><time datetime="2023-12-23T13:10:00.000Z" title="发表于 2023-12-23 21:10:00">2023-12-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/" title="第六章">第六章</a><time datetime="2023-12-23T09:33:00.000Z" title="发表于 2023-12-23 17:33:00">2023-12-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/17/ICT/%E5%85%B6%E4%BB%96%E6%A8%A1%E6%8B%9F%E5%99%A8/" title="其他模拟器">其他模拟器</a><time datetime="2023-12-17T01:00:00.000Z" title="发表于 2023-12-17 09:00:00">2023-12-17</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2023 By <a class="footer-bar-link" href="/" title="ryz" target="_blank">ryz</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">57</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/ICT/" style="font-size: 0.88rem;">ICT<sup>13</sup></a><a href="/tags/WEB-Trojans/" style="font-size: 0.88rem;">WEB-Trojans<sup>1</sup></a><a href="/tags/code/" style="font-size: 0.88rem;">code<sup>1</sup></a><a href="/tags/ctf/" style="font-size: 0.88rem;">ctf<sup>1</sup></a><a href="/tags/tools/" style="font-size: 0.88rem;">tools<sup>1</sup></a><a href="/tags/typora/" style="font-size: 0.88rem;">typora<sup>1</sup></a><a href="/tags/web-tools/" style="font-size: 0.88rem;">web-tools<sup>1</sup></a><a href="/tags/web%E5%90%8E%E7%AB%AF%E6%BC%8F%E6%B4%9E/" style="font-size: 0.88rem;">web后端漏洞<sup>1</sup></a><a href="/tags/web%E6%BC%8F%E6%B4%9E/" style="font-size: 0.88rem;">web漏洞<sup>1</sup></a><a href="/tags/web%E6%BC%8F%E6%B4%9E%E5%AE%9E%E9%AA%8C/" style="font-size: 0.88rem;">web漏洞实验<sup>14</sup></a><a href="/tags/%E4%BB%A3%E5%8A%9E/" style="font-size: 0.88rem;">代办<sup>1</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2%E4%BC%98%E5%8C%96/" style="font-size: 0.88rem;">博客优化<sup>1</sup></a><a href="/tags/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/" style="font-size: 0.88rem;">学校课程<sup>7</sup></a><a href="/tags/%E5%AE%89%E5%85%A8-%E6%9D%82%E9%A1%B9/" style="font-size: 0.88rem;">安全--杂项<sup>1</sup></a><a href="/tags/%E5%B0%8F%E6%8A%80%E5%B7%A7/" style="font-size: 0.88rem;">小技巧<sup>1</sup></a><a href="/tags/%E6%9D%82%E9%A1%B9/" style="font-size: 0.88rem;">杂项<sup>1</sup></a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 0.88rem;">渗透测试<sup>1</sup></a><a href="/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" style="font-size: 0.88rem;">环境搭建<sup>1</sup></a><a href="/tags/%E9%97%AE%E9%A2%98/" style="font-size: 0.88rem;">问题<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8779107562" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/playlist?id=8779107562&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("05/14/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.8",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 ryz 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>