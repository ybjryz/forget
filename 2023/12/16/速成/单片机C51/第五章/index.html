<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>第五章 | ryz</title><meta name="keywords" content="学校课程"><meta name="author" content="ryz"><meta name="copyright" content="ryz"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="第五章"><meta name="application-name" content="第五章"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="第五章"><meta property="og:url" content="http://ybjryz.github.io/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/index.html"><meta property="og:site_name" content="ryz"><meta property="og:description" content="中断系统0.大纲第五章  AT89S51单片机的中断系统（了解AT89S51单片机内中断系统的硬件结构与工作原理，重点掌握与中断有关的特殊功能寄存器以及中断系统的应用特性，中断源与中断入口地址、中断优先级怎么确定、中断嵌套用法，非常熟练的进行中断系统应用的编程，如流水灯、触发灯控制）   1.AT8"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://ybjryz.github.io/img/tx.png"><meta property="article:author" content="ryz"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://ybjryz.github.io/img/tx.png"><meta name="description" content="中断系统0.大纲第五章  AT89S51单片机的中断系统（了解AT89S51单片机内中断系统的硬件结构与工作原理，重点掌握与中断有关的特殊功能寄存器以及中断系统的应用特性，中断源与中断入口地址、中断优先级怎么确定、中断嵌套用法，非常熟练的进行中断系统应用的编程，如流水灯、触发灯控制）   1.AT8"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://ybjryz.github.io/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":4000,"accessToken":"","mailMd5":""},
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: ryz","link":"链接: ","source":"来源: ryz","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'ryz',
  title: '第五章',
  postAI: '',
  pageFillDescription: '中断系统, 0.大纲, 1.AT89S51中断技术概述, 5.2 AT89S51中断系统结构, 5.2.2 中断请求标志寄存器, 1.TCON寄存器–定时器x2F计数器, 2.SCON寄存器–串行口, 5.3 中断允许与中断优先级的控制, 5.3.1 中断允许寄存器IE, 5.3.2 中断优先级寄存器IP, 5.4 响应中断请求的条件, 5.5 外部中断的响应时间, 5.6 外部中断的触发方式选择, 5.6.1 电平触发方式, 5.6.2 跳沿触发方式, 5.7 中断请求的撤销, 1．定时器x2F计数器中断请求的撤销, 2．外部中断请求的撤销, 3．串行口中断请求的撤销, 5.8 中断函数, 5.9 C51编程举例, 5.9.1 单一外中断的应用, 5.9.2 两个外中断的应用, 5.9.3 中断嵌套, 5.9.4 多外部中断源系统设计中断系统大纲第五章单片机的中断系统了解单片机内中断系统的硬件结构与工作原理重点掌握与中断有关的特殊功能寄存器以及中断系统的应用特性中断源与中断入口地址中断优先级怎么确定中断嵌套用法非常熟练的进行中断系统应用的编程如流水灯触发灯控制中断技术概述在单片机系统中中断技术主要用于实时监测与控制也就是要求单片机能及时地响应中断请求源提出的服务请求并作出快速响应并及时处理这些工作就是由单片机片内的中断系统来实现的当中断请求源发出中断请求时如果中断请求被允许的话单片机暂时中止当前正在执行的主程序转到中断服务处理程序处理中断服务请求中断服务处理程序处理完中断服务请求后再回到原来被中止的程序之处断点继续执行被中断的主程序图显示了单片机对外围设备中断服务请求的整个中断响应和处理过程如果单片机没有中断系统单片机的大量时间可能会浪费在查询是否有服务请求发生的定时查询操作上即不论是否有服务请求发生都必须去查询采用中断技术完全消除了单片机在查询方式中的等待现象大大地提高了单片机的工作效率和实时性由于中断工作方式的优点极为明显因此单片机的片内硬件中都带有中断系统中断系统结构中断系统结构如图所示共有个中断请求源简称中断源个中断优先级可实现级中断服务程序嵌套每一中断源可用软件独立地控制为允许中断或关中断状态每一中断源的中断优先级别均可用软件来设置由图可见中断系统共有个中断请求源它们是外部中断请求中断请求信号由引脚输入中断请求标志为外部中断请求中断请求信号由引脚输入中断请求标志为定时器计数器计数溢出发出的中断请求中断请求标志为定时器计数器计数溢出发出的中断请求中断请求标志为串行口中断请求中断请求标志为发送中断或接收中断中断请求标志寄存器个中断请求源的中断请求标志分别由特殊功能寄存器和的相应位锁存见图寄存器定时器计数器为定时器计数器的控制寄存器字节地址为可位寻址该寄存器中既包括和的溢出中断请求标志位和也包括了两个外部中断请求的标志位与此外还包括了两个外部中断请求源的中断触发方式选择位特殊功能寄存器的格式如图所示寄存器中与中断系统有关的各标志位的功能如下片内定时器计数器的溢出中断请求标志位当启动计数后定时器计数器从初值开始加计数当最高位产生溢出时由硬件使置向申请中断响应中断时标志由硬件自动清也可由软件清片内定时器计数器的溢出中断请求标志位功能与类似外部中断请求的中断请求标志位外部中断请求的中断请求标志位其功能与类似选择外部中断请求为跳沿触发方式还是电平触发方式为电平触发方式加到引脚上的外部中断请求输入信号为低电平有效并把置转向中断服务程序时则由硬件自动把清为跳沿触发方式加到引脚上的外部中断请求输入信号电平从高到低的负跳变有效并把置转向中断服务程序时则由硬件自动把清选择外部中断请求为跳沿触发方式还是电平触发方式其意义与类似当复位后被清个中断源的中断请求标志均为位位这位与中断系统无关仅与定时器计数器和有关将在第章介绍寄存器串行口为串行口控制寄存器字节地址为可位寻址的低二位锁存串行口的发送中断和接收中断的中断请求标志和其格式如图所示中各标志位的功能如下串行口的发送中断请求标志位将一个字节的数据写入串行口的发送缓冲器时就启动一帧串行数据的发送每发送完一帧串行数据后硬件使自动置响应串行口发送中断时并不清除中断请求标志标志必须在中断服务程序中用指令对其清串行口接收中断请求标志位在串行口接收完一个串行数据帧硬件自动使中断请求标志置在响应串行口接收中断时标志并不清必须在中断服务程序中用指令对清中断允许与中断优先级的控制实现中断允许控制和中断优先级控制分别由特殊功能寄存器区中的中断允许寄存器和中断优先级寄存器来实现的下面介绍这两个特殊功能寄存器中断允许寄存器的对各中断源的开放或屏蔽是由片内的中断允许寄存器控制的的字节地址为可进行位寻址其格式如图所示中断允许总开关控制位所有的中断请求被屏蔽所有的中断请求被开放串行口中断允许位禁止串行口中断允许串行口中断定时器计数器的溢出中断允许位禁止溢出中断允许溢出中断外部中断中断允许位禁止外部中断中断允许外部中断中断定时器计数器的溢出中断允许位禁止溢出中断允许溢出中断外部中断中断允许位禁止外部中断中断允许外部中断中断复位以后被清所有的中断请求被禁止中与各个中断源相应的位可用指令置或清即可允许或禁止各中断源的中断申请若使某一个中断源被允许中断除了相应的位被置外还必须使位置中断优先级寄存器中断请求源有两个中断优先级每一中断请求源可由软件设置为高优先级中断或低优先级中断也可实现两级中断嵌套所谓两级中断嵌套就是正在执行低优先级中断的服务程序时可被高优先级中断请求所中断待高优先级中断处理完毕后再返回低优先级中断服务程序两级中断嵌套的过程如图所示关于各中断源的中断优先级关系可归纳为下面两条基本规则低优先级可被高优先级中断高优先级不能低优先级中断任何一种中断不管是高级还是低级一旦得到响应不会再被它的同级中断源所中断如果某一中断源被设置为高优先级中断在执行该中断源的中断服务程序时则不能被任何其他的中断源的中断请求所中断的片内有一个中断优先级寄存器其字节地址为可位寻址只要用程序改变其内容即可进行各中断源中断优先级的设置寄存器的格式如图所示中断优先级寄存器各位的含义如下串行口中断优先级控制位串行口中断为高优先级串行口中断为低优先级定时器中断优先级控制位定时器中断为高优先级定时器中断为低优先级外部中断中断优先级控制位外部中断中断为高优先级外部中断中断为低优先级定时器中断优先级控制位定时器中断为高优先级定时器中断为低优先级外部中断中断优先级控制位外部中断中断为高优先级外部中断中断为低优先级中断优先级控制寄存器的各位都可由用户程序置和清用位操作指令或字节操作指令可更新的内容以改变各中断源的中断优先级复位以后的内容为各个中断源均为低优先级中断下面简单介绍的中断优先级结构的中断系统有两个不可寻址的优先级激活触发器其中一个指示某高优先级的中断正在执行所有后来的中断均被阻止另一个触发器指示某低优先级的中断正在执行所有同级的中断都被阻止但不阻断高优先级的中断请求在同时收到几个同一优先级的中断请求时哪一个中断请求能优先得到响应取决于内部的查询顺序这相当于在同一个优先级内还同时存在另一个辅助优先级结构其查询顺序如表所示由此可见各中断源在同一个优先级的条件下外部中断的中断优先权最高串行口中断的优先权最低响应中断请求的条件一个中断源的中断请求被响应必须满足以下必要条件总中断允许开关接通即寄存器中的中断总允许位该中断源发出中断请求即该中断源对应的中断请求标志为该中断源的中断允许位即该中断被允许无同级或更高级中断正在被服务中断响应就是对中断源提出的中断请求的接受当查询到有效中断请求时在满足上述条件时紧接着就进行中断响应中断响应的主要过程首先由硬件自动生成一条长调用指令这里的就是程序存储区中相应的中断入口地址例如对于外部中断的响应硬件自动生成的长调用指令为生成指令后紧接着就由执行该指令首先将程序计数器的内容压入堆栈以保护断点再将中断入口地址装入使程序转向响应中断请求的中断入口地址各中断源服务程序的入口地址是固定的如表所示其中两个中断入口间只相隔字节一般情况下难以安放一个完整的中断服务程序因此通常总是在中断入口地址处放置一条无条件转移指令使程序执行转向在其他地址存放的中断服务程序入口中断响应是有条件的并不是查询到的所有中断请求都能被立即响应当遇到下列三种情况之一时中断响应被封锁正在处理同级或更高优先级的中断因为当一个中断被响应时要把对应的中断优先级状态触发器置该触发器指出所处理的中断优先级别从而封锁了低级中断请求和同级中断请求所查询的机器周期不是当前正在执行指令的最后一个机器周期设定这个限制的目的是只有在当前指令执行完毕后才能进行中断响应以确保当前指令执行的完整性正在执行的指令是或是访问或的指令因为按照中断系统的规定在执行完这些指令后需要再执行完一条指令才能响应新的中断请求如果存在上述三种情况之一将丢弃中断查询结果不能对中断进行响应外部中断的响应时间在设计者使用外部中断时有时需考虑从外部中断请求有效外部中断请求标志置到转向中断入口地址所需要的响应时间下面来讨论这个问题外部中断的最短响应时间为个机器周期其中中断请求标志位查询占个机器周期而这个机器周期恰好处于指令的最后一个机器周期在这个机器周期结束后中断即被响应接着执行一条硬件子程序调用指令以转到相应的中断服务程序入口这需要个机器周期外部中断响应的最长时间为个机器周期这种情况发生在进行中断标志查询时刚好才开始执行或访问或的指令则需把当前指令执行完再继续执行一条指令后才能响应中断执行上述的或访问或的指令最长需要个机器周期而接着再执行一条指令我们按最长的指令乘法指令和除法指令来算也只有个机器周期再加上硬件子程序调用指令的执行需要个机器周期所以外部中断响应的最长时间为个机器周期如果已经在处理同级或更高级中断外部中断请求的响应时间取决于正在执行的中断服务程序的处理时间这种情况下响应时间就无法计算了这样在一个单一中断的系统里单片机对外部中断请求的响应时间总是在个机器周期之间外部中断的触发方式选择外部中断有两种触发方式电平触发方式和跳沿触发方式电平触发方式若外部中断定义为电平触发方式外部中断申请触发器的状态随着在每个机器周期采样到的外部中断输入引脚的电平变化而变化这能提高对外部中断请求的响应速度当外部中断源被设定为电平触发方式时在中断服务程序返回之前外部中断请求输入必须无效即外部中断请求输入已由低电平变为高电平否则返回主程序后会再次响应中断所以电平触发方式适合于外部中断以低电平输入且中断服务程序能清除外部中断请求源即外部中断输入电平又变为高电平的情况如何清除电平触发方式的外部中断请求源的电平信号将在本章的后面介绍跳沿触发方式外部中断若定义为跳沿触发方式外部中断申请触发器能锁存外部中断输入线上的负跳变即便是暂时不能响应中断请求标志也不会丢失在这种方式下如果相继连续两次采样一个机器周期采样到外部中断输入为高下一个机器周期采样为低则中断申请触发器置直到响应此中断时该标志才清这样就不会丢失中断但输入的负脉冲宽度至少保持个时钟周期若晶振频率为则为才能被采样到外部中断的跳沿触发方式适合于以负脉冲形式输入的外部中断请求中断请求的撤销某个中断请求被响应后就存在着一个中断请求的撤销问题下面按中断请求源的类型分别说明中断请求的撤销定时器计数器中断请求的撤销定时器计数器中断的中断请求被响应后硬件会自动把中断请求标志位或清因此定时器计数器中断请求是自动撤销的外部中断请求的撤销跳沿方式外部中断请求的撤销跳沿方式的外部中断请求的撤销包括两项内容中断标志位清和外中断信号的撤销其中中断标志位或清是在中断响应后由硬件自动完成的而外中断请求信号的撤销由于跳沿信号过后也就消失了所以跳沿方式的外部中断请求也是自动撤销的电平方式外部中断请求的撤销对于电平方式外部中断请求的撤销中断请求标志的撤销是自动的但中断请求信号的低电平可能继续存在在以后的机器周期采样时又会把已清的或标志位重新置为此要彻底解决电平方式外部中断请求的撤销除了标志位清之外必要时还需在中断响应后把中断请求信号输入引脚从低电平强制改变为高电平为此可在系统中增加如图所示的电路由图可见用触发器锁存外来的中断请求低电平并通过触发器的输出端接到或所以增加的触发器不影响中断请求中断响应后为了撤销中断请求可利用触发器的直接置端实现即把端接的端因此只要端输出一个负脉冲就可以使触发器置从而就撤销低电平的中断请求信号所需的负脉冲可在中断服务程序中先把置再让为再把置从而产生一个负脉冲串行口中断请求的撤销串行口中断请求的撤销只有标志位清的问题串行口中断的标志位是和但对这两个中断标志不进行自动清因为在响应串行口的中断后无法知道是接收中断还是发送中断还需测试这两个中断标志位的状态以判定是接收操作还是发送操作然后才能清除所以串行口中断请求的撤销只能使用软件的方法在中断服务程序中进行即使用软件在中断服务程序中把串行口中断标志位清中断函数为直接使用编写中断服务程序中定义了中断函数由于编译器在编译时对声明为中断服务程序的函数自动添加了相应的现场保护阻断其他中断返回时自动恢复现场等处理的程序段因而在编写中断函数时可不必考虑这些问题减小了用户编写中断服务程序的繁琐程度第章中介绍的中断服务函数的一般形式为函数类型函数名形式参数表关键字后面的是中断号对于单片机的取值为编译器从处产生中断向量单片机的中断源对应的中断号和中断向量见表单片机在内部中可使用个工作寄存器区每个工作寄存器区包含个工作寄存器扩展了一个关键字后面的专门用来选择的个不同的工作寄存器区是一个选项如果不选用该项中断函数中的所有工作寄存器的内容将被保存到堆栈中关键字对函数目标代码的影响如下在中断函数的入口处将当前工作寄存器区的内容保护到堆栈中函数返回前将被保护的寄存器区的内容从堆栈中恢复使用关键字在函数中确定一个工作寄存器区时须十分小心要保证任何工作寄存器区的切换都只在指定的控制区域中发生否则将产生不正确的函数结果例如外中断的中断服务函数如下中断号选择区工作寄存器区中断调用与标准的函数调用是不一样的当中断事件发生后对应的中断函数被自动调用中断函数既没有参数也没有返回值中断函数会带来如下影响编译器会为中断函数自动生成中断向量退出中断函数时所有保存在堆栈中的工作寄存器及特殊功能寄存器被恢复在必要时特殊功能寄存器以及的内容被保存到堆栈中编写单片机中断程序时应遵循以下规则中断函数没有返回值如果定义了一个返回值将会得到不正确的结果因此建议将中断函数定义为类型以明确说明没有返回值中断函数不能进行参数传递如果中断函数中包含任何参数声明都将导致编译出错在任何情况下都不能直接调用中断函数否则会产生编译错误因为中断函数的返回是由汇编语言指令完成的指令会影响单片机中的硬件中断系统内的不可寻址的中断优先级寄存器的状态如果在没有实际的中断请求的情况下直接调用中断函数也就不会执行指令其操作结果有可能产生一个致命的错误如果在中断函数中再调用其他函数则被调用的函数所使用的寄存器区必须与中断函数使用的寄存器区不同编程举例本节通过几个例程介绍有关中断应用的程序的编写单一外中断的应用例在单片机的口上接有只在外部中断输入引脚引脚接有一只按钮开关程序要求将外部中断设置为负跳沿触发在程序启动时口上的只亮按一次按钮开关使引脚接地产生一个负跳沿触发的外中断中断请求在中断服务程序中让低位的和高位的交替闪烁具体电路如图所示延时函数为形式参数不能赋初值晶振为的选择与晶振频率有关空函数主函数总中断允许允许外部中断中断选择外部中断为跳沿触发方式口的只全亮循环外中断的中断服务函数禁止外部中断中断低位灭高位亮延时高位灭低位亮延时中断返回前打开外部中断中断本例程包含了两个部分一是中断系统初始化部分另一是中断处理服务函数部分两个外中断的应用当多个中断源时只需增加相应的中断服务函数即可例是处理两个外中断请求的例子例如图所示在单片机的口上接有只在外部中断输入引脚引脚接有一只按钮开关在外部中断输入引脚引脚接有一只按钮开关程序要求和都未按下时口的只呈流水灯显示仅按下时左右只交替闪烁仅按下口的只全部闪亮两个外中断的优先级相同延时函数为形式参数不能赋初值空函数主函数定义了流水灯的显示数据延时将已经定义的流水灯显示数据送到口总中断允许允许外部中断中断允许外部中断中断选择外部中断为跳沿触发方式选择外部中断为跳沿触发方式两个外部中断均为低优先级外中断的中断服务函数低位灭高位亮延时高位灭低位亮延时外中断的中断服务函数全灭延时全亮延时中断嵌套中断嵌套只能发生在单片机正在执行一个低优先级中断服务程序的时候此时又有一个高优先级中断产生就会产生高优先级中断打断低优先级中断服务程序去执行高优先级中断服务程序高优先级中断服务程序完成后再继续执行低优先级中断服务程序例电路仍如图所示设计一个中断嵌套程序要求和都未按下时口的只呈流水灯显示当按下再松开时产生一个低优先级的外中断请求跳沿触发进入外中断中断服务程序左右只交替闪烁此时按下再松开时产生一个高优先级的外中断请求跳沿触发进入外中断中断服务程序口的只全部闪烁当显示一段时间后再从外中断返回继续执行外中断中断服务程序即口控制只左右只交替闪烁设置外中断为高优先级外中断为低优先级延时函数空函数主函数定义流水灯的显示数据延时将已经定义的流水灯显示数据送到口总中断允许允许外部中断中断允许外部中断中断选择外部中断为跳沿触发方式选择外部中断为跳沿触发方式外部中断为低优先级外部中断为高优先级外中断的中断服务函数低位灭高位亮延时高位灭低位亮延时外中断的中断服务函数位全亮延时位全灭延时多外部中断源系统设计为用户提供两个外部中断请求输入端和实际的应用系统中两个外部中断请求源往往不够用需对外部中断源进行扩充本节介绍一种利用外部中断和查询相结合的扩展外部中断源的方法如图所示若系统中有个外部中断请求源它们均为高电平请求有效这时可按中断请求的轻重缓急进行排队把其中最高级别的中断请求源直接接到的一个外部中断请求源输入端其余的个中断请求源按图通过各自的门集电极开路门连到的另一个外中断源输入端同时还连到口的脚供查询各外部中断请求源的中断请求由外设的电路产生图电路中除了的中断优先权级别最高外外部中断源的中断优先权取决于查询顺序这里假设查询顺序为因此中断优先权由高到低的顺序依次为例利用外部中断和查询相结合的方法扩展多个外部中断参考程序如下定义位变量主函数全灭总中断允许允许外部中断中断允许外部中断中断选择外部中断为电平触发方式选择外部中断为电平触发方式外部中断为高优先级外部中断为低优先级延时等待中断外中断的中断服务函数点亮高位外中断的中断服务函数如果为中断点亮如果为中断点亮如果为中断点亮如果为中断点亮注意当扩展的外部中断源个数较多时查询时间稍长',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-23 17:46:12',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/tx.png"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">ryz</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">音乐</div><span class="author-content-item-title">灵魂的碰撞💥</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>学校课程</span></a></span></div></div><h1 class="post-title" itemprop="name headline">第五章</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-12-16T09:07:00.000Z" title="发表于 2023-12-16 17:07:00">2023-12-16</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-12-23T09:46:12.417Z" title="更新于 2023-12-23 17:46:12">2023-12-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为重庆"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>重庆</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://ybjryz.github.io/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/"><header><a href="/tags/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/" tabindex="-1" itemprop="url">学校课程</a><h1 id="CrawlerTitle" itemprop="name headline">第五章</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">ryz</span><time itemprop="dateCreated datePublished" datetime="2023-12-16T09:07:00.000Z" title="发表于 2023-12-16 17:07:00">2023-12-16</time><time itemprop="dateCreated datePublished" datetime="2023-12-23T09:46:12.417Z" title="更新于 2023-12-23 17:46:12">2023-12-23</time></header><h1 id="中断系统"><a href="#中断系统" class="headerlink" title="中断系统"></a>中断系统</h1><h2 id="0-大纲"><a href="#0-大纲" class="headerlink" title="0.大纲"></a>0.大纲</h2><p>第五章  AT89S51单片机的中断系统（了解AT89S51单片机内中断系统的硬件结构与工作原理，重点掌握与中断有关的特殊功能寄存器以及中断系统的应用特性，中断源与中断入口地址、中断优先级怎么确定、中断嵌套用法，非常熟练的进行中断系统应用的编程，如流水灯、触发灯控制）</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/image-20231223160037240.png" class="" title="image-20231223160037240">

<h2 id="1-AT89S51中断技术概述"><a href="#1-AT89S51中断技术概述" class="headerlink" title="1.AT89S51中断技术概述"></a>1.AT89S51中断技术概述</h2><p>在单片机系统中，中断技术主要用于实时监测与控制，也就是要求单片机能及时地响应中断请求源提出的服务请求，并作出快速响应并及时处理。这些工作就是由单片机片内的中断系统来实现的。当中断请求源发出中断请求时，如果中断请求被允许的话，单片机<strong>暂时中止</strong>当前正在执行的主程序，转到中断服务处理程序处理中断服务请求。中断服务处理程序处理完中断服务请求后，再回到原来被中止的程序之处（断点），继续执行被中断的主程序。</p>
<p>图5-1显示了单片机对外围设备中断服务请求的整个中断响应和处理过程。    </p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/image-20231223160205150.png" class="" title="image-20231223160205150">

<p>如果单片机没有中断系统，单片机的大量时间可能会浪费在查询是否有服务请求发生的定时查询操作上，即不论是否有服务请求发生，都必须去查询。采用中断技术完全消除了单片机<strong>在查询方式中的等待现象</strong>，大大地提高了单片机的工作效率和实时性。由于中断工作方式的优点极为明显，因此，单片机的片内硬件中都带有中断系统。</p>
<h2 id="5-2-AT89S51中断系统结构"><a href="#5-2-AT89S51中断系统结构" class="headerlink" title="5.2 AT89S51中断系统结构"></a>5.2 AT89S51中断系统结构</h2><p>中断系统结构如图5-2所示。共有5个中断请求源（简称中断源），2个中断优先级，可实现2级中断服务程序嵌套。每一中断源可用软件独立地控制为允许中断或关中断状态；每一中断源的中断优先级别均可用软件来设置。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/image-20231223160340689.png" class="" title="图5-2">

<p>由图5-2可见，中断系统共有5个中断请求源，它们是：</p>
<p>（1）INT0*—外部中断请求0，中断请求信号由引脚输入，中断请求标志为IE0。</p>
<p>（2） INT1*—外部中断请求1，中断请求信号由引脚输入，中断请求标志为IE1。</p>
<p>（3）定时器&#x2F;计数器T0计数溢出发出的中断请求，中断请求标志为TF0。</p>
<p>（4）定时器&#x2F;计数器T1计数溢出发出的中断请求，中断请求标志为TF1。</p>
<p>（5）串行口中断请求，中断请求标志为发送中断TI或接收中断RI。</p>
<h3 id="5-2-2-中断请求标志寄存器"><a href="#5-2-2-中断请求标志寄存器" class="headerlink" title="5.2.2 中断请求标志寄存器"></a>5.2.2 中断请求标志寄存器</h3><p>5个中断请求源的中断请求标志分别由特殊功能寄存器TCON和SCON的相应位锁存（见图5-2）。</p>
<h4 id="1-TCON寄存器–定时器-计数器"><a href="#1-TCON寄存器–定时器-计数器" class="headerlink" title="1.TCON寄存器–定时器&#x2F;计数器"></a>1.TCON寄存器–定时器&#x2F;计数器</h4><p>为定时器&#x2F;计数器的控制寄存器，字节地址为88H，可位寻址。该寄存器中既包括T0和T1的溢出中断请求标志位TF0和TF1，也包括了两个外部中断请求的标志位IE1与IE0，此外还包括了两个外部中断请求源的中断触发方式选择位。特殊功能寄存器TCON的格式如图5-3所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/image-20231223160634198.png" class="" title="image-20231223160634198">

<p>TCON寄存器中与中断系统有关的各标志位的功能如下：</p>
<p>（1）TF1—片内定时器&#x2F;计数器T1的溢出中断请求标志位。</p>
<p>当启动T1计数后，定时器&#x2F;计数器T1从初值开始加1计数，当最高位产生溢出时，由硬件使TF1置“1”，向CPU申请中断。CPU响应TF1中断时，TF1标志由硬件自动清“0”，TF1也可由软件清“0”。</p>
<p>（2）TF0—片内定时器&#x2F;计数器T0的溢出中断请求标志位，功能与TF1类似。</p>
<p>（3）IE1—外部中断请求1的中断请求标志位。</p>
<p>（4）IE0—外部中断请求0的中断请求标志位，其功能与IE1类似。</p>
<p>（5）IT1—选择外部中断请求1为跳沿触发方式还是电平触发方式。</p>
<p>IT1&#x3D;0，为电平触发方式，加到INT1*引脚上的外部中断请求输入信号为低电平有效，并把IE1置“1”。转向中断服务程序时，则由硬件自动把IE1清“0”。</p>
<p>IT1&#x3D;1，为跳沿触发方式，加到INT1*引脚上的外部中断请求输入信号电平从高到低的负跳变有效，并把IE1置“1”。转向中断服务程序时，则由硬件自动把IE1清“0”。</p>
<p>（6）IT0—选择外部中断请求0为跳沿触发方式还是电平触发方式，其意义与IT1类似。</p>
<p>当AT89S51复位后，TCON被清“0”，5个中断源的中断请求标志均为0。</p>
<p>TR1（D6位）、TR0（D4位）这2位与中断系统无关，仅与定时器&#x2F;计数器T1和T0有关，将在第6章介绍。</p>
<h4 id="2-SCON寄存器–串行口"><a href="#2-SCON寄存器–串行口" class="headerlink" title="2.SCON寄存器–串行口"></a>2.SCON寄存器–串行口</h4><p>SCON为串行口控制寄存器，字节地址为98H，可位寻址。SCON的低二位锁存串行口的发送中断和接收中断的中断请求标志TI和RI，其格式如图5-4所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/image-20231223160921649.png" class="" title="image-20231223160921649">

<p>SCON中各标志位的功能如下： </p>
<p>（1）TI—串行口的发送中断请求标志位。CPU将一个字节的数据写入串行口的发送缓冲器SBUF时，就启动一帧串行数据的发送，每发送完一帧串行数据后，硬件使TI自动置“1”。 </p>
<p>CPU响应串行口发送中断时，并不清除TI中断请求标志，TI标志必须在中断服务程序中用指令对其清“0”。</p>
<p>（2）RI—串行口接收中断请求标志位。在串行口接收完一个串行数据帧，硬件自动使RI中断请求标志置“1”。CPU在响应串行口接收中断时，RI标志并不清“0”，必须在中断服务程序中用指令对RI清“0”。 </p>
<h2 id="5-3-中断允许与中断优先级的控制"><a href="#5-3-中断允许与中断优先级的控制" class="headerlink" title="5.3 中断允许与中断优先级的控制"></a>5.3 中断允许与中断优先级的控制</h2><p>实现中断允许控制和中断优先级控制分别由特殊功能寄存器区中的中断允许寄存器IE和中断优先级寄存器IP来实现的。下面介绍这两个特殊功能寄存器。</p>
<h3 id="5-3-1-中断允许寄存器IE"><a href="#5-3-1-中断允许寄存器IE" class="headerlink" title="5.3.1 中断允许寄存器IE"></a>5.3.1 中断允许寄存器IE</h3><p>AT89S51的CPU对各中断源的开放或屏蔽，是由片内的中断允许寄存器IE控制的。IE的字节地址为A8H，可进行位寻址，其格式如图5-5所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/image-20231223161156854.png" class="" title="image-20231223161156854">

<p>（1）EA—中断允许总开关控制位。</p>
<p>EA&#x3D;0,所有的中断请求被屏蔽</p>
<p> EA&#x3D;1,所有的中断请求被开放</p>
<p>（2）ES—串行口中断允许位。</p>
<p>ES&#x3D;0，禁止串行口中断。</p>
<p>ES&#x3D;1，允许串行口中断。</p>
<p>（3）ET1—定时器&#x2F;计数器T1的溢出中断允许位。</p>
<p>ET1&#x3D;0，禁止T1溢出中断。</p>
<p>ET1&#x3D;1，允许T1溢出中断。</p>
<p>（4）EX1—外部中断1中断允许位。</p>
<p>EX1&#x3D;0，禁止外部中断1中断。</p>
<p>EX1&#x3D;1，允许外部中断1中断</p>
<p>（5）ET0—定时器&#x2F;计数器T0的溢出中断允许位。</p>
<p>ET0&#x3D;0，禁止T0溢出中断。</p>
<p>ET0&#x3D;1，允许T0溢出中断。</p>
<p>（6）EX0—外部中断0中断允许位。</p>
<p>EX0&#x3D;0，禁止外部中断0中断。</p>
<p>EX0&#x3D;1，允许外部中断0中断。</p>
<p>AT89S51复位以后，IE被清“0”，所有的中断请求被禁止。IE中与各个中断源相应的位可用指令置“1”或清“0”，即可允许或禁止各中断源的中断申请。若使某一个中断源被允许中断，除了IE相应的位被置“1”外，还必须使EA位置“1”。</p>
<h3 id="5-3-2-中断优先级寄存器IP"><a href="#5-3-2-中断优先级寄存器IP" class="headerlink" title="5.3.2 中断优先级寄存器IP"></a>5.3.2 中断优先级寄存器IP</h3><p>中断请求源有两个中断优先级，每一中断请求源可由软件设置为高优先级中断或低优先级中断，也可实现两级中断嵌套。所谓两级中断嵌套，就是AT89S51正在执行低优先级中断的服务程序时，可被高优先级中断请求所中断，待高优先级中断处理完毕后，再返回低优先级中断服务程序。两级中断嵌套的过程如图5-6所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/image-20231223161333198.png" class="" title="image-20231223161333198">

<p>关于各中断源的中断优先级关系，可归纳为下面两条基本规则：</p>
<p>（1）低优先级可被高优先级中断，高优先级不能低优先级中断。</p>
<p>（2）任何一种中断（不管是高级还是低级），<strong>一旦得到响应，不会再被它的同级中断源所中断</strong>。如果某一中断源被设置为高优先级中断，在执行该中断源的中断服务程序时，则不能被任何其他的中断源的中断请求所中断。</p>
<p>AT89S51的片内有一个中断优先级寄存器IP，其字节地址为B8H，可位寻址。只要用程序改变其内容，即可进行各中断源中断优先级的设置，IP寄存器的格式如图5-7所示。	</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/clip_image001.jpg" class="" title="未命名">



<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/52c641c2e984447ba824ca997ef96909.png" class="" title="img">中断优先级寄存器IP各位的含义如下：

<p>（1）PS—串行口中断优先级控制位</p>
<p>PS&#x3D;1，串行口中断为高优先级</p>
<p>PS&#x3D;0，串行口中断为低优先级</p>
<p>（2）PT1—定时器T1中断优先级控制位</p>
<p>PT1&#x3D;1，定时器T1中断为高优先级</p>
<p>PT1&#x3D;0，定时器T1中断为低优先级</p>
<p>（3）PX1—外部中断1中断优先级控制位(P3.1)</p>
<p>PX1&#x3D;1，外部中断1中断为高优先级</p>
<p>PX1&#x3D;0，外部中断1中断为低优先级</p>
<p>（4）PT0—定时器T0中断优先级控制位</p>
<p>PT0&#x3D;1，定时器T0中断为高优先级</p>
<p>PT0&#x3D;0，定时器T0中断为低优先级</p>
<p>（5）PX0—外部中断0中断优先级控制位（P3.2）</p>
<p>PX0&#x3D;1，外部中断0中断为高优先级</p>
<p>PX0&#x3D;0，外部中断0中断为低优先级</p>
<p>中断优先级控制寄存器IP的各位都可由用户程序置“1”和清“0”，用位操作指令或字节操作指令可更新IP的内容，以改变各中断源的中断优先级。</p>
<p>AT89S51复位以后，IP的内容为0，各个中断源均为低优先级中断。</p>
<p>下面简单介绍AT89S51的中断优先级结构。AT89S51的中断系统有两个不可寻址的“优先级激活触发器”，其中一个指示某高优先级的中断正在执行，所有后来的中断均被阻止；另一个触发器指示某低优先级的中断正在执行，所有同级的中断都被阻止，但不阻断高优先级的中断请求。</p>
<p>在同时收到几个同一优先级的中断请求时，哪一个中断请求能优先得到响应，取决于内部的查询顺序。这相当于在同一个优先级内，还同时存在另一个辅助优先级结构，其查询顺序如表5-1所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/image-20231223161605514.png" class="" title="image-20231223161605514">

<p>由此可见，各中断源在同一个优先级的条件下，外部中断0的中断优先权最高，串行口中断的优先权最低。</p>
<h2 id="5-4-响应中断请求的条件"><a href="#5-4-响应中断请求的条件" class="headerlink" title="5.4 响应中断请求的条件"></a>5.4 响应中断请求的条件</h2><p>一个中断源的中断请求被响应，必须满足以下必要条件：</p>
<p>（1）总中断允许开关接通，即IE寄存器中的中断总允许位EA&#x3D;1。</p>
<p>（2）该中断源发出中断请求，即该中断源对应的中断请求标志为“1”。</p>
<p>（3）该中断源的中断允许位&#x3D;1，即该中断被允许。</p>
<p>（4）无同级或更高级中断正在被服务。</p>
<p>中断响应就是CPU对中断源提出的中断请求的接受。当CPU查询到有效中断请求时，在满足上述条件时，紧接着就进行中断响应。</p>
<p>中断响应的主要过程：首先由硬件自动生成一条长调用指令“LCALL addr16”。这里的addr16就是程序存储区中相应的中断入口地址。例如，对于外部中断1的响应，硬件自动生成的长调用指令为</p>
<p>​            LCALL   0013H</p>
<p>生成LCALL指令后，紧接着就由CPU执行该指令。首先将程序计数器PC的内容压入堆栈以保护断点，再将中断入口地址装入PC，使程序转向响应中断请求的中断入口地址。各中断源服务程序的入口地址是固定的，如表5-2所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/image-20231223161712495.png" class="" title="image-20231223161712495">

<p>其中两个中断入口间只相隔8字节，一般情况下难以安放一个完整的中断服务程序。因此，通常总是在中断入口地址处放置一条无条件转移指令，使程序执行转向在其他地址存放的中断服务程序入口。</p>
<p>中断响应是有条件的，并不是查询到的所有中断请求都能被立即响应，当遇到下列三种情况之一时，中断响应被封锁：</p>
<p>（1）CPU正在处理同级或更高优先级的中断。因为当一个中断被响应时，要把对应的中断优先级状态触发器置“1”（该触发器指出CPU所处理的中断优先级别），从而封锁了低级中断请求和同级中断请求。</p>
<p>（2）所查询的机器周期不是当前正在执行指令的最后一个机器周期。设定这个限制的目的是只有在当前指令执行完毕后，才能进行中断响应，以确保当前指令执行的完整性。</p>
<p>（3）正在执行的指令是RETI或是访问IE或IP的指令。因为按照AT89S51中断系统的规定，在执行完这些指令后，需要再执行完一条指令，才能响应新的中断请求。</p>
<p>如果存在上述三种情况之一，CPU将丢弃中断查询结果，不能对中断进行响应。</p>
<h2 id="5-5-外部中断的响应时间"><a href="#5-5-外部中断的响应时间" class="headerlink" title="5.5 外部中断的响应时间"></a>5.5 外部中断的响应时间</h2><p>在设计者使用外部中断时，有时需考虑从外部中断请求有效（外部中断请求标志置“1”）到转向中断入口地址所需要的响应时间。下面来讨论这个问题。</p>
<p>外部中断的最短响应时间为3个机器周期。其中中断请求标志位查询占1个机器周期，而这个机器周期恰好处于指令的最后一个机器周期。在这个机器周期结束后，中断即被响应，CPU接着执行一条硬件子程序调用指令LCALL以转到相应的中断服务程序入口，这需要2个机器周期。</p>
<p>外部中断响应的最长时间为8个机器周期。这种情况发生在CPU进行中断标志查询时，刚好才开始执行RETI或访问IE或IP的指令，则需把当前指令执行完再继续执行一条指令后，才能响应中断。执行上述的RETI或访问IE或IP的指令，最长需要2个机器周期。而接着再执行一条指令，我们按最长的指令（乘法指令MUL和除法指令DIV）来算，也只有4个机器周期。再加上硬件子程序调用指令LCALL的执行，需要2个机器周期，所以，外部中断响应的最长时间为8个机器周期。</p>
<p>如果已经在处理同级或更高级中断，外部中断请求的响应时间取决于正在执行的中断服务程序的处理时间，这种情况下，响应时间就无法计算了。</p>
<p>  这样，在一个单一中断的系统里，AT89S51单片机对外部中断请求的响应时间总是在3～8个机器周期之间。</p>
<h2 id="5-6-外部中断的触发方式选择"><a href="#5-6-外部中断的触发方式选择" class="headerlink" title="5.6 外部中断的触发方式选择"></a>5.6 外部中断的触发方式选择</h2><p>外部中断有两种触发方式：电平触发方式和跳沿触发方式。</p>
<h3 id="5-6-1-电平触发方式"><a href="#5-6-1-电平触发方式" class="headerlink" title="5.6.1 电平触发方式"></a>5.6.1 电平触发方式</h3><p>  若外部中断定义为电平触发方式，外部中断申请触发器的状态随着CPU在每个机器周期采样到的外部中断输入引脚的电平变化而变化，这能提高CPU对外部中断请求的响应速度。当外部中断源被设定为电平触发方式时，在中断服务程序返回之前，外部中断请求输入必须无效（即外部中断请求输入已由低电平变为高电平），否则CPU返回主程序后会再次响应中断。所以电平触发方式适合于外部中断以低电平输入且中断服务程序能清除外部中断请求源（即外部中断输入电平又变为高电平）的情况。如何清除电平触发方式的外部中断请求源的电平信号，将在本章的后面介绍。</p>
<h3 id="5-6-2-跳沿触发方式"><a href="#5-6-2-跳沿触发方式" class="headerlink" title="5.6.2 跳沿触发方式"></a>5.6.2 跳沿触发方式</h3><p>外部中断若定义为跳沿触发方式，外部中断申请触发器能锁存外部中断输入线上的负跳变。即便是CPU暂时不能响应，中断请求标志也不会丢失。在这种方式下，如果相继连续两次采样，一个机器周期采样到外部中断输入为高，下一个机器周期采样为低，则中断申请触发器置“1”，直到CPU响应此中断时，该标志才清“0”。这样就不会丢失中断，但输入的<strong>负脉冲宽度至少保持12个时钟周期</strong>（若晶振频率为6MHz，则为2us），才能被CPU采样到。外部中断的跳沿触发方式适合于以<strong>负脉冲形式输入</strong>的外部中断请求。</p>
<h2 id="5-7-中断请求的撤销"><a href="#5-7-中断请求的撤销" class="headerlink" title="5.7 中断请求的撤销"></a>5.7 中断请求的撤销</h2><p>  某个中断请求被响应后，就存在着一个中断请求的撤销问题。下面按中断请求源的类型分别说明中断请求的撤销。 </p>
<h3 id="1．定时器-计数器中断请求的撤销"><a href="#1．定时器-计数器中断请求的撤销" class="headerlink" title="1．定时器&#x2F;计数器中断请求的撤销"></a>1．定时器&#x2F;计数器中断请求的撤销</h3><p>定时器&#x2F;计数器中断的中断请求被响应后，硬件会自动把中断请求标志位（TF0或TF1）清“0”，因此定时器&#x2F;计数器中断请求是自动撤销的。</p>
<h3 id="2．外部中断请求的撤销"><a href="#2．外部中断请求的撤销" class="headerlink" title="2．外部中断请求的撤销"></a>2．外部中断请求的撤销</h3><p>（1）跳沿方式外部中断请求的撤销</p>
<p>跳沿方式的外部中断请求的撤销，包括两项内容：中断标志位清“0”和外中断信号的撤销。其中，中断标志位（IE0或IE1）清“0”是在中断响应后由硬件自动完成的。而外中断请求信号的撤销，由于跳沿信号过后也就消失了，所以跳沿方式的外部中断请求也是自动撤销的。</p>
<p>（2）电平方式外部中断请求的撤销</p>
<p>对于电平方式外部中断请求的撤销，中断请求标志的撤销是自动的，但中断请求信号的低电平可能继续存在，在以后的机器周期采样时，又会把已清“0”的IE0或IE1标志位重新置“1”。为此，要彻底解决电平方式外部中断请求的撤销，除了标志位清“0”之外，必要时还需在中断响应后把中断请求信号输入引脚从低电平强制改变为高电平。为此，可在系统中增加如图5-8所示的电路。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/image-20231223162034528.png" class="" title="image-20231223162034528">

<p>由图5-8可见，用D触发器锁存外来的中断请求低电平，并通过D触发器的输出端Q接到INT0<em>（或INT1</em> ）。所以，增加的D触发器不影响中断请求。中断响应后，为了撤销中断请求，可利用D触发器的直接置“1”端SD实现，即把SD端接AT89S51的P1.0端。因此，只要P1.0端输出一个负脉冲就可以使D触发器置“1”，从而就撤销低电平的中断请求信号。所需的负脉冲可在中断服务程序中先把P1.0置1.再让P1.0为0，再把P1.0置1，从而产生一个负脉冲。</p>
<h3 id="3．串行口中断请求的撤销"><a href="#3．串行口中断请求的撤销" class="headerlink" title="3．串行口中断请求的撤销"></a>3．串行口中断请求的撤销</h3><p>串行口中断请求的撤销只有标志位清“0”的问题。串行口中断的标志位是TI和RI，但对这两个中断标志CPU不进行自动清“0”。因为在响应串行口的中断后，CPU无法知道 是接收中断还是发送中断，还需测试这两个中断标志位的状态，以判定是接收操作还是发送操作，然后才能清除。所以串行口中断请求的撤销只能使用软件的方法，在中断服务程序中进行，即使用软件在中断服务程序中把串行口中断标志位TI、RI清0。 </p>
<h2 id="5-8-中断函数"><a href="#5-8-中断函数" class="headerlink" title="5.8 中断函数"></a>5.8 中断函数</h2><p>为直接使用C51编写中断服务程序，C51中定义了中断函数。由于C51编译器在编译时对声明为中断服务程序的函数自动添加了相应的现场保护、阻断其他中断、返回时自动恢复现场等处理的程序段，因而在编写中断函数时可不必考虑这些问题，减小了用户编写中断服务程序的繁琐程度。</p>
<p>第3章中介绍的中断服务函数的一般形式为：</p>
<p>函数类型 函数名（形式参数表） interrupt n using n </p>
<p>关键字interrupt后面的 n是中断号，对于51单片机，n的取值为0~4，编译器从8×n+3处产生中断向量。AT89S51单片机的中断源对应的中断号和中断向量见表5-3。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/image-20231223162142401.png" class="" title="image-20231223162142401">

<p>AT89S51单片机在内部RAM中可使用4个工作寄存器区，每个工作寄存器区包含8个工作寄存器（R0～R7）。C51扩展了一个关键字using，using后面的n专门用来选择AT89S51的<strong>4个不同的工作寄存器区</strong>。using是一个选项，<strong>如果不选用该项，中断函数中的所有工作寄存器的内容将被保存到堆栈中</strong>。</p>
<p>关键字using对函数目标代码的影响如下：在中断函数的入口处将当前工作寄存器区的内容保护到堆栈中，函数返回前将被保护的寄存器区的内容从堆栈中恢复。使用关键字using在函数中确定一个工作寄存器区时须十分小心，要保证任何工作寄存器区的切换都只在指定的控制区域中发生，否则将产生不正确的函数结果。</p>
<p>例如，外中断1的中断服务函数如下：</p>
<pre class="language-none"><code class="language-none">void int1( ) interrupt 2 using 0  &#x2F;*中断号n&#x3D;2，选择0区工作寄存器区*&#x2F;</code></pre>

<p>中断调用与标准C的函数调用是不一样的，当中断事件发生后，对应的中断函数被自动调用，中断函数既没有参数，也没有返回值。中断函数会带来如下影响。</p>
<p>（1）编译器会为中断函数自动生成中断向量。</p>
<p>（2）退出中断函数时，所有保存在堆栈中的工作寄存器及特殊功能寄存器被恢复。</p>
<p>（3）在必要时特殊功能寄存器Acc、B、DPH、DPL以及PSW的内容被保存到堆栈中。</p>
<p>编写AT89S51单片机中断程序时，应遵循以下规则：</p>
<p>（1）中断函数没有返回值，如果定义了一个返回值，将会得到不正确的结果。因此建议将中断函数定义为void类型，以明确说明没有返回值。</p>
<p>（2）中断函数不能进行参数传递，如果中断函数中包含任何参数声明都将导致编译出错。</p>
<p>（3）在任何情况下都不能直接调用中断函数，否则会产生编译错误。因为中断函数的返回是由汇编语言指令RETI完成的。RETI指令会影响AT89S51单片机中的硬件中断系统内的不可寻址的中断优先级寄存器的状态。如果在没有实际的中断请求的情况下，直接调用中断函数，也就不会执行RETI指令，其操作结果有可能产生一个致命的错误。</p>
<p>（4）如果在中断函数中再调用其他函数，则被调用的函数所使用的寄存器区必须与中断函数使用的寄存器区不同。</p>
<h2 id="5-9-C51编程举例"><a href="#5-9-C51编程举例" class="headerlink" title="5.9 C51编程举例"></a>5.9 C51编程举例</h2><p>本节通过几个例程介绍有关中断应用的程序的编写。</p>
<h3 id="5-9-1-单一外中断的应用"><a href="#5-9-1-单一外中断的应用" class="headerlink" title="5.9.1 单一外中断的应用"></a>5.9.1 单一外中断的应用</h3><p>【例5-2】在51单片机的P1口上接有8只LED。在外部中断0输入引脚P3.2（INT0*）引脚接有一只按钮开关K1。程序要求将外部中断0设置为负跳沿触发。在程序启动时，P1口上的8只LED亮。按一次按钮开关K1，使引脚接地，产生一个负跳沿触发的外中断0中断请求，在中断服务程序中，让低4位的LED和高4位的LED交替闪烁。具体电路如图5-9所示。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/image-20231223162358079.png" class="" title="image-20231223162358079">

<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg51.h></span></span>
<span class="token keyword">void</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token comment">/*延时函数Delay( )，i为形式参数，不能赋初值*/</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> j； <span class="token keyword">for</span> <span class="token punctuation">(</span>；i <span class="token operator">></span> <span class="token number">0</span>；i <span class="token operator">--</span><span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span>；j <span class="token operator">&lt;</span> <span class="token number">333</span>；j <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">/*晶振为12MHz，j的选择与晶振频率有关*/</span>
    <span class="token punctuation">&#123;</span>
        ；
    <span class="token punctuation">&#125;</span> <span class="token comment">/*空函数*/</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/*主函数*/</span>
<span class="token punctuation">&#123;</span>
    EA <span class="token operator">=</span> <span class="token number">1</span>；       <span class="token comment">/*总中断允许*/</span>
        EX0 <span class="token operator">=</span> <span class="token number">1</span>；  <span class="token comment">/*允许外部中断0中断*/</span>
        IT0 <span class="token operator">=</span> <span class="token number">1</span>；  <span class="token comment">/*选择外部中断0为跳沿触发方式*/</span>
        <span class="token punctuation">&#123;</span>P1 <span class="token operator">=</span> <span class="token number">0</span>；<span class="token punctuation">&#125;</span> <span class="token comment">/* P1口的8只LED全亮*/</span>
    <span class="token function">While</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">/*循环*/</span>
｝ <span class="token keyword">void</span>
    <span class="token function">int0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">0</span> using <span class="token number">0</span> <span class="token comment">/*外中断0的中断服务函数*/</span>
        <span class="token punctuation">&#123;</span>
            EX0 <span class="token operator">=</span> <span class="token number">0</span>；     <span class="token comment">/*禁止外部中断0中断*/</span>
            P1 <span class="token operator">=</span> <span class="token number">0x0f</span>；   <span class="token comment">/*低4位LED灭，高4位LED亮*/</span>
            <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">)</span> ； <span class="token comment">/*延时800ms*/</span>
            P1 <span class="token operator">=</span> <span class="token number">0xf0</span>；   <span class="token comment">/*高4位LED灭，低4位LED亮*/</span>
            <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">)</span>；  <span class="token comment">/*延时800ms */</span>
            EX0 <span class="token operator">=</span> <span class="token number">1</span>；     <span class="token comment">/*中断返回前，打开外部中断0中断*/</span>
        <span class="token punctuation">&#125;</span> 本例程包含了两个部分，一是中断系统初始化部分，另一是中断处理服务函数部分</code></pre>

<h3 id="5-9-2-两个外中断的应用"><a href="#5-9-2-两个外中断的应用" class="headerlink" title="5.9.2 两个外中断的应用"></a>5.9.2 两个外中断的应用</h3><p>当多个中断源时，只需增加相应的中断服务函数即可。例5-3是处理两个外中断请求的例子</p>
<p>【例5-3】如图5-10所示，在51单片机的P1口上接有8只LED。在外部中断0输入</p>
<p>引脚P3.2（INT0<em>）引脚接有一只按钮开关K1。在外部中断1输入引脚P3.3（ INT1</em> ）引脚接有一只按钮开关K2。程序要求K1和K2都未按下时，P1口的8只LED呈流水灯显示，仅K1（P3.2）按下时，左右4只LED交替闪烁。仅按下K2（P3.3），P1口的8只LED全部闪亮。两个外中断的优先级相同。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/image-20231223162532846.png" class="" title="image-20231223162532846">

<pre class="language-C" data-language="C"><code class="language-C">#include &lt;reg51.h&gt;
void Delay(unsigned int i) &#x2F;*延时函数Delay( )，i为形式参数，不能赋初值*&#x2F;
&#123;
    unsigned int j； for (；i &gt; 0；i --) for (j &#x3D; 0；j &lt; 125；j ++)
    &#123;
        ；
    &#125; &#x2F;*空函数*&#x2F;
&#125;
void main() &#x2F;*主函数*&#x2F;
&#123;
    unsigned char play[9] &#x3D; &#123; 0xff，0xfe，0xfd，0xfb，0xf7，0xef，0xdf，0xbf，0x7f &#125;；&#x2F;*定义了流水灯的显示数据*&#x2F;
        unsigned char a； for (；；)
    &#123;
        for (a &#x3D; 0；a &lt; 9；a ++)
        &#123;
            &#123;
                Delay(500)     &#x2F;*延时*&#x2F;
                P1 &#x3D; play[a]； &#x2F;*将已经定义的流水灯显示数据送到P1口*&#x2F;
            &#125; EA &#x3D; 1；         &#x2F;*总中断允许*&#x2F;
                EX0 &#x3D; 1；      &#x2F;*允许外部中断0中断*&#x2F;
                EX1 &#x3D; 1        &#x2F;*允许外部中断1中断*&#x2F;
                IT0 &#x3D; 1；      &#x2F;*选择外部中断0为跳沿触发方式*&#x2F;
                IT1 &#x3D; 1；      &#x2F;*选择外部中断1为跳沿触发方式*&#x2F;
                IP &#x3D; 0；       &#x2F;*两个外部中断均为低优先级*&#x2F;
        &#125;
    &#125;
void int0_isr(void)  interrupt 0  using 0  &#x2F;*外中断0的中断服务函数*&#x2F;
&#123;	for(；；)
	&#123;
	P1&#x3D;0x0f；				&#x2F;*低4位LED灭，高4位LED亮*&#x2F;
	Delay(500) ；			&#x2F;*延时*&#x2F;
	P1&#x3D;0xf0；				&#x2F;*高4位LED灭，低4位LED亮*&#x2F;
	Delay(500)； 			&#x2F;*延时*&#x2F;
	&#125;
&#125;
void int1_isr (void)  interrupt 2  using 1	  &#x2F;*外中断1的中断服务函数*&#x2F;
&#123;	for(；；)
	&#123;	P1&#x3D;0xff；				&#x2F;*全灭*&#x2F;
		Delay(500) ；			&#x2F;*延时*&#x2F;
		P1&#x3D;0；					&#x2F;*全亮*&#x2F;
		Delay(500)；&#125; 			&#x2F;*延时*&#x2F;
&#125;
</code></pre>

<h3 id="5-9-3-中断嵌套"><a href="#5-9-3-中断嵌套" class="headerlink" title="5.9.3 中断嵌套"></a>5.9.3 中断嵌套</h3><p>  中断嵌套只能发生在单片机正在执行一个低优先级中断服务程序的时候，此时又有一个高优先级中断产生，就会产生高优先级中断打断低优先级中断服务程序，去执行高优先级中断服务程序。高优先级中断服务程序完成后，再继续执行低优先级中断服务程序。</p>
<p>  【例5-4】电路仍如图5-10所示，设计一个中断嵌套程序。要求K1和K2都未按下时，P1口的8只LED呈流水灯显示，当K1按下再松开时，产生一个低优先级的外中断0请求（跳沿触发），进入外中断0中断服务程序，左右4只LED交替闪烁。此时按下K2再松开时，产生一个高优先级的外中断1请求（跳沿触发），进入外中断1中断服务程序，P1口的8只LED全部闪烁。当显示一段时间后，再从外中断1返回继续执行外中断0中断服务程序，即P1口控制8只LED左右4只LED交替闪烁。。设置外中断1为高优先级，外中断0为低优先级。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/image-20231223162532846.png" class="" title="image-20231223162532846">

<pre class="language-C" data-language="C"><code class="language-C">#include &lt;reg51.h&gt;
void Delay(unsigned int i) &#x2F;*延时函数Delay( )*&#x2F;
&#123;
    unsigned int j； for (；i &gt; 0；i --) for (j &#x3D; 0；j &lt; 125；j ++)
    &#123;
        ；
    &#125; &#x2F;*空函数*&#x2F;
&#125;
void main() &#x2F;*主函数*&#x2F;
&#123;
    unsigned char play[9] &#x3D; &#123; 0xff，0xfe，0xfd，0xfb，0xf7，0xef，0xdf，0xbf，0x7f &#125;；&#x2F;*定义流水灯的显示数据*&#x2F;
        unsigned char a； for (；；)
    &#123;
        for (a &#x3D; 0；a &lt; 9；a ++)
        &#123;
            &#123;
                Delay(500)     &#x2F;*延时*&#x2F;
                P1 &#x3D; play[a]； &#x2F;*将已经定义的流水灯显示数据送到P1口*&#x2F;
            &#125; EA &#x3D; 1；         &#x2F;*总中断允许*&#x2F;
                EX0 &#x3D; 1；      &#x2F;*允许外部中断0中断*&#x2F;
                EX1 &#x3D; 1        &#x2F;*允许外部中断1中断*&#x2F;
                IT0 &#x3D; 1；      &#x2F;*选择外部中断0为跳沿触发方式*&#x2F;
                IT1 &#x3D; 1；      &#x2F;*选择外部中断1为跳沿触发方式*&#x2F;
      			PX0&#x3D;0；		  &#x2F;*外部中断0为低优先级*&#x2F;
                PX1 &#x3D; 1；      &#x2F;*外部中断1为高优先级*&#x2F;
        &#125;
    &#125;
    void int0_isr(void) interrupt 0 using 0 &#x2F;*外中断0的中断服务函数*&#x2F;
    &#123;
        for (；；)
        &#123;
            P1 &#x3D; 0x0f；       &#x2F;*低4位LED灭，高4位LED亮*&#x2F;
                Delay(500) ； &#x2F;*延时*&#x2F;
                P1 &#x3D; 0xf0；   &#x2F;*高4位LED灭，低4位LED亮*&#x2F;
                Delay(500)；  &#x2F;*延时*&#x2F;
        &#125;
    &#125;
    void int1_isr(void) interrupt 2 using 1 &#x2F;*外中断1的中断服务函数*&#x2F;
    &#123;
        P1 &#x3D; 0；          &#x2F;*8位LED全亮*&#x2F;
            Delay(500) ； &#x2F;*延时*&#x2F;
            P1 &#x3D; 0xff；   &#x2F;*8位LED全灭*&#x2F;
            Delay(500)；
    &#125; &#x2F;*延时*&#x2F;
&#125;
</code></pre>

<h3 id="5-9-4-多外部中断源系统设计"><a href="#5-9-4-多外部中断源系统设计" class="headerlink" title="5.9.4 多外部中断源系统设计"></a>5.9.4 多外部中断源系统设计</h3><p>AT89S51为用户提供两个外部中断请求输入端INT0<em>和INT1</em> ，实际的应用系统中，两个外部中断请求源往往不够用，需对外部中断源进行扩充。本节介绍一种利用外部中断和查询相结合的扩展外部中断源的方法。</p>
<p>如图5-11所示，若系统中有5个外部中断请求源IR0～IR4，它们均为高电平请求有效，这时可按中断请求的轻重缓急进行排队，把其中最高级别的中断请求源IR0直接接到AT89S51的一个外部中断请求源IR0输入端，其余的4个中断请求源IR1～IR4按图5-11通过各自的OC门（集电极开路门）连到AT89S51的另一个外中断源输入端，同时还连到P1口的P1.0～P1.3脚，供AT89S51查询。各外部中断请求源的中断请求由外设的电路产生。图5-11电路中，除了IR0的中断优先权级别最高外，IR1～IR4外部中断源的中断优先权取决于查询顺序，</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/image-20231223162859183.png" class="" title="image-20231223162859183">

<p>这里假设查询顺序为P1.0∼P1.3，因此，中断优先权由高到低的顺序依次为IR1，… … ，IR4。</p>
<p>【例5-5】利用外部中断和查询相结合的方法扩展多个外部中断。</p>
<p>参考程序如下：</p>
<pre class="language-C" data-language="C"><code class="language-C">#include &lt;reg51.h&gt;
sbit P1_0 &#x3D; P1 ^ 0；                 &#x2F;*定义位变量*&#x2F;
sbit P1_1 &#x3D; P1 ^ 1；
    …… 
sbit P1_7 &#x3D; P1 ^ 7； 
    void main() &#x2F;*主函数*&#x2F;
&#123;
    P1 &#x3D; 0xff；    &#x2F;*LED全灭*&#x2F;
        EA &#x3D; 1；   &#x2F;*总中断允许*&#x2F;
        EX0 &#x3D; 1；  &#x2F;*允许外部中断0中断*&#x2F;
        EX1 &#x3D; 1    &#x2F;*允许外部中断1中断*&#x2F;
        IT0 &#x3D; 0；  &#x2F;*选择外部中断0为电平触发方式*&#x2F;
        IT1 &#x3D; 0；  &#x2F;*选择外部中断0为电平触发方式*&#x2F;
        PX0 &#x3D; 1；  &#x2F;*外部中断0为高优先级*
PX1&#x3D;0；			&#x2F;*外部中断1为低优先级*&#x2F;
        for (；；) &#x2F;*延时等待中断*&#x2F;
    &#123;
        ；
    &#125;
&#125;
void int0_isr(void) interrupt 0 &#x2F;*外中断0的中断服务函数*&#x2F;
&#123;
    P1 &#x3D; 0x0f； &#x2F;*点亮高4位*&#x2F;
&#125;
void int1_isr(void) interrupt 2 &#x2F;*外中断1的中断服务函数*&#x2F;
&#123;
    if (P1_0 &#x3D; &#x3D; 0)
    &#123;
        P1 &#x3D; 0(P1 &amp; 0xef)
    &#125; &#x2F;*如果为IR1中断，点亮LED1*&#x2F;
    if (P1_1 &#x3D; &#x3D; 0)
    &#123;
        P1 &#x3D; 0(P1 &amp; 0xdf)
    &#125; &#x2F;*如果为IR1中断，点亮LED2*&#x2F;
    if (P1_2 &#x3D; &#x3D; 0)SS
    &#123;
        P1 &#x3D; 0(P1 &amp; 0xbf)
    &#125; &#x2F;*如果为IR2中断，点亮LED3*&#x2F;
    if (P1_3 &#x3D; &#x3D; 0)
    &#123;
        P1 &#x3D; 0(P1 &amp; 0x7f)
    &#125; &#x2F;*如果为IR3中断，点亮LED4*&#x2F;
&#125;
注意，当扩展的外部中断源个数较多时，查询时间稍长。
</code></pre>

</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/tx.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/tx.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">ryz</div><div class="post-copyright__author_desc">生活就是白云苍狗</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://ybjryz.github.io/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://ybjryz.github.io/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/')">第五章</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://ybjryz.github.io/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=第五章&amp;url=http://ybjryz.github.io/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%94%E7%AB%A0/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://ybjryz.github.io" target="_blank">ryz</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>学校课程<span class="tagsPageCount">7</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/img/tx.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%9B%9B%E7%AB%A0/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">第四章</div></div></a></div><div class="next-post pull-right"><a href="/2023/12/17/ICT/%E7%BD%91%E7%BB%9C%E5%87%86%E5%85%A5%E6%8E%A7%E5%88%B6/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">网络准入控制</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/" title="第六章"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-23</div><div class="title">第六章</div></div></a></div><div><a href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0/" title="第十一章"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-23</div><div class="title">第十一章</div></div></a></div><div><a href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%8D%81%E7%AB%A0/" title="第十章"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-23</div><div class="title">第十章</div></div></a></div><div><a href="/2023/12/10/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%BA%8C%E7%AB%A0/" title="第二章"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-10</div><div class="title">第二章</div></div></a></div><div><a href="/2023/12/16/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%9B%9B%E7%AB%A0/" title="第四章"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-16</div><div class="title">第四章</div></div></a></div><div><a href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/" title="第七章"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-23</div><div class="title">第七章</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/tx.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2021/01/15/752a5d910377a.png" ait="status"/></div></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.</span> <span class="toc-text">中断系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0-%E5%A4%A7%E7%BA%B2"><span class="toc-number">1.1.</span> <span class="toc-text">0.大纲</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-AT89S51%E4%B8%AD%E6%96%AD%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0"><span class="toc-number">1.2.</span> <span class="toc-text">1.AT89S51中断技术概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-AT89S51%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">5.2 AT89S51中断系统结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-%E4%B8%AD%E6%96%AD%E8%AF%B7%E6%B1%82%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.3.1.</span> <span class="toc-text">5.2.2 中断请求标志寄存器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-TCON%E5%AF%84%E5%AD%98%E5%99%A8%E2%80%93%E5%AE%9A%E6%97%B6%E5%99%A8-%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">1.TCON寄存器–定时器&#x2F;计数器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-SCON%E5%AF%84%E5%AD%98%E5%99%A8%E2%80%93%E4%B8%B2%E8%A1%8C%E5%8F%A3"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">2.SCON寄存器–串行口</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E4%B8%AD%E6%96%AD%E5%85%81%E8%AE%B8%E4%B8%8E%E4%B8%AD%E6%96%AD%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E6%8E%A7%E5%88%B6"><span class="toc-number">1.4.</span> <span class="toc-text">5.3 中断允许与中断优先级的控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-1-%E4%B8%AD%E6%96%AD%E5%85%81%E8%AE%B8%E5%AF%84%E5%AD%98%E5%99%A8IE"><span class="toc-number">1.4.1.</span> <span class="toc-text">5.3.1 中断允许寄存器IE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-2-%E4%B8%AD%E6%96%AD%E4%BC%98%E5%85%88%E7%BA%A7%E5%AF%84%E5%AD%98%E5%99%A8IP"><span class="toc-number">1.4.2.</span> <span class="toc-text">5.3.2 中断优先级寄存器IP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E5%93%8D%E5%BA%94%E4%B8%AD%E6%96%AD%E8%AF%B7%E6%B1%82%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.5.</span> <span class="toc-text">5.4 响应中断请求的条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD%E7%9A%84%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4"><span class="toc-number">1.6.</span> <span class="toc-text">5.5 外部中断的响应时间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-6-%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD%E7%9A%84%E8%A7%A6%E5%8F%91%E6%96%B9%E5%BC%8F%E9%80%89%E6%8B%A9"><span class="toc-number">1.7.</span> <span class="toc-text">5.6 外部中断的触发方式选择</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-1-%E7%94%B5%E5%B9%B3%E8%A7%A6%E5%8F%91%E6%96%B9%E5%BC%8F"><span class="toc-number">1.7.1.</span> <span class="toc-text">5.6.1 电平触发方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-2-%E8%B7%B3%E6%B2%BF%E8%A7%A6%E5%8F%91%E6%96%B9%E5%BC%8F"><span class="toc-number">1.7.2.</span> <span class="toc-text">5.6.2 跳沿触发方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-7-%E4%B8%AD%E6%96%AD%E8%AF%B7%E6%B1%82%E7%9A%84%E6%92%A4%E9%94%80"><span class="toc-number">1.8.</span> <span class="toc-text">5.7 中断请求的撤销</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8E%E5%AE%9A%E6%97%B6%E5%99%A8-%E8%AE%A1%E6%95%B0%E5%99%A8%E4%B8%AD%E6%96%AD%E8%AF%B7%E6%B1%82%E7%9A%84%E6%92%A4%E9%94%80"><span class="toc-number">1.8.1.</span> <span class="toc-text">1．定时器&#x2F;计数器中断请求的撤销</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8E%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD%E8%AF%B7%E6%B1%82%E7%9A%84%E6%92%A4%E9%94%80"><span class="toc-number">1.8.2.</span> <span class="toc-text">2．外部中断请求的撤销</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8E%E4%B8%B2%E8%A1%8C%E5%8F%A3%E4%B8%AD%E6%96%AD%E8%AF%B7%E6%B1%82%E7%9A%84%E6%92%A4%E9%94%80"><span class="toc-number">1.8.3.</span> <span class="toc-text">3．串行口中断请求的撤销</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-8-%E4%B8%AD%E6%96%AD%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.</span> <span class="toc-text">5.8 中断函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-9-C51%E7%BC%96%E7%A8%8B%E4%B8%BE%E4%BE%8B"><span class="toc-number">1.10.</span> <span class="toc-text">5.9 C51编程举例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-9-1-%E5%8D%95%E4%B8%80%E5%A4%96%E4%B8%AD%E6%96%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.10.1.</span> <span class="toc-text">5.9.1 单一外中断的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-9-2-%E4%B8%A4%E4%B8%AA%E5%A4%96%E4%B8%AD%E6%96%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.10.2.</span> <span class="toc-text">5.9.2 两个外中断的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-9-3-%E4%B8%AD%E6%96%AD%E5%B5%8C%E5%A5%97"><span class="toc-number">1.10.3.</span> <span class="toc-text">5.9.3 中断嵌套</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-9-4-%E5%A4%9A%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD%E6%BA%90%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.10.4.</span> <span class="toc-text">5.9.4 多外部中断源系统设计</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0/" title="第十一章">第十一章</a><time datetime="2023-12-23T14:53:00.000Z" title="发表于 2023-12-23 22:53:00">2023-12-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%8D%81%E7%AB%A0/" title="第十章">第十章</a><time datetime="2023-12-23T13:53:00.000Z" title="发表于 2023-12-23 21:53:00">2023-12-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E4%B8%83%E7%AB%A0/" title="第七章">第七章</a><time datetime="2023-12-23T13:10:00.000Z" title="发表于 2023-12-23 21:10:00">2023-12-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/23/%E9%80%9F%E6%88%90/%E5%8D%95%E7%89%87%E6%9C%BAC51/%E7%AC%AC%E5%85%AD%E7%AB%A0/" title="第六章">第六章</a><time datetime="2023-12-23T09:33:00.000Z" title="发表于 2023-12-23 17:33:00">2023-12-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/17/ICT/%E5%85%B6%E4%BB%96%E6%A8%A1%E6%8B%9F%E5%99%A8/" title="其他模拟器">其他模拟器</a><time datetime="2023-12-17T01:00:00.000Z" title="发表于 2023-12-17 09:00:00">2023-12-17</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2023 By <a class="footer-bar-link" href="/" title="ryz" target="_blank">ryz</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">57</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/ICT/" style="font-size: 0.88rem;">ICT<sup>13</sup></a><a href="/tags/WEB-Trojans/" style="font-size: 0.88rem;">WEB-Trojans<sup>1</sup></a><a href="/tags/code/" style="font-size: 0.88rem;">code<sup>1</sup></a><a href="/tags/ctf/" style="font-size: 0.88rem;">ctf<sup>1</sup></a><a href="/tags/tools/" style="font-size: 0.88rem;">tools<sup>1</sup></a><a href="/tags/typora/" style="font-size: 0.88rem;">typora<sup>1</sup></a><a href="/tags/web-tools/" style="font-size: 0.88rem;">web-tools<sup>1</sup></a><a href="/tags/web%E5%90%8E%E7%AB%AF%E6%BC%8F%E6%B4%9E/" style="font-size: 0.88rem;">web后端漏洞<sup>1</sup></a><a href="/tags/web%E6%BC%8F%E6%B4%9E/" style="font-size: 0.88rem;">web漏洞<sup>1</sup></a><a href="/tags/web%E6%BC%8F%E6%B4%9E%E5%AE%9E%E9%AA%8C/" style="font-size: 0.88rem;">web漏洞实验<sup>14</sup></a><a href="/tags/%E4%BB%A3%E5%8A%9E/" style="font-size: 0.88rem;">代办<sup>1</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2%E4%BC%98%E5%8C%96/" style="font-size: 0.88rem;">博客优化<sup>1</sup></a><a href="/tags/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/" style="font-size: 0.88rem;">学校课程<sup>7</sup></a><a href="/tags/%E5%AE%89%E5%85%A8-%E6%9D%82%E9%A1%B9/" style="font-size: 0.88rem;">安全--杂项<sup>1</sup></a><a href="/tags/%E5%B0%8F%E6%8A%80%E5%B7%A7/" style="font-size: 0.88rem;">小技巧<sup>1</sup></a><a href="/tags/%E6%9D%82%E9%A1%B9/" style="font-size: 0.88rem;">杂项<sup>1</sup></a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 0.88rem;">渗透测试<sup>1</sup></a><a href="/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" style="font-size: 0.88rem;">环境搭建<sup>1</sup></a><a href="/tags/%E9%97%AE%E9%A2%98/" style="font-size: 0.88rem;">问题<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8779107562" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/playlist?id=8779107562&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("05/14/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.8",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 ryz 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>